import{s as p}from"./ctgov-D30T4kGK.js";const C={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},E="tc_geocode_cache_v1",j="tc_eligibility_profile";function P(){try{return JSON.parse(localStorage.getItem(E)||"{}")}catch{return{}}}function S(m){try{localStorage.setItem(E,JSON.stringify(m))}catch{}}function T(m){const i=m.trim().replace(/\s+/g," ");if(!i)return[];const s=[i],t=i.toLowerCase(),a=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","district of columbia","washington dc","washington d.c."];return/\busa\b|\bunited states\b|\bUS\b/i.test(i)||t.includes(" united states")||s.push(`${i}, United States`),a.includes(t)&&s.push(`${i}, United States`),t==="new york"&&s.push("New York, NY"),t==="washington"&&s.push("Washington, DC"),Array.from(new Set(s))}async function R(m){try{const i=new URLSearchParams({format:"jsonv2",limit:"1",q:m}),s=await p(`https://nominatim.openstreetmap.org/search?${i.toString()}`);if(!s||!s.ok)return null;const t=await s.json(),a=t==null?void 0:t[0],N=Number(a==null?void 0:a.lat),y=Number(a==null?void 0:a.lon),o=((a==null?void 0:a.display_name)||"").toString();return!Number.isFinite(N)||!Number.isFinite(y)?null:{lat:N,lng:y,label:o}}catch{return null}}function D(){try{const m=localStorage.getItem(j);if(!m)return{loc:""};const i=JSON.parse(m);return{loc:String(i.loc||"").trim(),radius:String(i.radius||"").trim()||void 0}}catch{return{loc:""}}}async function M(m){var i,s;try{const t=m.trim();if(!t)return null;const a=P();if(a[t])return{...a[t]};const y=(C==null?void 0:C.VITE_GEO_WEBHOOK_URL)||"/.netlify/functions/geocode";if(typeof window<"u"){const o=T(t);for(const r of o)try{const e=await p(y,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({q:r})});if(e&&e.ok){const c=await e.json(),n=Number(c.lat),d=Number(c.lng),l=typeof c.label=="string"?c.label:void 0;if(Number.isFinite(n)&&Number.isFinite(d))return a[t]={lat:n,lng:d,label:l},S(a),{lat:n,lng:d,label:l}}}catch{}for(const r of o){const e=await R(r);if(e)return a[t]={lat:e.lat,lng:e.lng,label:e.label},S(a),e}return null}try{const o=await p(y,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({q:t})});if(o&&o.ok){const r=await o.json(),e=Number(r.lat),c=Number(r.lng),n=typeof r.label=="string"?r.label:void 0;if(Number.isFinite(e)&&Number.isFinite(c))return a[t]={lat:e,lng:c,label:n},S(a),{lat:e,lng:c,label:n}}}catch{}try{let o=t;/^\s*(usa?|united\s+states?)\s*$/i.test(t)&&(o="United States");const r=(i=String(o).match(/^(\d{5})(?:-\d{4})?$/))==null?void 0:i[1];if(r)try{const e=await p(`https://api.zippopotam.us/us/${r}`);if(e&&e.ok){const c=await e.json(),n=(s=c==null?void 0:c.places)==null?void 0:s[0],d=Number(n==null?void 0:n.latitude),l=Number(n==null?void 0:n.longitude),k=String((n==null?void 0:n["place name"])||(n==null?void 0:n.place)||"").trim(),U=String((n==null?void 0:n["state abbreviation"])||(n==null?void 0:n.state)||"").trim(),b=[k,U].filter(Boolean).join(", ");if(Number.isFinite(d)&&Number.isFinite(l)&&U&&d>24&&d<50&&l>-130&&l<-65)return a[t]={lat:d,lng:l,label:b},S(a),{lat:d,lng:l,label:b}}}catch{}}catch{}try{const o=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","DC"],r=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","district of columbia","washington dc","washington d.c."],e=t.toUpperCase(),c=t.toLowerCase(),d=o.some(u=>e.includes(u))||r.some(u=>c.includes(u))||/\busa\b|\bunited states\b|\bUS\b/i.test(t)||t.match(/\d{5}/),l=t.split(",").map(u=>u.trim()).filter(Boolean),k=l.length?l[l.length-1].toLowerCase():"",U=o.includes(k.toUpperCase())||r.includes(k),b={format:"jsonv2",limit:"10"};d&&(b.countrycodes="us");let L;if(l.length>=2&&U){const u=l.slice(0,-1).join(", ").trim(),w=l.slice(-1).join(", ").trim();L=new URLSearchParams({...b,city:u,state:w,country:"United States"})}else if(r.includes(c))L=new URLSearchParams({...b,state:t,country:"United States"});else{const u=d?`${t}, United States`:t;L=new URLSearchParams({...b,q:u})}try{const u=await p(`https://nominatim.openstreetmap.org/search?${L.toString()}`);if(u&&u.ok){const w=await u.json();if(w&&w.length>0){let h=w[0];if(d){const F=w.filter(g=>{const f=((g==null?void 0:g.display_name)||"").toUpperCase();return f.includes("UNITED STATES")||f.includes("USA")||f.includes(", US")||f.endsWith("US")});F.length>0?h=F[0]:h=w.find(g=>{const f=Number(g==null?void 0:g.lat),I=Number(g==null?void 0:g.lon);return Number.isFinite(f)&&Number.isFinite(I)&&f>24&&f<50&&I>-130&&I<-65})||h}const v=Number(h==null?void 0:h.lat),A=Number(h==null?void 0:h.lon),O=((h==null?void 0:h.display_name)||"").toString();if(Number.isFinite(v)&&Number.isFinite(A))return a[t]={lat:v,lng:A,label:O},S(a),{lat:v,lng:A,label:O}}}}catch{}}catch{}return null}catch{return null}}async function Y(){const{loc:m,radius:i}=D();if(!m)return{radius:i};const s=await M(m);return s&&Number.isFinite(s.lat)&&Number.isFinite(s.lng)?{...s,radius:i}:{radius:i}}export{Y as a,M as g,D as r};
