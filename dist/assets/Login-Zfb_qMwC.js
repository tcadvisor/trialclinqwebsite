import{e as j,u as S,f as I,r as l,R as w,j as e,L as _,s as L}from"./index-DLD9h1BK.js";import{H as C}from"./HomeHeader-DCWuVVSi.js";import"./HeaderActions-VMSc5EzH.js";import"./search-CJLlGCyb.js";import"./shield-C_5sYL84.js";function M(){var x;const i=j(),o=S(),{isAuthenticated:m,signIn:c,user:n}=I(),[d,b]=l.useState(""),[p,g]=l.useState(null),[u,f]=l.useState(!1),h=(x=o.state)==null?void 0:x.authMessage;w.useEffect(()=>{var a,s;if(m){const r=(s=(a=o.state)==null?void 0:a.from)==null?void 0:s.pathname,t=(n==null?void 0:n.role)==="provider"?"/providers/dashboard":"/patients/dashboard";i(r||t,{replace:!0})}},[m,i,o.state,n]);const y=async a=>{var s,r;a.preventDefault(),g(null),f(!0);try{localStorage.removeItem("pending_signup_v1"),localStorage.setItem("pending_role_v1","patient");const t=await L({email:d.trim(),password:""});if(t){c({...t,role:"patient"});const N=((r=(s=o.state)==null?void 0:s.from)==null?void 0:r.pathname)||"/patients/dashboard";i(N,{replace:!0})}}catch(t){g(t instanceof Error?t.message:"Invalid email or password. Please try again.")}finally{f(!1)}},v=()=>{const a={email:"demo.patient@example.com",firstName:"Demo",lastName:"Patient",userId:"demo-patient-12345",role:"patient"};localStorage.setItem("tc_health_profile_v1",JSON.stringify({patientId:"demo-patient-12345",email:"demo.patient@example.com",emailVerified:!0,age:"45",weight:"75",phone:"+1-555-0123",gender:"Male",race:"Caucasian",language:"English",bloodGroup:"O",genotype:"Unknown",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"Diabetes",diagnosed:"2020",allergies:[],medications:[{name:"Metformin",dose:"500mg"}],additionalInfo:"Type 2 diabetes management",ecog:"0",diseaseStage:"Stage 2",biomarkers:"HbA1c 7.5%",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1})),localStorage.setItem("tc_health_profile_metadata_v1",JSON.stringify({location:"San Francisco, CA",radius:"50 miles",lat:37.7749,lng:-122.4194})),c(a),i("/patients/eligible")};return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(C,{}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-6",children:"Participant Login"}),h&&e.jsx("div",{className:"mb-4 rounded border border-amber-300 bg-amber-50 text-amber-800 px-3 py-2 text-sm",children:h}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"Email",type:"email",value:d,onChange:a=>b(a.target.value)}),p&&e.jsx("div",{className:"text-sm text-red-600",children:p}),e.jsx("button",{className:"w-full px-4 py-2 rounded bg-gray-900 text-white hover:bg-black disabled:opacity-50 disabled:cursor-not-allowed",type:"submit",disabled:u,children:u?"Redirecting...":"Continue with Microsoft"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:["No account? ",e.jsx(_,{to:"/patients/volunteer",className:"text-blue-600 hover:underline",children:"Sign up"})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3 text-center",children:"For testing purposes:"}),e.jsx("button",{onClick:v,className:"w-full inline-block rounded-full bg-gray-200 hover:bg-gray-300 text-gray-900 px-6 py-2 text-sm font-medium transition",children:"Login as Demo Patient"})]})]})]})}export{M as default};
