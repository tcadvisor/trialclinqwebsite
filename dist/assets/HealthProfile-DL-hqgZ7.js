import{c as ue,f as Oe,r as d,j as e,M as Fe,L as Le,i as ze}from"./index-BDmcj3uD.js";import{P as Je}from"./PatientHeader-DUXpnyx6.js";import{U as _e}from"./user-a-Cndfts.js";import{C as Ue}from"./calendar-mQxz9gH8.js";import{P as Ge}from"./phone-BCtrsRjL.js";import{P as U,T as xe}from"./trash-2-CbDtSY_E.js";import{P as ge}from"./plus-CnRJwx3r.js";import{C as Re}from"./circle-check-BQUl52ol.js";import"./HeaderActions-BxMjWePd.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ue("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ue("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=ue("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ue("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),Ve="/.netlify/functions";async function Ke(m,x){const p=await fetch(`${Ve}/profile-write`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:x||"Bearer anonymous"},body:JSON.stringify(m)});if(!p.ok){const f=await p.json();throw new Error(f.error||"Failed to save profile")}return console.log("✅ Profile saved to persistent storage"),p.json()}async function Ze(m,x,p){const f=new FormData;f.append("patientId",m),x.forEach(c=>{f.append("files",c)});const R=await fetch(`${Ve}/upload-file`,{method:"POST",headers:{Authorization:p||"Bearer anonymous"},body:f});if(!R.ok){const c=await R.json();throw new Error(c.error||"Failed to upload files")}const S=await R.json();return console.log("✅ Files uploaded successfully:",S.files),S.files}const q="tc_health_profile_v1",$e="tc_health_profile_metadata_v1",Qe=new Set(["application/pdf"]),Xe=new Set([".pdf"]),pe=({syncedAt:m})=>m?e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs",children:[e.jsx("span",{children:"Synced from EPIC"}),m&&e.jsxs("span",{className:"text-blue-600",children:["— ",m]})]}):null,D=({title:m,children:x,right:p})=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:m}),p]}),e.jsx("div",{className:"p-4",children:x})]}),h=({label:m,value:x,icon:p,missing:f,epicSyncedAt:R})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[p,e.jsx("span",{className:"text-sm",children:m})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm ${f?"text-red-600":"text-gray-900"}`,children:x||(f?"Required":"")}),R&&e.jsx(pe,{syncedAt:R})]})]});function et(m){if(m===0)return"0 B";const x=1024,p=["B","KB","MB","GB","TB"],f=Math.floor(Math.log(m)/Math.log(x));return`${parseFloat((m/Math.pow(x,f)).toFixed(2))} ${p[f]}`}function tt(m){const x=new Date(m);return`${x.getMonth()+1}/${x.getDate()}/${x.getFullYear()}`}function at({onCountChange:m}){const[x,p]=d.useState("Diagnostic Reports"),[f,R]=d.useState(""),[S,c]=d.useState(()=>{try{const r=localStorage.getItem("tc_docs");return r?JSON.parse(r):[]}catch{return[]}}),[T,s]=d.useState(1),l=10,V=d.useRef(null),{user:G}=Oe(),ie=G?`${G.firstName} ${G.lastName}`:"You",[F,g]=d.useState(null);d.useEffect(()=>{localStorage.setItem("tc_docs",JSON.stringify(S)),m==null||m(S.length)},[S,m]);const W=d.useMemo(()=>S.filter(o=>o.category===x&&o.name.toLowerCase().includes(f.toLowerCase())),[S,x,f]),B=Math.max(1,Math.ceil(W.length/l)),K=W.slice((T-1)*l,T*l);d.useEffect(()=>{T>B&&s(B)},[B,T]);const re=()=>{var r;return(r=V.current)==null?void 0:r.click()};function Z(){try{const r=localStorage.getItem(q);if(r){const o=JSON.parse(r);if(o!=null&&o.patientId)return String(o.patientId);if(o!=null&&o.profileId)return String(o.profileId)}}catch{}return null}function v(r){if(Qe.has(r.type))return!0;const o=r.name.includes(".")?`.${r.name.split(".").pop()}`.toLowerCase():"";return!!o&&Xe.has(o)}async function L(r){const o=window.__clinicalSummaryUploaderProps||{};g({mode:"loading",message:"AI is reviewing the document..."});const b=o.summarizeApiUrl,I=o.writeProfileApiUrl,E=o.authHeaderName||"Authorization",y=o.getAuthTokenClientFnName||"getAuthToken",M=o.showEligibilityBadges!==void 0?!!o.showEligibilityBadges:!0;if(!b||!I){g(null);return}const H=Z();if(!H){g({mode:"error",message:"Profile not found"});return}const X=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{const $=window,ee=$==null?void 0:$[y],N=typeof ee=="function"?await Promise.resolve(ee()):void 0;if(!N){g({mode:"error",message:"Authentication failed"});return}const Y=new FormData;Y.append("file",r),Y.append("profileId",H),Y.append("uploadId",X),Y.append("options.showEligibilityBadges",String(!!M));const oe=new AbortController,O=await Promise.race([fetch(b,{method:"POST",headers:{[E]:`Bearer ${N}`},body:Y,signal:oe.signal}),new Promise((w,j)=>setTimeout(()=>{try{oe.abort()}catch{}j(new Error("timeout"))},12e4))]);if(!O||!O.ok){let w="Summarization failed";const j=O==null?void 0:O.status;try{const A=await O.json();A!=null&&A.error&&(w=`Summarization failed: ${A.error}`)}catch{try{const A=await O.text();A&&(w=`Summarization failed: ${A}`)}catch{}}j===415?w="Summarization failed: Unsupported file type. Please upload a PDF.":j===422?w="Summarization failed: The document looks non-medical or unreadable.":j&&(w=`${w} (HTTP ${j})`),g({mode:"error",message:w});return}const P=await O.json();if(!(P!=null&&P.summaryMarkdown)){g({mode:"error",message:P!=null&&P.error?`Summarization failed: ${P.error}`:"Summarization failed: No summary generated"});return}const se=ze({summaryMarkdown:P.summaryMarkdown,eligibility:P.eligibility,audit:P.audit},!!M),ce=new AbortController;if(!(await Promise.race([fetch(I,{method:"PUT",headers:{"Content-Type":"application/json",[E]:`Bearer ${N}`},body:JSON.stringify({profileId:H,additionalInformationAppendMarkdown:se}),signal:ce.signal}),new Promise((w,j)=>setTimeout(()=>{try{ce.abort()}catch{}j(new Error("timeout"))},12e4))])).ok){g({mode:"error",message:"Save failed"});return}try{const w=localStorage.getItem(q);if(w){const j=JSON.parse(w),A=j.additionalInfo||"";j.additionalInfo=(A?A+`

`:"")+se,localStorage.setItem(q,JSON.stringify(j));try{await Ke({...j,additionalInformationAppendMarkdown:se},N)}catch(de){console.warn("Warning: Could not save to persistent storage:",de)}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"DocumentsUploader"}}))}catch{}}}catch{}g({mode:"success",message:"Summary saved to Additional Information"}),V.current&&(V.current.value=""),setTimeout(()=>g(null),2e3)}catch{g({mode:"error",message:"Upload failed"}),setTimeout(()=>g(null),2500)}}async function ne(r){if(!r||r.length===0)return;const o=Array.from(r),b=o.filter(y=>!v(y));if(b.length>0){const y=b.map(M=>M.name).join(", ");g({mode:"error",message:`Unsupported file type: ${y}. Use PDF.`}),setTimeout(()=>g(null),2500)}const I=o.filter(y=>v(y));if(I.length===0)return;g({mode:"loading",message:"Uploading files to secure storage..."});const E=Z();if(!E){g({mode:"error",message:"Patient ID not found"}),setTimeout(()=>g(null),2500);return}try{const y=window,H=y==null?void 0:y["getAuthToken"],X=typeof H=="function"?await Promise.resolve(H()):void 0,$=await Ze(E,I,X),ee=$.map(N=>({id:`${Date.now()}_${Math.random().toString(36).slice(2)}`,name:N.filename,size:N.size,type:"application/pdf",uploadedBy:ie,uploadedAt:Date.now(),category:x,url:N.url}));c(N=>[...ee,...N]),I.forEach(N=>L(N)),g({mode:"success",message:`${$.length} file(s) uploaded successfully`}),setTimeout(()=>g(null),2e3),V.current&&(V.current.value="")}catch(y){console.error("Upload error:",y),g({mode:"error",message:y.message||"Failed to upload files"}),setTimeout(()=>g(null),2500)}}function ae(r){const o=document.createElement("a");o.href=r.url,o.download=r.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function C(r){window.open(r.url,"_blank","noopener,noreferrer")}function z(r){const o=S.find(I=>I.id===r);if(!o)return;const b=prompt("Rename document",o.name);!b||b.trim()===""||c(I=>I.map(E=>E.id===r?{...E,name:b.trim()}:E))}function le(r){c(o=>o.filter(b=>b.id!==r))}const Q=d.useMemo(()=>({diagnostic:S.filter(r=>r.category==="Diagnostic Reports").length,lab:S.filter(r=>r.category==="Lab Reports").length}),[S]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("button",{onClick:()=>p("Diagnostic Reports"),className:`relative pb-2 ${x==="Diagnostic Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Diagnostic Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:Q.diagnostic})]}),e.jsxs("button",{onClick:()=>p("Lab Reports"),className:`relative pb-2 ${x==="Lab Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Lab Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:Q.lab})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:f,onChange:r=>R(r.target.value),className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"})}),e.jsx("button",{onClick:re,className:"inline-flex items-center gap-2 rounded-full bg-[#1033e5] text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Upload document"}),e.jsx("input",{ref:V,className:"hidden",type:"file",multiple:!0,accept:".pdf,application/pdf",onChange:r=>ne(r.target.files)})]})]}),F&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 flex items-center justify-center",role:"dialog","aria-live":"polite",children:e.jsxs("div",{className:"rounded-lg bg-white px-6 py-5 shadow-md text-center",children:[F.mode==="loading"&&e.jsx("div",{className:"mx-auto mb-3 h-6 w-6 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin","aria-hidden":"true"}),e.jsx("div",{className:`text-sm ${F.mode==="error"?"text-red-700":F.mode==="success"?"text-emerald-700":"text-gray-900"}`,children:F.message})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Document Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Uploaded By"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[K.map(r=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900",children:r.name}),e.jsx("span",{className:"text-xs text-gray-500",children:et(r.size)})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.uploadedBy}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:tt(r.uploadedAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>C(r),className:"rounded-full border px-3 py-1.5 text-xs hover:bg-gray-50 inline-flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"})," View"]}),e.jsx("button",{onClick:()=>ae(r),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"download",children:e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(r.id),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"rename",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>le(r.id),className:"p-1.5 text-red-600 hover:text-red-700","aria-label":"delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})})]},r.id)),K.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-600",children:"No documents yet"})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Page ",T," of ",B]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:T===1,onClick:()=>s(r=>Math.max(1,r-1)),className:`rounded-lg border px-3 py-1.5 ${T===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{disabled:T===B,onClick:()=>s(r=>Math.min(B,r+1)),className:`rounded-lg border px-3 py-1.5 ${T===B?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})]})]})]})}function xt(){var A,de,fe,ye,je,ve,be,Ne,we,Se,Ce,Ae,ke,Ie,Ee,Pe,De,Te,Me,He;const{user:m}=Oe(),[x,p]=d.useState("overview"),[f,R]=d.useState(()=>{try{const a=localStorage.getItem("tc_docs");return a?JSON.parse(a).length:0}catch{return 0}}),[S]=d.useState(()=>{try{return!localStorage.getItem(q)}catch{return!0}}),[c,T]=d.useState(()=>{try{const a=localStorage.getItem($e);if(a)return JSON.parse(a)}catch{}return{fieldSources:{}}}),[s,l]=d.useState(()=>{try{const a=localStorage.getItem(q);if(a)return JSON.parse(a)}catch{}return{patientId:"CUS_j2kthfmgv3bzr5r",email:"",emailVerified:!1,age:"",weight:"",phone:"",gender:"",race:"",language:"",bloodGroup:"",genotype:"",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"",diagnosed:"",allergies:[],medications:[],additionalInfo:"",ecog:"",diseaseStage:"",biomarkers:"",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1}});d.useEffect(()=>{try{const a=localStorage.getItem("epic:patient:v1");if(!a)return;const i=JSON.parse(a).profileData;if(!i)return;const n={...c.fieldSources},u={};i.age&&!s.age&&(u.age=i.age.value,n.age={value:i.age.value,source:"epic",syncedAt:i.age.syncedAt}),i.gender&&!s.gender&&(u.gender=i.gender.value,n.gender={value:i.gender.value,source:"epic",syncedAt:i.gender.syncedAt}),i.primaryCondition&&!s.primaryCondition&&(u.primaryCondition=i.primaryCondition.value,n.primaryCondition={value:i.primaryCondition.value,source:"epic",syncedAt:i.primaryCondition.syncedAt}),i.medications&&(!s.medications||s.medications.length===0)&&(u.medications=i.medications.value,n.medications={value:i.medications.value,source:"epic",syncedAt:i.medications.syncedAt}),i.allergies&&(!s.allergies||s.allergies.length===0)&&(u.allergies=i.allergies.value,n.allergies={value:i.allergies.value,source:"epic",syncedAt:i.allergies.syncedAt}),Object.keys(u).length>0&&(l(_=>({..._,...u})),T({fieldSources:n}),console.log("[HealthProfile] Auto-filled from EPIC data:",u))}catch(a){console.error("[HealthProfile] Error loading EPIC data:",a)}},[]),d.useEffect(()=>{l(a=>{let t={...a};(!t.email||t.email==="")&&(m!=null&&m.email)&&(t.email=m.email);try{const i=localStorage.getItem("tc_eligibility_profile");if(i){const n=JSON.parse(i),u=n.dob||"",_=()=>{if(!u)return"";const k=new Date(u);if(isNaN(k.getTime()))return"";const J=new Date;let te=J.getFullYear()-k.getFullYear();const me=J.getMonth()-k.getMonth();return(me<0||me===0&&J.getDate()<k.getDate())&&te--,String(te)};t.age||(t.age=n.age||_()),n.gender&&!t.gender&&(t.gender=n.gender),n.race&&!t.race&&(t.race=n.race),n.language&&!t.language&&(t.language=n.language),n.weight&&!t.weight&&(t.weight=n.weight),n.condition&&!t.primaryCondition&&(t.primaryCondition=n.condition),n.year&&!t.diagnosed&&(t.diagnosed=n.year)}}catch{}return Array.isArray(t.allergies)||(t.allergies=[]),Array.isArray(t.medications)||(t.medications=[]),Array.isArray(t.priorTherapies)||(t.priorTherapies=[]),typeof t.ecog!="string"&&(t.ecog=""),typeof t.diseaseStage!="string"&&(t.diseaseStage=""),typeof t.biomarkers!="string"&&(t.biomarkers=""),t.comorbidityCardiac=!!t.comorbidityCardiac,t.comorbidityRenal=!!t.comorbidityRenal,t.comorbidityHepatic=!!t.comorbidityHepatic,t.comorbidityAutoimmune=!!t.comorbidityAutoimmune,t.infectionHIV=!!t.infectionHIV,t.infectionHBV=!!t.infectionHBV,t.infectionHCV=!!t.infectionHCV,t})},[m]),d.useEffect(()=>{try{localStorage.setItem(q,JSON.stringify(s))}catch{}try{localStorage.setItem($e,JSON.stringify(c))}catch{}try{window.dispatchEvent(new Event("storage"))}catch{}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile"}}))}catch{}},[s,c]),d.useEffect(()=>{const a=t=>{var i;try{const n=localStorage.getItem(q);if(n){const u=JSON.parse(n);if(t instanceof CustomEvent&&((i=t.detail)==null?void 0:i.source)==="HealthProfile")return;l(u)}}catch{}};return window.addEventListener("tc_profile_updated",a),window.addEventListener("focus",a),window.addEventListener("visibilitychange",a),()=>{window.removeEventListener("tc_profile_updated",a),window.removeEventListener("focus",a),window.removeEventListener("visibilitychange",a)}},[]);const[V,G]=d.useState(!1),[ie,F]=d.useState(!1),[g,W]=d.useState(!1),[B,K]=d.useState(!1),[re,Z]=d.useState(!1),[v,L]=d.useState({name:"",reaction:"",severity:void 0,note:""}),[ne,ae]=d.useState(!1),[C,z]=d.useState({name:"",dose:"",amountDaily:"",schedule:""}),[le,Q]=d.useState(!1),[r,o]=d.useState({name:"",date:""}),[b,I]=d.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"";const t=JSON.parse(a);return String(t.loc||"")}catch{return""}}),[E,y]=d.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"50mi";const t=JSON.parse(a);return String(t.radius||"50mi")}catch{return"50mi"}}),[M,H]=d.useState("idle"),[X,$]=d.useState("");function ee(){H("saving");try{const a=localStorage.getItem("tc_eligibility_profile"),i={...a?JSON.parse(a):{},loc:b.trim(),radius:E};localStorage.setItem("tc_eligibility_profile",JSON.stringify(i)),window.dispatchEvent(new Event("storage"));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile",updated:["loc","radius"]}}))}catch{}$("Preferences saved"),H("saved"),setTimeout(()=>H("idle"),2e3)}catch{$("Could not save. Please try again."),H("error")}}function N(){Z(!0)}function Y(){v.name.trim()&&(l(a=>{var t,i;return{...a,allergies:[...a.allergies,{name:v.name.trim(),reaction:((t=v.reaction)==null?void 0:t.trim())||void 0,severity:v.severity,note:((i=v.note)==null?void 0:i.trim())||void 0}]}}),L({name:"",reaction:"",severity:void 0,note:""}),Z(!1))}function oe(){L({name:"",reaction:"",severity:void 0,note:""}),Z(!1)}function O(a){const t=s.allergies[a],i=prompt("Edit allergy name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit reaction (optional)",(t==null?void 0:t.reaction)||"")||void 0,u=prompt("Edit severity (Mild, Moderate, Severe) (optional)",(t==null?void 0:t.severity)||"")||void 0,_=u==="Mild"||u==="Moderate"||u==="Severe"?u:void 0,k=prompt("Edit notes (optional)",(t==null?void 0:t.note)||"")||void 0;l(J=>({...J,allergies:J.allergies.map((te,me)=>me===a?{name:i.trim(),reaction:(n==null?void 0:n.trim())||void 0,severity:_,note:(k==null?void 0:k.trim())||void 0}:te)}))}function P(a){l(t=>({...t,allergies:t.allergies.filter((i,n)=>n!==a)}))}function se(){ae(!0)}function ce(){C.name.trim()&&(l(a=>{var t,i,n;return{...a,medications:[...a.medications,{name:C.name.trim(),dose:((t=C.dose)==null?void 0:t.trim())||void 0,amountDaily:((i=C.amountDaily)==null?void 0:i.trim())||void 0,schedule:((n=C.schedule)==null?void 0:n.trim())||void 0}]}}),z({name:"",dose:"",amountDaily:"",schedule:""}),ae(!1))}function he(){z({name:"",dose:"",amountDaily:"",schedule:""}),ae(!1)}function w(a){const t=s.medications[a],i=prompt("Edit medication name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit dose (optional)",(t==null?void 0:t.dose)||"")||void 0,u=prompt("Edit amount taken daily (optional)",(t==null?void 0:t.amountDaily)||"")||void 0,_=prompt("Edit schedule (optional)",(t==null?void 0:t.schedule)||"")||void 0;l(k=>({...k,medications:k.medications.map((J,te)=>te===a?{name:i.trim(),dose:(n==null?void 0:n.trim())||void 0,amountDaily:(u==null?void 0:u.trim())||void 0,schedule:(_==null?void 0:_.trim())||void 0}:J)}))}function j(a){l(t=>({...t,medications:t.medications.filter((i,n)=>n!==a)}))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(Je,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Health Profile"}),(()=>{const a=m?`${m.firstName} ${m.lastName}`:"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-gray-700",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})})(),e.jsxs("div",{className:"mt-6 flex items-center gap-6 text-sm",children:[e.jsx("button",{onClick:()=>p("overview"),className:`relative pb-2 ${x==="overview"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>p("documents"),className:`relative pb-2 flex items-center gap-2 ${x==="documents"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Documents ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:f})]}),e.jsx("button",{onClick:()=>p("ehr"),className:`relative pb-2 ${x==="ehr"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Connected Medical Records"})]}),x==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Personal Details",right:V?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>G(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>G(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>G(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:V?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Patient ID",e.jsx("input",{value:s.patientId,onChange:a=>l(t=>({...t,patientId:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Email",e.jsx("input",{value:s.email,onChange:a=>l(t=>({...t,email:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Age",e.jsx("input",{value:s.age,onChange:a=>l(t=>({...t,age:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Weight",e.jsx("input",{value:s.weight,onChange:a=>l(t=>({...t,weight:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Phone Number",e.jsx("input",{value:s.phone,onChange:a=>l(t=>({...t,phone:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Gender",e.jsxs("select",{value:s.gender,onChange:a=>l(t=>({...t,gender:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Non-binary"}),e.jsx("option",{children:"Prefer not to say"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Race",e.jsx("input",{value:s.race,onChange:a=>l(t=>({...t,race:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Language Preference",e.jsx("input",{value:s.language,onChange:a=>l(t=>({...t,language:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsx("div",{className:"sm:col-span-2 flex items-center gap-2 text-sm mt-1",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s.emailVerified?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.emailVerified?"Verified":"Not verified"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"Patient ID",value:s.patientId,icon:e.jsx(_e,{className:"w-4 h-4"}),epicSyncedAt:(A=c.fieldSources.patientId)==null?void 0:A.syncedAt}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:`${s.emailVerified?"text-emerald-700":"text-amber-600"} text-xs`,children:s.emailVerified?"Verified":"Not verified"})]})]}),e.jsx(h,{label:"Age",value:s.age,icon:e.jsx(Ue,{className:"w-4 h-4"}),missing:!s.age,epicSyncedAt:(de=c.fieldSources.age)==null?void 0:de.syncedAt}),e.jsx(h,{label:"Weight",value:s.weight,icon:e.jsx(We,{className:"w-4 h-4"}),missing:!s.weight,epicSyncedAt:(fe=c.fieldSources.weight)==null?void 0:fe.syncedAt}),e.jsx(h,{label:"Phone Number",value:s.phone,icon:e.jsx(Ge,{className:"w-4 h-4"}),missing:!s.phone,epicSyncedAt:(ye=c.fieldSources.phone)==null?void 0:ye.syncedAt}),e.jsx(h,{label:"Gender",value:s.gender,icon:e.jsx(_e,{className:"w-4 h-4"}),missing:!s.gender,epicSyncedAt:(je=c.fieldSources.gender)==null?void 0:je.syncedAt}),e.jsx(h,{label:"Race",value:s.race,missing:!s.race,epicSyncedAt:(ve=c.fieldSources.race)==null?void 0:ve.syncedAt}),e.jsx(h,{label:"Language Preference",value:s.language,missing:!s.language,epicSyncedAt:(be=c.fieldSources.language)==null?void 0:be.syncedAt})]})})}),e.jsx("div",{children:e.jsxs(D,{title:"Allergies",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.allergies||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Ne=c.fieldSources.allergies)==null?void 0:Ne.syncedAt)&&e.jsx(pe,{syncedAt:c.fieldSources.allergies.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.allergies.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[a.name,a.severity&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700",children:a.severity})]}),(a.reaction||a.note)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.reaction,a.note].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>O(t),"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(t),"aria-label":"delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})]},t)),(s.allergies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No allergies added"})]}),re&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Allergy Name",e.jsx("input",{value:v.name,onChange:a=>L(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Severity",e.jsxs("select",{value:v.severity||"",onChange:a=>L(t=>({...t,severity:a.target.value||void 0})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Mild"}),e.jsx("option",{children:"Moderate"}),e.jsx("option",{children:"Severe"})]})]}),e.jsxs("label",{className:"text-gray-700",children:["Reaction",e.jsx("input",{value:v.reaction||"",onChange:a=>L(t=>({...t,reaction:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700 sm:col-span-2",children:["Notes",e.jsx("input",{value:v.note||"",onChange:a=>L(t=>({...t,note:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:oe,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:!v.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${v.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!re&&e.jsxs("button",{onClick:N,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another allergy"]})]})})]}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{title:"Travel Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Home location (City, State or ZIP)",e.jsx("input",{value:b,onChange:a=>I(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g. 10001 or Buffalo, NY"})]}),e.jsxs("label",{className:"text-gray-700",children:["Travel radius",e.jsx("select",{value:E,onChange:a=>y(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["25mi","50mi","100mi","200mi","300mi","500mi","1000mi"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ee,disabled:M==="saving",className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${M==="saving"?"bg-gray-400 text-white cursor-wait":"bg-gray-900 text-white"}`,children:M==="saving"?"Saving…":"Save"}),M==="saved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-emerald-700",children:[e.jsx(Re,{className:"w-4 h-4"})," ",X]}),M==="error"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Be,{className:"w-4 h-4"})," ",X]})]})]})}),e.jsxs(D,{title:"Medications",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.medications||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((we=c.fieldSources.medications)==null?void 0:we.syncedAt)&&e.jsx(pe,{syncedAt:c.fieldSources.medications.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.medications.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.name}),(a.dose||a.amountDaily||a.schedule)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.dose,a.amountDaily?`${a.amountDaily} per day`:"",a.schedule].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>w(t),"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(t),"aria-label":"delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})]},t)),(s.medications||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No medications listed"})]}),ne&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Medication Name",e.jsx("input",{value:C.name,onChange:a=>z(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Dose",e.jsx("input",{value:C.dose||"",onChange:a=>z(t=>({...t,dose:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Amount taken daily",e.jsx("input",{value:C.amountDaily||"",onChange:a=>z(t=>({...t,amountDaily:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Schedule",e.jsx("input",{value:C.schedule||"",onChange:a=>z(t=>({...t,schedule:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:he,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:!C.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${C.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!ne&&e.jsxs("button",{onClick:se,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another medication"]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Health Profile",right:ie?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>F(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>F(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:ie?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Blood Group",e.jsx("select",{value:s.bloodGroup,onChange:a=>l(t=>({...t,bloodGroup:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Genotype",e.jsx("input",{value:s.genotype,onChange:a=>l(t=>({...t,genotype:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Hearing Impaired",e.jsxs("select",{value:s.hearingImpaired?"Yes":"No",onChange:a=>l(t=>({...t,hearingImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Vision Impaired",e.jsxs("select",{value:s.visionImpaired?"Yes":"No",onChange:a=>l(t=>({...t,visionImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Primary Condition",e.jsx("input",{value:s.primaryCondition,onChange:a=>l(t=>({...t,primaryCondition:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Diagnosed",e.jsx("input",{value:s.diagnosed,onChange:a=>l(t=>({...t,diagnosed:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"Blood Group",value:s.bloodGroup,missing:!s.bloodGroup,epicSyncedAt:(Se=c.fieldSources.bloodGroup)==null?void 0:Se.syncedAt}),e.jsx(h,{label:"Genotype",value:s.genotype,missing:!s.genotype,epicSyncedAt:(Ce=c.fieldSources.genotype)==null?void 0:Ce.syncedAt}),e.jsx(h,{label:"Hearing Impaired",value:s.hearingImpaired?"Yes":"No",epicSyncedAt:(Ae=c.fieldSources.hearingImpaired)==null?void 0:Ae.syncedAt}),e.jsx(h,{label:"Vision Impaired",value:s.visionImpaired?"Yes":"No",epicSyncedAt:(ke=c.fieldSources.visionImpaired)==null?void 0:ke.syncedAt}),e.jsx(h,{label:"Primary Condition",value:s.primaryCondition,missing:!s.primaryCondition,epicSyncedAt:(Ie=c.fieldSources.primaryCondition)==null?void 0:Ie.syncedAt}),e.jsx(h,{label:"Diagnosed",value:s.diagnosed,missing:!s.diagnosed,epicSyncedAt:(Ee=c.fieldSources.diagnosed)==null?void 0:Ee.syncedAt})]})})})]}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Clinical Details",right:g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>W(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>W(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:g?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["ECOG Performance Status",e.jsx("select",{value:s.ecog,onChange:a=>l(t=>({...t,ecog:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["0","1","2","3","4"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Disease Stage/Grade/Subtype",e.jsx("input",{value:s.diseaseStage,onChange:a=>l(t=>({...t,diseaseStage:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., Stage II; ER+/HER2-"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Key Biomarkers",e.jsx("input",{value:s.biomarkers,onChange:a=>l(t=>({...t,biomarkers:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., PD-L1 50%, EGFR exon 19"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comorbidities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityCardiac,onChange:a=>l(t=>({...t,comorbidityCardiac:a.target.checked}))})," Cardiac"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityRenal,onChange:a=>l(t=>({...t,comorbidityRenal:a.target.checked}))})," Renal"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityHepatic,onChange:a=>l(t=>({...t,comorbidityHepatic:a.target.checked}))})," Hepatic"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityAutoimmune,onChange:a=>l(t=>({...t,comorbidityAutoimmune:a.target.checked}))})," Autoimmune"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Infections"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHIV,onChange:a=>l(t=>({...t,infectionHIV:a.target.checked}))})," HIV"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHBV,onChange:a=>l(t=>({...t,infectionHBV:a.target.checked}))})," Hepatitis B"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHCV,onChange:a=>l(t=>({...t,infectionHCV:a.target.checked}))})," Hepatitis C"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"ECOG",value:s.ecog,missing:!s.ecog,epicSyncedAt:(Pe=c.fieldSources.ecog)==null?void 0:Pe.syncedAt}),e.jsx(h,{label:"Disease Stage/Subtype",value:s.diseaseStage,missing:!s.diseaseStage,epicSyncedAt:(De=c.fieldSources.diseaseStage)==null?void 0:De.syncedAt}),e.jsx(h,{label:"Key Biomarkers",value:s.biomarkers,missing:!s.biomarkers,epicSyncedAt:(Te=c.fieldSources.biomarkers)==null?void 0:Te.syncedAt}),e.jsx(h,{label:"Comorbidities",value:[s.comorbidityCardiac&&"Cardiac",s.comorbidityRenal&&"Renal",s.comorbidityHepatic&&"Hepatic",s.comorbidityAutoimmune&&"Autoimmune"].filter(Boolean).join(", "),epicSyncedAt:(Me=c.fieldSources.comorbidity)==null?void 0:Me.syncedAt}),e.jsx(h,{label:"Infections",value:[s.infectionHIV&&"HIV",s.infectionHBV&&"HBV",s.infectionHCV&&"HCV"].filter(Boolean).join(", "),epicSyncedAt:(He=c.fieldSources.infection)==null?void 0:He.syncedAt})]})})})}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(D,{title:"Prior Treatments",children:[e.jsxs("ul",{className:"divide-y",children:[(s.priorTherapies||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[a.name,a.date?` — ${a.date}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>{const i=prompt("Edit therapy name",a.name)||a.name,n=prompt("Edit date (optional)",a.date||"")||void 0;l(u=>({...u,priorTherapies:u.priorTherapies.map((_,k)=>k===t?{name:i.trim(),date:n==null?void 0:n.trim()}:_)}))},"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(i=>({...i,priorTherapies:i.priorTherapies.filter((n,u)=>u!==t)})),"aria-label":"delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})]},t)),(s.priorTherapies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No prior treatments listed"})]}),le&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Therapy Name",e.jsx("input",{value:r.name,onChange:a=>o(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Date (optional)",e.jsx("input",{value:r.date||"",onChange:a=>o(t=>({...t,date:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{o({name:"",date:""}),Q(!1)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{r.name.trim()&&(l(a=>{var t;return{...a,priorTherapies:[...a.priorTherapies,{name:r.name.trim(),date:((t=r.date)==null?void 0:t.trim())||void 0}]}}),o({name:"",date:""}),Q(!1))},disabled:!r.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${r.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!le&&e.jsxs("button",{onClick:()=>Q(!0),className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add prior treatment"]})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Additional Information",right:B?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>K(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:B?e.jsx("textarea",{value:s.additionalInfo,onChange:a=>l(t=>({...t,additionalInfo:a.target.value})),rows:4,className:"w-full rounded-md border px-3 py-2 text-sm",placeholder:"Any important details you'd like us to know..."}):e.jsx("div",{className:"text-sm text-gray-700 min-h-[20px]",children:s.additionalInfo||"No additional information yet"})})}),!s.weight||!s.gender||!s.phone||!s.age||!s.race||!s.language||!s.bloodGroup||!s.genotype||!s.primaryCondition||!s.diagnosed||(s.allergies||[]).length===0||(s.medications||[]).length===0||!s.ecog||!s.diseaseStage?e.jsxs("div",{className:"mt-6 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Some details are missing. Please complete your profile."})]}):e.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{children:"Profile is up to date"})]})]}),x==="documents"&&e.jsx(at,{onCountChange:R}),x==="ehr"&&(()=>{const a=(()=>{try{const i=localStorage.getItem("epic:patient:v1");if(i)return JSON.parse(i)}catch{}return null})();if(!(a!=null&&a.patientData))return e.jsxs("div",{className:"mt-6 rounded-xl border bg-white p-4 text-sm text-gray-600",children:[e.jsx("p",{children:"No EHR/EMR connected yet."}),e.jsx(Le,{to:"/patients/ehr",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",children:"Connect EHR/EMR Provider"})]});const t=a.patientData;return e.jsxs("div",{className:"mt-6",children:[e.jsx(D,{title:"Connected Patient Information",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Patient ID"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Birth Date"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.birthDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gender"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.gender||"N/A"})]})]})}),Array.isArray(t.conditions)&&t.conditions.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Conditions",children:e.jsx("ul",{className:"divide-y",children:(t.conditions||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.display||i.code}),i.status&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status})]})},n))})})}),Array.isArray(t.medications)&&t.medications.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Medications",children:e.jsx("ul",{className:"divide-y",children:(t.medications||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.name}),(i.dosage||i.status)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.dosage,i.status].filter(Boolean).join(" • ")})]})},n))})})}),Array.isArray(t.allergies)&&t.allergies.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Allergies",children:e.jsx("ul",{className:"divide-y",children:(t.allergies||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.substance}),(i.reaction||i.severity)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.severity&&`Severity: ${i.severity}`,i.reaction].filter(Boolean).join(" • ")})]})},n))})})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{localStorage.removeItem("epic:tokens:v1"),localStorage.removeItem("epic:patient:v1"),window.location.reload()},className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Disconnect EHR"})})]})})()]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{xt as default};
