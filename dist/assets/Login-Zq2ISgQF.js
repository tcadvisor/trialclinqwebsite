import{e as _,u as w,f as L,r as m,R as E,g as v,j as e,L as C,s as H,h as k}from"./index-D6Ufhlin.js";import{H as R}from"./HomeHeader-Up37SKaB.js";import"./HeaderActions-BQWpB5F1.js";import"./search-CHzgFv4o.js";import"./shield-DQUYGTD0.js";function U(){var b;const i=_(),o=w(),{isAuthenticated:c,signIn:d,user:n}=L(),[p,N]=m.useState(""),[g,u]=m.useState(null),[f,h]=m.useState(!1),x=(b=o.state)==null?void 0:b.authMessage;E.useEffect(()=>{var t,s;if(c){const r=(s=(t=o.state)==null?void 0:t.from)==null?void 0:s.pathname,a=(n==null?void 0:n.role)==="provider"?"/providers/dashboard":"/patients/health-profile",l=v(r||a);i(l,{replace:!0})}},[c,i,o.state,n]);const S=async t=>{var s,r;t.preventDefault(),u(null),h(!0);try{const a=((r=(s=o.state)==null?void 0:s.from)==null?void 0:r.pathname)||"/patients/health-profile",l=p.trim();H(a),localStorage.setItem("pending_signup_v1",JSON.stringify({email:l,role:"patient"})),localStorage.setItem("pending_role_v1","patient");const y=await k({email:l,password:""});if(y){d({...y,role:"patient"});const I=v(a);localStorage.removeItem("pending_signup_v1"),localStorage.removeItem("pending_role_v1"),i(I,{replace:!0})}}catch(a){u(a instanceof Error?a.message:"Invalid email or password. Please try again.")}finally{h(!1)}},j=()=>{const t={email:"demo.patient@example.com",firstName:"Demo",lastName:"Patient",userId:"demo-patient-12345",role:"patient"};localStorage.setItem("tc_health_profile_v1",JSON.stringify({patientId:"demo-patient-12345",email:"demo.patient@example.com",emailVerified:!0,age:"45",weight:"75",phone:"+1-555-0123",gender:"Male",race:"Caucasian",language:"English",bloodGroup:"O",genotype:"Unknown",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"Diabetes",diagnosed:"2020",allergies:[],medications:[{name:"Metformin",dose:"500mg"}],additionalInfo:"Type 2 diabetes management",ecog:"0",diseaseStage:"Stage 2",biomarkers:"HbA1c 7.5%",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1})),localStorage.setItem("tc_health_profile_metadata_v1",JSON.stringify({location:"San Francisco, CA",radius:"50 miles",lat:37.7749,lng:-122.4194})),d(t),i("/patients/health-profile")};return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(R,{}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-6",children:"Participant Login"}),x&&e.jsx("div",{className:"mb-4 rounded border border-amber-300 bg-amber-50 text-amber-800 px-3 py-2 text-sm",children:x}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"Email",type:"email",value:p,required:!0,onChange:t=>N(t.target.value)}),g&&e.jsx("div",{className:"text-sm text-red-600",children:g}),e.jsx("button",{className:"w-full px-4 py-2 rounded bg-gray-900 text-white hover:bg-black disabled:opacity-50 disabled:cursor-not-allowed",type:"submit",disabled:f,children:f?"Redirecting...":"Continue with Microsoft"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:["No account? ",e.jsx(C,{to:"/patients/volunteer",className:"text-blue-600 hover:underline",children:"Sign up"})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3 text-center",children:"For testing purposes:"}),e.jsx("button",{onClick:j,className:"w-full inline-block rounded-full bg-gray-200 hover:bg-gray-300 text-gray-900 px-6 py-2 text-sm font-medium transition",children:"Login as Demo Patient"})]})]})]})}export{U as default};
