import{c as xe,j as e,f as ze,r as d,M as We,m as Ke,n as Ze,o as Qe,l as Xe}from"./index-CBwxkYER.js";import{P as et}from"./PatientHeader-DoeoFTrD.js";import{g as Ve,f as tt}from"./phoneValidation-6utpIYm-.js";import{U as Oe}from"./user-Cb5D_-X3.js";import{C as at}from"./calendar-lkSaHbUm.js";import{P as st}from"./phone-Bz0infZt.js";import{P as U,T as me}from"./trash-2-N-x9F49X.js";import{P as pe}from"./plus-BmxleI6A.js";import{C as Le}from"./circle-check-C2hD-DbK.js";import"./HeaderActions-enBcWTEF.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=xe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=xe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=xe("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),G="tc_health_profile_v1",Ue="tc_health_profile_metadata_v1",lt=new Set(["application/pdf"]),ot=new Set([".pdf"]),ye=({syncedAt:n})=>n?e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs",children:[e.jsx("span",{children:"Synced from EPIC"}),n&&e.jsxs("span",{className:"text-blue-600",children:["— ",n]})]}):null;function de(n){const p={patientId:"",email:"",emailVerified:!1,age:"",weight:"",phone:"",gender:"",race:"",language:"",bloodGroup:"",genotype:"",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"",diagnosed:"",allergies:[],medications:[],additionalInfo:"",ecog:"",diseaseStage:"",biomarkers:"",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1};return!n||typeof n!="object"?p:{patientId:String(n.patientId||""),email:String(n.email||""),emailVerified:!!n.emailVerified,age:String(n.age||""),weight:String(n.weight||""),phone:String(n.phone||""),gender:String(n.gender||""),race:String(n.race||""),language:String(n.language||""),bloodGroup:String(n.bloodGroup||""),genotype:String(n.genotype||""),hearingImpaired:!!n.hearingImpaired,visionImpaired:!!n.visionImpaired,primaryCondition:String(n.primaryCondition||""),diagnosed:String(n.diagnosed||""),allergies:Array.isArray(n.allergies)?n.allergies:[],medications:Array.isArray(n.medications)?n.medications:[],additionalInfo:String(n.additionalInfo||""),ecog:String(n.ecog||""),diseaseStage:String(n.diseaseStage||""),biomarkers:String(n.biomarkers||""),priorTherapies:Array.isArray(n.priorTherapies)?n.priorTherapies:[],comorbidityCardiac:!!n.comorbidityCardiac,comorbidityRenal:!!n.comorbidityRenal,comorbidityHepatic:!!n.comorbidityHepatic,comorbidityAutoimmune:!!n.comorbidityAutoimmune,infectionHIV:!!n.infectionHIV,infectionHBV:!!n.infectionHBV,infectionHCV:!!n.infectionHCV}}function he(n){const p={fieldSources:{}};if(!n||typeof n!="object")return p;const h=n.fieldSources;return{fieldSources:h&&typeof h=="object"?h:{}}}const P=({title:n,children:p,right:h})=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:n}),h]}),e.jsx("div",{className:"p-4",children:p})]}),j=({label:n,value:p,icon:h,missing:w,epicSyncedAt:J})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[h,e.jsx("span",{className:"text-sm",children:n})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm ${w?"text-red-600":"text-gray-900"}`,children:p||(w?"Required":"")}),J&&e.jsx(ye,{syncedAt:J})]})]});function ct(n){if(n===0)return"0 B";const p=1024,h=["B","KB","MB","GB","TB"],w=Math.floor(Math.log(n)/Math.log(p));return`${parseFloat((n/Math.pow(p,w)).toFixed(2))} ${h[w]}`}function dt(n){const p=new Date(n);return`${p.getMonth()+1}/${p.getDate()}/${p.getFullYear()}`}function mt({onCountChange:n}){const[p,h]=d.useState("Diagnostic Reports"),[w,J]=d.useState(""),[D,re]=d.useState(()=>{try{const r=localStorage.getItem("tc_docs");return r?JSON.parse(r):[]}catch{return[]}}),[b,$]=d.useState(1),m=10,L=d.useRef(null),{user:s}=ze(),ge=s?`${s.firstName} ${s.lastName}`:"You",[c,g]=d.useState(null);d.useEffect(()=>{localStorage.setItem("tc_docs",JSON.stringify(D)),n==null||n(D.length)},[D,n]);const K=d.useMemo(()=>D.filter(o=>o.category===p&&o.name.toLowerCase().includes(w.toLowerCase())),[D,p,w]),H=Math.max(1,Math.ceil(K.length/m)),Z=K.slice((b-1)*m,b*m);d.useEffect(()=>{b>H&&$(H)},[H,b]);const Q=()=>{var r;return(r=L.current)==null?void 0:r.click()};function X(){try{const r=localStorage.getItem(G);if(r){const o=JSON.parse(r);if(o!=null&&o.patientId)return String(o.patientId);if(o!=null&&o.profileId)return String(o.profileId)}}catch{}return null}function Y(r){if(lt.has(r.type))return!0;const o=r.name.includes(".")?`.${r.name.split(".").pop()}`.toLowerCase():"";return!!o&&ot.has(o)}async function le(r){const o=window.__clinicalSummaryUploaderProps||{};g({mode:"loading",message:"AI is reviewing the document..."});const y=o.summarizeApiUrl,C=o.writeProfileApiUrl,A=o.authHeaderName||"Authorization",u=o.getAuthTokenClientFnName||"getAuthToken",B=o.showEligibilityBadges!==void 0?!!o.showEligibilityBadges:!0;if(!y||!C){g(null);return}const V=X();if(!V){g({mode:"error",message:"Profile not found"});return}const se=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{const R=window,q=R==null?void 0:R[u],f=typeof q=="function"?await Promise.resolve(q()):void 0;if(!f){g({mode:"error",message:"Authentication failed"});return}const _=new FormData;_.append("file",r),_.append("profileId",V),_.append("uploadId",se),_.append("options.showEligibilityBadges",String(!!B));const ie=new AbortController,T=await Promise.race([fetch(y,{method:"POST",headers:{[A]:`Bearer ${f}`},body:_,signal:ie.signal}),new Promise((N,v)=>setTimeout(()=>{try{ie.abort()}catch{}v(new Error("timeout"))},12e4))]);if(!T||!T.ok){let N="Summarization failed";const v=T==null?void 0:T.status;try{const E=await T.json();E!=null&&E.error&&(N=`Summarization failed: ${E.error}`)}catch{try{const E=await T.text();E&&(N=`Summarization failed: ${E}`)}catch{}}v===415?N="Summarization failed: Unsupported file type. Please upload a PDF.":v===422?N="Summarization failed: The document looks non-medical or unreadable.":v&&(N=`${N} (HTTP ${v})`),g({mode:"error",message:N});return}const I=await T.json();if(!(I!=null&&I.summaryMarkdown)){g({mode:"error",message:I!=null&&I.error?`Summarization failed: ${I.error}`:"Summarization failed: No summary generated"});return}const ne=Ze({summaryMarkdown:I.summaryMarkdown,eligibility:I.eligibility,audit:I.audit},!!B),ce=new AbortController;if(!(await Promise.race([fetch(C,{method:"PUT",headers:{"Content-Type":"application/json",[A]:`Bearer ${f}`},body:JSON.stringify({profileId:V,additionalInformationAppendMarkdown:ne}),signal:ce.signal}),new Promise((N,v)=>setTimeout(()=>{try{ce.abort()}catch{}v(new Error("timeout"))},12e4))])).ok){g({mode:"error",message:"Save failed"});return}try{const N=localStorage.getItem(G);if(N){const v=JSON.parse(N),E=v.additionalInfo||"";v.additionalInfo=(E?E+`

`:"")+ne,localStorage.setItem(G,JSON.stringify(v));try{await Qe({...v,additionalInformationAppendMarkdown:ne},f)}catch(ue){console.warn("Warning: Could not save to persistent storage:",ue)}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"DocumentsUploader"}}))}catch{}}}catch{}g({mode:"success",message:"Summary saved to Additional Information"}),L.current&&(L.current.value=""),setTimeout(()=>g(null),2e3)}catch{g({mode:"error",message:"Upload failed"}),setTimeout(()=>g(null),2500)}}async function ee(r){if(!r||r.length===0)return;const o=Array.from(r),y=o.filter(u=>!Y(u));if(y.length>0){const u=y.map(B=>B.name).join(", ");g({mode:"error",message:`Unsupported file type: ${u}. Use PDF.`}),setTimeout(()=>g(null),2500)}const C=o.filter(u=>Y(u));if(C.length===0)return;g({mode:"loading",message:"Uploading files to secure storage..."});const A=X();if(!A){g({mode:"error",message:"Patient ID not found"}),setTimeout(()=>g(null),2500);return}try{const u=window,V=u==null?void 0:u["getAuthToken"],se=typeof V=="function"?await Promise.resolve(V()):void 0,R=await Ke(A,C,se),q=R.map(f=>({id:`${Date.now()}_${Math.random().toString(36).slice(2)}`,name:f.filename,size:f.size,type:"application/pdf",uploadedBy:ge,uploadedAt:Date.now(),category:p,url:f.url}));re(f=>[...q,...f]),C.forEach(f=>le(f)),g({mode:"success",message:`${R.length} file(s) uploaded successfully`}),setTimeout(()=>g(null),2e3),L.current&&(L.current.value="")}catch(u){console.error("Upload error:",u),g({mode:"error",message:u.message||"Failed to upload files"}),setTimeout(()=>g(null),2500)}}function oe(r){const o=document.createElement("a");o.href=r.url,o.download=r.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function te(r){window.open(r.url,"_blank","noopener,noreferrer")}function S(r){const o=D.find(C=>C.id===r);if(!o)return;const y=prompt("Rename document",o.name);!y||y.trim()===""||re(C=>C.map(A=>A.id===r?{...A,name:y.trim()}:A))}function F(r){re(o=>o.filter(y=>y.id!==r))}const ae=d.useMemo(()=>({diagnostic:D.filter(r=>r.category==="Diagnostic Reports").length,lab:D.filter(r=>r.category==="Lab Reports").length}),[D]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("button",{onClick:()=>h("Diagnostic Reports"),className:`relative pb-2 ${p==="Diagnostic Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Diagnostic Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:ae.diagnostic})]}),e.jsxs("button",{onClick:()=>h("Lab Reports"),className:`relative pb-2 ${p==="Lab Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Lab Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:ae.lab})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:w,onChange:r=>J(r.target.value),className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"})}),e.jsx("button",{onClick:Q,className:"inline-flex items-center gap-2 rounded-full bg-[#1033e5] text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Upload document"}),e.jsx("input",{ref:L,className:"hidden",type:"file",multiple:!0,accept:".pdf,application/pdf",onChange:r=>ee(r.target.files)})]})]}),c&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 flex items-center justify-center",role:"dialog","aria-live":"polite",children:e.jsxs("div",{className:"rounded-lg bg-white px-6 py-5 shadow-md text-center",children:[c.mode==="loading"&&e.jsx("div",{className:"mx-auto mb-3 h-6 w-6 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin","aria-hidden":"true"}),e.jsx("div",{className:`text-sm ${c.mode==="error"?"text-red-700":c.mode==="success"?"text-emerald-700":"text-gray-900"}`,children:c.message})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Document Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Uploaded By"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[Z.map(r=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900",children:r.name}),e.jsx("span",{className:"text-xs text-gray-500",children:ct(r.size)})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.uploadedBy}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:dt(r.uploadedAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>te(r),className:"rounded-full border px-3 py-1.5 text-xs hover:bg-gray-50 inline-flex items-center gap-1",children:[e.jsx(nt,{className:"w-4 h-4"})," View"]}),e.jsx("button",{onClick:()=>oe(r),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"download",children:e.jsx(it,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(r.id),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"rename",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(r.id),className:"p-1.5 text-red-600 hover:text-red-700","aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},r.id)),Z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-600",children:"No documents yet"})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Page ",b," of ",H]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:b===1,onClick:()=>$(r=>Math.max(1,r-1)),className:`rounded-lg border px-3 py-1.5 ${b===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{disabled:b===H,onClick:()=>$(r=>Math.min(H,r+1)),className:`rounded-lg border px-3 py-1.5 ${b===H?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})]})]})]})}function xt(){var je,ve,be,Ne,we,Se,Ce,Ae,ke,Ie,Ee,Pe,De,He,Te,Me,Be,Re,_e,$e;const{user:n,isLoading:p}=ze(),[h,w]=d.useState("overview"),[J,D]=d.useState(()=>{try{const a=localStorage.getItem("tc_docs");return a?JSON.parse(a).length:0}catch{return 0}}),[re]=d.useState(()=>{try{return!localStorage.getItem(G)}catch{return!0}}),[b,$]=d.useState(null),[m,L]=d.useState(()=>{try{const a=localStorage.getItem(Ue);if(a)return he(JSON.parse(a))}catch{}return he(null)}),[s,ge]=d.useState(()=>{try{const a=localStorage.getItem(G);if(a){const t=JSON.parse(a);return de(t)}}catch{}return de(null)}),c=a=>{ge(t=>{const i=typeof a=="function"?a(t):a;return de(i)})},g=a=>{L(t=>{const i=typeof a=="function"?a(t):a;return he(i)})};d.useEffect(()=>{try{const a=localStorage.getItem("epic:patient:v1");if(!a)return;const i=JSON.parse(a).profileData;if(!i)return;const l={...m.fieldSources},x={};i.age&&!s.age&&(x.age=i.age.value,l.age={value:i.age.value,source:"epic",syncedAt:i.age.syncedAt}),i.gender&&!s.gender&&(x.gender=i.gender.value,l.gender={value:i.gender.value,source:"epic",syncedAt:i.gender.syncedAt}),i.primaryCondition&&!s.primaryCondition&&(x.primaryCondition=i.primaryCondition.value,l.primaryCondition={value:i.primaryCondition.value,source:"epic",syncedAt:i.primaryCondition.syncedAt}),i.medications&&(!s.medications||s.medications.length===0)&&(x.medications=i.medications.value,l.medications={value:i.medications.value,source:"epic",syncedAt:i.medications.syncedAt}),i.allergies&&(!s.allergies||s.allergies.length===0)&&(x.allergies=i.allergies.value,l.allergies={value:i.allergies.value,source:"epic",syncedAt:i.allergies.syncedAt}),Object.keys(x).length>0&&(c(M=>({...M,...x})),g({fieldSources:l}),console.log("[HealthProfile] Auto-filled from EPIC data:",x))}catch(a){console.error("[HealthProfile] Error loading EPIC data:",a)}},[]),d.useEffect(()=>{c(a=>{let t={...a};if(n){const i=Xe(n);i&&(!t.patientId||t.patientId==="")&&(t.patientId=i)}(!t.email||t.email==="")&&(n!=null&&n.email)&&(t.email=n.email);try{const i=localStorage.getItem("tc_eligibility_profile");if(i){const l=JSON.parse(i),x=l.dob||"",M=()=>{if(!x)return"";const k=new Date(x);if(isNaN(k.getTime()))return"";const O=new Date;let z=O.getFullYear()-k.getFullYear();const W=O.getMonth()-k.getMonth();return(W<0||W===0&&O.getDate()<k.getDate())&&z--,String(z)};t.age||(t.age=l.age||M()),l.gender&&!t.gender&&(t.gender=l.gender),l.race&&!t.race&&(t.race=l.race),l.language&&!t.language&&(t.language=l.language),l.weight&&!t.weight&&(t.weight=l.weight),l.condition&&!t.primaryCondition&&(t.primaryCondition=l.condition),l.year&&!t.diagnosed&&(t.diagnosed=l.year)}}catch{}return Array.isArray(t.allergies)||(t.allergies=[]),Array.isArray(t.medications)||(t.medications=[]),Array.isArray(t.priorTherapies)||(t.priorTherapies=[]),typeof t.ecog!="string"&&(t.ecog=""),typeof t.diseaseStage!="string"&&(t.diseaseStage=""),typeof t.biomarkers!="string"&&(t.biomarkers=""),t.comorbidityCardiac=!!t.comorbidityCardiac,t.comorbidityRenal=!!t.comorbidityRenal,t.comorbidityHepatic=!!t.comorbidityHepatic,t.comorbidityAutoimmune=!!t.comorbidityAutoimmune,t.infectionHIV=!!t.infectionHIV,t.infectionHBV=!!t.infectionHBV,t.infectionHCV=!!t.infectionHCV,t})},[n]),d.useEffect(()=>{try{localStorage.setItem(G,JSON.stringify(s))}catch{}try{localStorage.setItem(Ue,JSON.stringify(m))}catch{}try{window.dispatchEvent(new Event("storage"))}catch{}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile"}}))}catch{}},[s,m]),d.useEffect(()=>{const a=t=>{var i;try{const l=localStorage.getItem(G);if(l){const x=JSON.parse(l);if(t instanceof CustomEvent&&((i=t.detail)==null?void 0:i.source)==="HealthProfile")return;c(de(x))}}catch{}};return window.addEventListener("tc_profile_updated",a),window.addEventListener("focus",a),window.addEventListener("visibilitychange",a),()=>{window.removeEventListener("tc_profile_updated",a),window.removeEventListener("focus",a),window.removeEventListener("visibilitychange",a)}},[]);const[K,H]=d.useState(!1),[Z,Q]=d.useState(!1),[X,Y]=d.useState(!1),[le,ee]=d.useState(!1),[oe,te]=d.useState(!1),[S,F]=d.useState({name:"",reaction:"",severity:void 0,note:""}),[ae,r]=d.useState(!1),[o,y]=d.useState({name:"",dose:"",amountDaily:"",schedule:""}),[C,A]=d.useState(!1),[u,B]=d.useState({name:"",date:""}),[V,se]=d.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"";const t=JSON.parse(a);return String(t.loc||"")}catch{return""}}),[R,q]=d.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"50mi";const t=JSON.parse(a);return String(t.radius||"50mi")}catch{return"50mi"}}),[f,_]=d.useState("idle"),[ie,T]=d.useState("");function I(){_("saving");try{const a=localStorage.getItem("tc_eligibility_profile"),i={...a?JSON.parse(a):{},loc:V.trim(),radius:R};localStorage.setItem("tc_eligibility_profile",JSON.stringify(i)),window.dispatchEvent(new Event("storage"));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile",updated:["loc","radius"]}}))}catch{}T("Preferences saved"),_("saved"),setTimeout(()=>_("idle"),2e3)}catch{T("Could not save. Please try again."),_("error")}}function ne(){te(!0)}function ce(){S.name.trim()&&(c(a=>{var t,i;return{...a,allergies:[...a.allergies,{name:S.name.trim(),reaction:((t=S.reaction)==null?void 0:t.trim())||void 0,severity:S.severity,note:((i=S.note)==null?void 0:i.trim())||void 0}]}}),F({name:"",reaction:"",severity:void 0,note:""}),te(!1))}function fe(){F({name:"",reaction:"",severity:void 0,note:""}),te(!1)}function N(a){var O;if(!((O=s==null?void 0:s.allergies)!=null&&O[a]))return;const t=s.allergies[a],i=prompt("Edit allergy name",t==null?void 0:t.name);if(!i)return;const l=prompt("Edit reaction (optional)",(t==null?void 0:t.reaction)||"")||void 0,x=prompt("Edit severity (Mild, Moderate, Severe) (optional)",(t==null?void 0:t.severity)||"")||void 0,M=x==="Mild"||x==="Moderate"||x==="Severe"?x:void 0,k=prompt("Edit notes (optional)",(t==null?void 0:t.note)||"")||void 0;c(z=>({...z,allergies:z.allergies.map((W,qe)=>qe===a?{name:i.trim(),reaction:(l==null?void 0:l.trim())||void 0,severity:M,note:(k==null?void 0:k.trim())||void 0}:W)}))}function v(a){c(t=>({...t,allergies:t.allergies.filter((i,l)=>l!==a)}))}function E(){r(!0)}function ue(){o.name.trim()&&(c(a=>{var t,i,l;return{...a,medications:[...a.medications,{name:o.name.trim(),dose:((t=o.dose)==null?void 0:t.trim())||void 0,amountDaily:((i=o.amountDaily)==null?void 0:i.trim())||void 0,schedule:((l=o.schedule)==null?void 0:l.trim())||void 0}]}}),y({name:"",dose:"",amountDaily:"",schedule:""}),r(!1))}function Ge(){y({name:"",dose:"",amountDaily:"",schedule:""}),r(!1)}function Je(a){var k;if(!((k=s==null?void 0:s.medications)!=null&&k[a]))return;const t=s.medications[a],i=prompt("Edit medication name",t==null?void 0:t.name);if(!i)return;const l=prompt("Edit dose (optional)",(t==null?void 0:t.dose)||"")||void 0,x=prompt("Edit amount taken daily (optional)",(t==null?void 0:t.amountDaily)||"")||void 0,M=prompt("Edit schedule (optional)",(t==null?void 0:t.schedule)||"")||void 0;c(O=>({...O,medications:O.medications.map((z,W)=>W===a?{name:i.trim(),dose:(l==null?void 0:l.trim())||void 0,amountDaily:(x==null?void 0:x.trim())||void 0,schedule:(M==null?void 0:M.trim())||void 0}:z)}))}function Ye(a){c(t=>({...t,medications:t.medications.filter((i,l)=>l!==a)}))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(et,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Health Profile"}),(()=>{const a=n?`${n.firstName} ${n.lastName}`:"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-gray-700",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})})(),e.jsxs("div",{className:"mt-6 flex items-center gap-6 text-sm",children:[e.jsx("button",{onClick:()=>w("overview"),className:`relative pb-2 ${h==="overview"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>w("documents"),className:`relative pb-2 flex items-center gap-2 ${h==="documents"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Documents ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:J})]}),e.jsx("button",{onClick:()=>w("ehr"),className:`relative pb-2 ${h==="ehr"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Connected Medical Records"})]}),h==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(P,{title:"Personal Details",right:K?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{H(!1),$(null)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(s.phone.trim()){const a=Ve(s.phone,"US");if(a){$(a);return}}H(!1),$(null)},className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>H(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:K?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Patient ID",e.jsx("input",{value:(s==null?void 0:s.patientId)||"",onChange:a=>c(t=>({...t,patientId:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Email",e.jsx("input",{value:(s==null?void 0:s.email)||"",onChange:a=>c(t=>({...t,email:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Age",e.jsx("input",{value:(s==null?void 0:s.age)||"",onChange:a=>c(t=>({...t,age:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Weight",e.jsx("input",{value:(s==null?void 0:s.weight)||"",onChange:a=>c(t=>({...t,weight:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Phone Number",e.jsx("input",{value:(s==null?void 0:s.phone)||"",onChange:a=>{const t=tt(a.target.value,"US");c(i=>({...i,phone:t})),b&&$(null)},onBlur:()=>{if(((s==null?void 0:s.phone)||"").trim()){const a=Ve((s==null?void 0:s.phone)||"","US");$(a)}},className:`mt-1 w-full rounded-md border px-3 py-2 ${b?"border-red-500":""}`})]}),b&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:b})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Gender",e.jsxs("select",{value:s.gender,onChange:a=>c(t=>({...t,gender:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Non-binary"}),e.jsx("option",{children:"Prefer not to say"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Race",e.jsx("input",{value:s.race,onChange:a=>c(t=>({...t,race:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Language Preference",e.jsx("input",{value:s.language,onChange:a=>c(t=>({...t,language:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsx("div",{className:"sm:col-span-2 flex items-center gap-2 text-sm mt-1",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s.emailVerified?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.emailVerified?"Verified":"Not verified"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(j,{label:"Patient ID",value:s.patientId,icon:e.jsx(Oe,{className:"w-4 h-4"}),epicSyncedAt:(je=m.fieldSources.patientId)==null?void 0:je.syncedAt}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:`${s.emailVerified?"text-emerald-700":"text-amber-600"} text-xs`,children:s.emailVerified?"Verified":"Not verified"})]})]}),e.jsx(j,{label:"Age",value:s.age,icon:e.jsx(at,{className:"w-4 h-4"}),missing:!s.age,epicSyncedAt:(ve=m.fieldSources.age)==null?void 0:ve.syncedAt}),e.jsx(j,{label:"Weight",value:s.weight,icon:e.jsx(rt,{className:"w-4 h-4"}),missing:!s.weight,epicSyncedAt:(be=m.fieldSources.weight)==null?void 0:be.syncedAt}),e.jsx(j,{label:"Phone Number",value:s.phone,icon:e.jsx(st,{className:"w-4 h-4"}),missing:!s.phone,epicSyncedAt:(Ne=m.fieldSources.phone)==null?void 0:Ne.syncedAt}),e.jsx(j,{label:"Gender",value:s.gender,icon:e.jsx(Oe,{className:"w-4 h-4"}),missing:!s.gender,epicSyncedAt:(we=m.fieldSources.gender)==null?void 0:we.syncedAt}),e.jsx(j,{label:"Race",value:s.race,missing:!s.race,epicSyncedAt:(Se=m.fieldSources.race)==null?void 0:Se.syncedAt}),e.jsx(j,{label:"Language Preference",value:s.language,missing:!s.language,epicSyncedAt:(Ce=m.fieldSources.language)==null?void 0:Ce.syncedAt})]})})}),e.jsx("div",{children:e.jsxs(P,{title:"Allergies",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.allergies||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Ae=m.fieldSources.allergies)==null?void 0:Ae.syncedAt)&&e.jsx(ye,{syncedAt:m.fieldSources.allergies.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[((s==null?void 0:s.allergies)||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[a.name,a.severity&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700",children:a.severity})]}),(a.reaction||a.note)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.reaction,a.note].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>N(t),"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.allergies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No allergies added"})]}),oe&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Allergy Name",e.jsx("input",{value:S.name,onChange:a=>F(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Severity",e.jsxs("select",{value:S.severity||"",onChange:a=>F(t=>({...t,severity:a.target.value||void 0})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Mild"}),e.jsx("option",{children:"Moderate"}),e.jsx("option",{children:"Severe"})]})]}),e.jsxs("label",{className:"text-gray-700",children:["Reaction",e.jsx("input",{value:S.reaction||"",onChange:a=>F(t=>({...t,reaction:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700 sm:col-span-2",children:["Notes",e.jsx("input",{value:S.note||"",onChange:a=>F(t=>({...t,note:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:fe,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:!S.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${S.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!oe&&e.jsxs("button",{onClick:ne,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(pe,{className:"w-4 h-4"})," Add another allergy"]})]})})]}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{title:"Travel Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Home location (City, State or ZIP)",e.jsx("input",{value:V,onChange:a=>se(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g. 10001 or Buffalo, NY"})]}),e.jsxs("label",{className:"text-gray-700",children:["Travel radius",e.jsx("select",{value:R,onChange:a=>q(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["25mi","50mi","100mi","200mi","300mi","500mi","1000mi"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,disabled:f==="saving",className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${f==="saving"?"bg-gray-400 text-white cursor-wait":"bg-gray-900 text-white"}`,children:f==="saving"?"Saving…":"Save"}),f==="saved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-emerald-700",children:[e.jsx(Le,{className:"w-4 h-4"})," ",ie]}),f==="error"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Fe,{className:"w-4 h-4"})," ",ie]})]})]})}),e.jsxs(P,{title:"Medications",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.medications||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((ke=m.fieldSources.medications)==null?void 0:ke.syncedAt)&&e.jsx(ye,{syncedAt:m.fieldSources.medications.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[((s==null?void 0:s.medications)||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.name}),(a.dose||a.amountDaily||a.schedule)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.dose,a.amountDaily?`${a.amountDaily} per day`:"",a.schedule].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>Je(t),"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ye(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.medications||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No medications listed"})]}),ae&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Medication Name",e.jsx("input",{value:o.name,onChange:a=>y(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Dose",e.jsx("input",{value:o.dose||"",onChange:a=>y(t=>({...t,dose:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Amount taken daily",e.jsx("input",{value:o.amountDaily||"",onChange:a=>y(t=>({...t,amountDaily:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Schedule",e.jsx("input",{value:o.schedule||"",onChange:a=>y(t=>({...t,schedule:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:Ge,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:ue,disabled:!o.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${o.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!ae&&e.jsxs("button",{onClick:E,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(pe,{className:"w-4 h-4"})," Add another medication"]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(P,{title:"Health Profile",right:Z?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Q(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:Z?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Blood Group",e.jsx("select",{value:s.bloodGroup,onChange:a=>c(t=>({...t,bloodGroup:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Genotype",e.jsx("input",{value:s.genotype,onChange:a=>c(t=>({...t,genotype:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Hearing Impaired",e.jsxs("select",{value:s.hearingImpaired?"Yes":"No",onChange:a=>c(t=>({...t,hearingImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Vision Impaired",e.jsxs("select",{value:s.visionImpaired?"Yes":"No",onChange:a=>c(t=>({...t,visionImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Primary Condition",e.jsx("input",{value:s.primaryCondition,onChange:a=>c(t=>({...t,primaryCondition:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Diagnosed",e.jsx("input",{value:s.diagnosed,onChange:a=>c(t=>({...t,diagnosed:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(j,{label:"Blood Group",value:s.bloodGroup,missing:!s.bloodGroup,epicSyncedAt:(Ie=m.fieldSources.bloodGroup)==null?void 0:Ie.syncedAt}),e.jsx(j,{label:"Genotype",value:s.genotype,missing:!s.genotype,epicSyncedAt:(Ee=m.fieldSources.genotype)==null?void 0:Ee.syncedAt}),e.jsx(j,{label:"Hearing Impaired",value:s.hearingImpaired?"Yes":"No",epicSyncedAt:(Pe=m.fieldSources.hearingImpaired)==null?void 0:Pe.syncedAt}),e.jsx(j,{label:"Vision Impaired",value:s.visionImpaired?"Yes":"No",epicSyncedAt:(De=m.fieldSources.visionImpaired)==null?void 0:De.syncedAt}),e.jsx(j,{label:"Primary Condition",value:s.primaryCondition,missing:!s.primaryCondition,epicSyncedAt:(He=m.fieldSources.primaryCondition)==null?void 0:He.syncedAt}),e.jsx(j,{label:"Diagnosed",value:s.diagnosed,missing:!s.diagnosed,epicSyncedAt:(Te=m.fieldSources.diagnosed)==null?void 0:Te.syncedAt})]})})})]}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(P,{title:"Clinical Details",right:X?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Y(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Y(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Y(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:X?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["ECOG Performance Status",e.jsx("select",{value:s.ecog,onChange:a=>c(t=>({...t,ecog:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["0","1","2","3","4"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Disease Stage/Grade/Subtype",e.jsx("input",{value:s.diseaseStage,onChange:a=>c(t=>({...t,diseaseStage:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., Stage II; ER+/HER2-"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Key Biomarkers",e.jsx("input",{value:s.biomarkers,onChange:a=>c(t=>({...t,biomarkers:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., PD-L1 50%, EGFR exon 19"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comorbidities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityCardiac,onChange:a=>c(t=>({...t,comorbidityCardiac:a.target.checked}))})," Cardiac"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityRenal,onChange:a=>c(t=>({...t,comorbidityRenal:a.target.checked}))})," Renal"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityHepatic,onChange:a=>c(t=>({...t,comorbidityHepatic:a.target.checked}))})," Hepatic"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityAutoimmune,onChange:a=>c(t=>({...t,comorbidityAutoimmune:a.target.checked}))})," Autoimmune"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Infections"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHIV,onChange:a=>c(t=>({...t,infectionHIV:a.target.checked}))})," HIV"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHBV,onChange:a=>c(t=>({...t,infectionHBV:a.target.checked}))})," Hepatitis B"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHCV,onChange:a=>c(t=>({...t,infectionHCV:a.target.checked}))})," Hepatitis C"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(j,{label:"ECOG",value:s.ecog,missing:!s.ecog,epicSyncedAt:(Me=m.fieldSources.ecog)==null?void 0:Me.syncedAt}),e.jsx(j,{label:"Disease Stage/Subtype",value:s.diseaseStage,missing:!s.diseaseStage,epicSyncedAt:(Be=m.fieldSources.diseaseStage)==null?void 0:Be.syncedAt}),e.jsx(j,{label:"Key Biomarkers",value:s.biomarkers,missing:!s.biomarkers,epicSyncedAt:(Re=m.fieldSources.biomarkers)==null?void 0:Re.syncedAt}),e.jsx(j,{label:"Comorbidities",value:[s.comorbidityCardiac&&"Cardiac",s.comorbidityRenal&&"Renal",s.comorbidityHepatic&&"Hepatic",s.comorbidityAutoimmune&&"Autoimmune"].filter(Boolean).join(", "),epicSyncedAt:(_e=m.fieldSources.comorbidity)==null?void 0:_e.syncedAt}),e.jsx(j,{label:"Infections",value:[s.infectionHIV&&"HIV",s.infectionHBV&&"HBV",s.infectionHCV&&"HCV"].filter(Boolean).join(", "),epicSyncedAt:($e=m.fieldSources.infection)==null?void 0:$e.syncedAt})]})})})}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(P,{title:"Prior Treatments",children:[e.jsxs("ul",{className:"divide-y",children:[(s.priorTherapies||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[a.name,a.date?` — ${a.date}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>{const i=prompt("Edit therapy name",a.name)||a.name,l=prompt("Edit date (optional)",a.date||"")||void 0;c(x=>({...x,priorTherapies:x.priorTherapies.map((M,k)=>k===t?{name:i.trim(),date:l==null?void 0:l.trim()}:M)}))},"aria-label":"edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(i=>({...i,priorTherapies:i.priorTherapies.filter((l,x)=>x!==t)})),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.priorTherapies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No prior treatments listed"})]}),C&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Therapy Name",e.jsx("input",{value:u.name,onChange:a=>B(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Date (optional)",e.jsx("input",{value:u.date||"",onChange:a=>B(t=>({...t,date:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{B({name:"",date:""}),A(!1)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{u.name.trim()&&(c(a=>{var t;return{...a,priorTherapies:[...a.priorTherapies,{name:u.name.trim(),date:((t=u.date)==null?void 0:t.trim())||void 0}]}}),B({name:"",date:""}),A(!1))},disabled:!u.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${u.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!C&&e.jsxs("button",{onClick:()=>A(!0),className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(pe,{className:"w-4 h-4"})," Add prior treatment"]})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(P,{title:"Additional Information",right:le?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ee(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>ee(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>ee(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(U,{className:"w-4 h-4"})," Edit"]}),children:le?e.jsx("textarea",{value:s.additionalInfo,onChange:a=>c(t=>({...t,additionalInfo:a.target.value})),rows:4,className:"w-full rounded-md border px-3 py-2 text-sm",placeholder:"Any important details you'd like us to know..."}):e.jsx("div",{className:"text-sm text-gray-700 min-h-[20px]",children:s.additionalInfo||"No additional information yet"})})}),!s.weight||!s.gender||!s.phone||!s.age||!s.race||!s.language||!s.bloodGroup||!s.genotype||!s.primaryCondition||!s.diagnosed||(s.allergies||[]).length===0||(s.medications||[]).length===0||!s.ecog||!s.diseaseStage?e.jsxs("div",{className:"mt-6 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Some details are missing. Please complete your profile."})]}):e.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{children:"Profile is up to date"})]})]}),h==="documents"&&e.jsx(mt,{onCountChange:D}),h==="ehr"&&(()=>{const a=(()=>{try{const i=localStorage.getItem("epic:patient:v1");if(i)return JSON.parse(i)}catch{}return null})();if(!(a!=null&&a.patientData))return e.jsxs("div",{className:"mt-6 rounded-xl border bg-white p-4 text-sm text-gray-600",children:[e.jsx("p",{children:"No EHR/EMR connected yet."}),e.jsx("button",{type:"button",disabled:!0,className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-gray-200 text-gray-500 px-4 py-2 text-sm cursor-not-allowed","aria-disabled":"true",children:"Feature coming soon"})]});const t=a.patientData;return e.jsxs("div",{className:"mt-6",children:[e.jsx(P,{title:"Connected Patient Information",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Patient ID"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Birth Date"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.birthDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gender"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.gender||"N/A"})]})]})}),Array.isArray(t.conditions)&&t.conditions.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(P,{title:"Conditions",children:e.jsx("ul",{className:"divide-y",children:(t.conditions||[]).map((i,l)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.display||i.code}),i.status&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status})]})},l))})})}),Array.isArray(t.medications)&&t.medications.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(P,{title:"Medications",children:e.jsx("ul",{className:"divide-y",children:(t.medications||[]).map((i,l)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.name}),(i.dosage||i.status)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.dosage,i.status].filter(Boolean).join(" • ")})]})},l))})})}),Array.isArray(t.allergies)&&t.allergies.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(P,{title:"Allergies",children:e.jsx("ul",{className:"divide-y",children:(t.allergies||[]).map((i,l)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.substance}),(i.reaction||i.severity)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.severity&&`Severity: ${i.severity}`,i.reaction].filter(Boolean).join(" • ")})]})},l))})})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{localStorage.removeItem("epic:tokens:v1"),localStorage.removeItem("epic:patient:v1"),window.location.reload()},className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Disconnect EHR"})})]})})()]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}function wt(){try{return e.jsx(xt,{})}catch(n){return console.error("[HealthProfile] Error rendering:",n),e.jsx("div",{className:"min-h-screen bg-gray-50 text-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Unable to load profile"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please refresh the page or try again later."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",children:"Refresh Page"})]})})}}export{wt as default};
