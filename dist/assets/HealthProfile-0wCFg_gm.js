import{c as xe,f as Fe,r as c,i as Ue,j as e,M as ze,L as Ge,k as Je,l as Ye,m as qe}from"./index-DLD9h1BK.js";import{P as We}from"./PatientHeader-D7OzikkY.js";import{g as Be,f as Ke}from"./phoneValidation-6utpIYm-.js";import{U as $e}from"./user-CGGIt3ra.js";import{C as Ze}from"./calendar-CEjk7p_b.js";import{P as Qe}from"./phone-B9b2OQfb.js";import{P as G,T as me}from"./trash-2-BiObfVBB.js";import{P as ue}from"./plus-C8cswCOj.js";import{C as Ve}from"./circle-check-DRcuEXYq.js";import"./HeaderActions-VMSc5EzH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=xe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=xe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=xe("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),q="tc_health_profile_v1",Le="tc_health_profile_metadata_v1",at=new Set(["application/pdf"]),st=new Set([".pdf"]),pe=({syncedAt:d})=>d?e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs",children:[e.jsx("span",{children:"Synced from EPIC"}),d&&e.jsxs("span",{className:"text-blue-600",children:["— ",d]})]}):null,D=({title:d,children:g,right:A})=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:d}),A]}),e.jsx("div",{className:"p-4",children:g})]}),h=({label:d,value:g,icon:A,missing:T,epicSyncedAt:W})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[A,e.jsx("span",{className:"text-sm",children:d})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm ${T?"text-red-600":"text-gray-900"}`,children:g||(T?"Required":"")}),W&&e.jsx(pe,{syncedAt:W})]})]});function it(d){if(d===0)return"0 B";const g=1024,A=["B","KB","MB","GB","TB"],T=Math.floor(Math.log(d)/Math.log(g));return`${parseFloat((d/Math.pow(g,T)).toFixed(2))} ${A[T]}`}function lt(d){const g=new Date(d);return`${g.getMonth()+1}/${g.getDate()}/${g.getFullYear()}`}function nt({onCountChange:d}){const[g,A]=c.useState("Diagnostic Reports"),[T,W]=c.useState(""),[H,O]=c.useState(()=>{try{const l=localStorage.getItem("tc_docs");return l?JSON.parse(l):[]}catch{return[]}}),[y,m]=c.useState(1),ee=10,s=c.useRef(null),{user:r}=Fe(),le=r?`${r.firstName} ${r.lastName}`:"You",[B,u]=c.useState(null);c.useEffect(()=>{localStorage.setItem("tc_docs",JSON.stringify(H)),d==null||d(H.length)},[H,d]);const K=c.useMemo(()=>H.filter(o=>o.category===g&&o.name.toLowerCase().includes(T.toLowerCase())),[H,g,T]),R=Math.max(1,Math.ceil(K.length/ee)),Z=K.slice((y-1)*ee,y*ee);c.useEffect(()=>{y>R&&m(R)},[R,y]);const ne=()=>{var l;return(l=s.current)==null?void 0:l.click()};function Q(){try{const l=localStorage.getItem(q);if(l){const o=JSON.parse(l);if(o!=null&&o.patientId)return String(o.patientId);if(o!=null&&o.profileId)return String(o.profileId)}}catch{}return null}function te(l){if(at.has(l.type))return!0;const o=l.name.includes(".")?`.${l.name.split(".").pop()}`.toLowerCase():"";return!!o&&st.has(o)}async function ae(l){const o=window.__clinicalSummaryUploaderProps||{};u({mode:"loading",message:"AI is reviewing the document..."});const p=o.summarizeApiUrl,j=o.writeProfileApiUrl,k=o.authHeaderName||"Authorization",f=o.getAuthTokenClientFnName||"getAuthToken",F=o.showEligibilityBadges!==void 0?!!o.showEligibilityBadges:!0;if(!p||!j){u(null);return}const U=Q();if(!U){u({mode:"error",message:"Profile not found"});return}const V=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{const I=window,J=I==null?void 0:I[f],v=typeof J=="function"?await Promise.resolve(J()):void 0;if(!v){u({mode:"error",message:"Authentication failed"});return}const Y=new FormData;Y.append("file",l),Y.append("profileId",U),Y.append("uploadId",V),Y.append("options.showEligibilityBadges",String(!!F));const oe=new AbortController,_=await Promise.race([fetch(p,{method:"POST",headers:{[k]:`Bearer ${v}`},body:Y,signal:oe.signal}),new Promise((N,b)=>setTimeout(()=>{try{oe.abort()}catch{}b(new Error("timeout"))},12e4))]);if(!_||!_.ok){let N="Summarization failed";const b=_==null?void 0:_.status;try{const P=await _.json();P!=null&&P.error&&(N=`Summarization failed: ${P.error}`)}catch{try{const P=await _.text();P&&(N=`Summarization failed: ${P}`)}catch{}}b===415?N="Summarization failed: Unsupported file type. Please upload a PDF.":b===422?N="Summarization failed: The document looks non-medical or unreadable.":b&&(N=`${N} (HTTP ${b})`),u({mode:"error",message:N});return}const E=await _.json();if(!(E!=null&&E.summaryMarkdown)){u({mode:"error",message:E!=null&&E.error?`Summarization failed: ${E.error}`:"Summarization failed: No summary generated"});return}const ie=Ye({summaryMarkdown:E.summaryMarkdown,eligibility:E.eligibility,audit:E.audit},!!F),ce=new AbortController;if(!(await Promise.race([fetch(j,{method:"PUT",headers:{"Content-Type":"application/json",[k]:`Bearer ${v}`},body:JSON.stringify({profileId:U,additionalInformationAppendMarkdown:ie}),signal:ce.signal}),new Promise((N,b)=>setTimeout(()=>{try{ce.abort()}catch{}b(new Error("timeout"))},12e4))])).ok){u({mode:"error",message:"Save failed"});return}try{const N=localStorage.getItem(q);if(N){const b=JSON.parse(N),P=b.additionalInfo||"";b.additionalInfo=(P?P+`

`:"")+ie,localStorage.setItem(q,JSON.stringify(b));try{await qe({...b,additionalInformationAppendMarkdown:ie},v)}catch(ge){console.warn("Warning: Could not save to persistent storage:",ge)}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"DocumentsUploader"}}))}catch{}}}catch{}u({mode:"success",message:"Summary saved to Additional Information"}),s.current&&(s.current.value=""),setTimeout(()=>u(null),2e3)}catch{u({mode:"error",message:"Upload failed"}),setTimeout(()=>u(null),2500)}}async function w(l){if(!l||l.length===0)return;const o=Array.from(l),p=o.filter(f=>!te(f));if(p.length>0){const f=p.map(F=>F.name).join(", ");u({mode:"error",message:`Unsupported file type: ${f}. Use PDF.`}),setTimeout(()=>u(null),2500)}const j=o.filter(f=>te(f));if(j.length===0)return;u({mode:"loading",message:"Uploading files to secure storage..."});const k=Q();if(!k){u({mode:"error",message:"Patient ID not found"}),setTimeout(()=>u(null),2500);return}try{const f=window,U=f==null?void 0:f["getAuthToken"],V=typeof U=="function"?await Promise.resolve(U()):void 0,I=await Je(k,j,V),J=I.map(v=>({id:`${Date.now()}_${Math.random().toString(36).slice(2)}`,name:v.filename,size:v.size,type:"application/pdf",uploadedBy:le,uploadedAt:Date.now(),category:g,url:v.url}));O(v=>[...J,...v]),j.forEach(v=>ae(v)),u({mode:"success",message:`${I.length} file(s) uploaded successfully`}),setTimeout(()=>u(null),2e3),s.current&&(s.current.value="")}catch(f){console.error("Upload error:",f),u({mode:"error",message:f.message||"Failed to upload files"}),setTimeout(()=>u(null),2500)}}function L(l){const o=document.createElement("a");o.href=l.url,o.download=l.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function re(l){window.open(l.url,"_blank","noopener,noreferrer")}function se(l){const o=H.find(j=>j.id===l);if(!o)return;const p=prompt("Rename document",o.name);!p||p.trim()===""||O(j=>j.map(k=>k.id===l?{...k,name:p.trim()}:k))}function S(l){O(o=>o.filter(p=>p.id!==l))}const $=c.useMemo(()=>({diagnostic:H.filter(l=>l.category==="Diagnostic Reports").length,lab:H.filter(l=>l.category==="Lab Reports").length}),[H]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("button",{onClick:()=>A("Diagnostic Reports"),className:`relative pb-2 ${g==="Diagnostic Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Diagnostic Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:$.diagnostic})]}),e.jsxs("button",{onClick:()=>A("Lab Reports"),className:`relative pb-2 ${g==="Lab Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Lab Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:$.lab})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:T,onChange:l=>W(l.target.value),className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"})}),e.jsx("button",{onClick:ne,className:"inline-flex items-center gap-2 rounded-full bg-[#1033e5] text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Upload document"}),e.jsx("input",{ref:s,className:"hidden",type:"file",multiple:!0,accept:".pdf,application/pdf",onChange:l=>w(l.target.files)})]})]}),B&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 flex items-center justify-center",role:"dialog","aria-live":"polite",children:e.jsxs("div",{className:"rounded-lg bg-white px-6 py-5 shadow-md text-center",children:[B.mode==="loading"&&e.jsx("div",{className:"mx-auto mb-3 h-6 w-6 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin","aria-hidden":"true"}),e.jsx("div",{className:`text-sm ${B.mode==="error"?"text-red-700":B.mode==="success"?"text-emerald-700":"text-gray-900"}`,children:B.message})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Document Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Uploaded By"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[Z.map(l=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900",children:l.name}),e.jsx("span",{className:"text-xs text-gray-500",children:it(l.size)})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:l.uploadedBy}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:lt(l.uploadedAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>re(l),className:"rounded-full border px-3 py-1.5 text-xs hover:bg-gray-50 inline-flex items-center gap-1",children:[e.jsx(et,{className:"w-4 h-4"})," View"]}),e.jsx("button",{onClick:()=>L(l),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"download",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>se(l.id),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"rename",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(l.id),className:"p-1.5 text-red-600 hover:text-red-700","aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},l.id)),Z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-600",children:"No documents yet"})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Page ",y," of ",R]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:y===1,onClick:()=>m(l=>Math.max(1,l-1)),className:`rounded-lg border px-3 py-1.5 ${y===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{disabled:y===R,onClick:()=>m(l=>Math.min(R,l+1)),className:`rounded-lg border px-3 py-1.5 ${y===R?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})]})]})]})}function ft(){var fe,ye,je,ve,be,Ne,we,Se,Ce,Ae,ke,Ie,Ee,Pe,De,Te,Me,He,Re,_e;const{user:d}=Fe(),[g,A]=c.useState("overview"),[T,W]=c.useState(()=>{try{const a=localStorage.getItem("tc_docs");return a?JSON.parse(a).length:0}catch{return 0}}),[H]=c.useState(()=>{try{return!localStorage.getItem(q)}catch{return!0}}),[O,y]=c.useState(null),[m,ee]=c.useState(()=>{try{const a=localStorage.getItem(Le);if(a)return JSON.parse(a)}catch{}return{fieldSources:{}}}),[s,r]=c.useState(()=>{try{const a=localStorage.getItem(q);if(a)return JSON.parse(a)}catch{}return{patientId:"",email:"",emailVerified:!1,age:"",weight:"",phone:"",gender:"",race:"",language:"",bloodGroup:"",genotype:"",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"",diagnosed:"",allergies:[],medications:[],additionalInfo:"",ecog:"",diseaseStage:"",biomarkers:"",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1}});c.useEffect(()=>{try{const a=localStorage.getItem("epic:patient:v1");if(!a)return;const i=JSON.parse(a).profileData;if(!i)return;const n={...m.fieldSources},x={};i.age&&!s.age&&(x.age=i.age.value,n.age={value:i.age.value,source:"epic",syncedAt:i.age.syncedAt}),i.gender&&!s.gender&&(x.gender=i.gender.value,n.gender={value:i.gender.value,source:"epic",syncedAt:i.gender.syncedAt}),i.primaryCondition&&!s.primaryCondition&&(x.primaryCondition=i.primaryCondition.value,n.primaryCondition={value:i.primaryCondition.value,source:"epic",syncedAt:i.primaryCondition.syncedAt}),i.medications&&(!s.medications||s.medications.length===0)&&(x.medications=i.medications.value,n.medications={value:i.medications.value,source:"epic",syncedAt:i.medications.syncedAt}),i.allergies&&(!s.allergies||s.allergies.length===0)&&(x.allergies=i.allergies.value,n.allergies={value:i.allergies.value,source:"epic",syncedAt:i.allergies.syncedAt}),Object.keys(x).length>0&&(r(M=>({...M,...x})),ee({fieldSources:n}),console.log("[HealthProfile] Auto-filled from EPIC data:",x))}catch(a){console.error("[HealthProfile] Error loading EPIC data:",a)}},[]),c.useEffect(()=>{r(a=>{let t={...a};if(d){const i=Ue(d);i&&(!t.patientId||t.patientId==="")&&(t.patientId=i)}(!t.email||t.email==="")&&(d!=null&&d.email)&&(t.email=d.email);try{const i=localStorage.getItem("tc_eligibility_profile");if(i){const n=JSON.parse(i),x=n.dob||"",M=()=>{if(!x)return"";const C=new Date(x);if(isNaN(C.getTime()))return"";const z=new Date;let X=z.getFullYear()-C.getFullYear();const de=z.getMonth()-C.getMonth();return(de<0||de===0&&z.getDate()<C.getDate())&&X--,String(X)};t.age||(t.age=n.age||M()),n.gender&&!t.gender&&(t.gender=n.gender),n.race&&!t.race&&(t.race=n.race),n.language&&!t.language&&(t.language=n.language),n.weight&&!t.weight&&(t.weight=n.weight),n.condition&&!t.primaryCondition&&(t.primaryCondition=n.condition),n.year&&!t.diagnosed&&(t.diagnosed=n.year)}}catch{}return Array.isArray(t.allergies)||(t.allergies=[]),Array.isArray(t.medications)||(t.medications=[]),Array.isArray(t.priorTherapies)||(t.priorTherapies=[]),typeof t.ecog!="string"&&(t.ecog=""),typeof t.diseaseStage!="string"&&(t.diseaseStage=""),typeof t.biomarkers!="string"&&(t.biomarkers=""),t.comorbidityCardiac=!!t.comorbidityCardiac,t.comorbidityRenal=!!t.comorbidityRenal,t.comorbidityHepatic=!!t.comorbidityHepatic,t.comorbidityAutoimmune=!!t.comorbidityAutoimmune,t.infectionHIV=!!t.infectionHIV,t.infectionHBV=!!t.infectionHBV,t.infectionHCV=!!t.infectionHCV,t})},[d]),c.useEffect(()=>{try{localStorage.setItem(q,JSON.stringify(s))}catch{}try{localStorage.setItem(Le,JSON.stringify(m))}catch{}try{window.dispatchEvent(new Event("storage"))}catch{}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile"}}))}catch{}},[s,m]),c.useEffect(()=>{const a=t=>{var i;try{const n=localStorage.getItem(q);if(n){const x=JSON.parse(n);if(t instanceof CustomEvent&&((i=t.detail)==null?void 0:i.source)==="HealthProfile")return;r(x)}}catch{}};return window.addEventListener("tc_profile_updated",a),window.addEventListener("focus",a),window.addEventListener("visibilitychange",a),()=>{window.removeEventListener("tc_profile_updated",a),window.removeEventListener("focus",a),window.removeEventListener("visibilitychange",a)}},[]);const[le,B]=c.useState(!1),[u,K]=c.useState(!1),[R,Z]=c.useState(!1),[ne,Q]=c.useState(!1),[te,ae]=c.useState(!1),[w,L]=c.useState({name:"",reaction:"",severity:void 0,note:""}),[re,se]=c.useState(!1),[S,$]=c.useState({name:"",dose:"",amountDaily:"",schedule:""}),[l,o]=c.useState(!1),[p,j]=c.useState({name:"",date:""}),[k,f]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"";const t=JSON.parse(a);return String(t.loc||"")}catch{return""}}),[F,U]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"50mi";const t=JSON.parse(a);return String(t.radius||"50mi")}catch{return"50mi"}}),[V,I]=c.useState("idle"),[J,v]=c.useState("");function Y(){I("saving");try{const a=localStorage.getItem("tc_eligibility_profile"),i={...a?JSON.parse(a):{},loc:k.trim(),radius:F};localStorage.setItem("tc_eligibility_profile",JSON.stringify(i)),window.dispatchEvent(new Event("storage"));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile",updated:["loc","radius"]}}))}catch{}v("Preferences saved"),I("saved"),setTimeout(()=>I("idle"),2e3)}catch{v("Could not save. Please try again."),I("error")}}function oe(){ae(!0)}function _(){w.name.trim()&&(r(a=>{var t,i;return{...a,allergies:[...a.allergies,{name:w.name.trim(),reaction:((t=w.reaction)==null?void 0:t.trim())||void 0,severity:w.severity,note:((i=w.note)==null?void 0:i.trim())||void 0}]}}),L({name:"",reaction:"",severity:void 0,note:""}),ae(!1))}function E(){L({name:"",reaction:"",severity:void 0,note:""}),ae(!1)}function ie(a){const t=s.allergies[a],i=prompt("Edit allergy name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit reaction (optional)",(t==null?void 0:t.reaction)||"")||void 0,x=prompt("Edit severity (Mild, Moderate, Severe) (optional)",(t==null?void 0:t.severity)||"")||void 0,M=x==="Mild"||x==="Moderate"||x==="Severe"?x:void 0,C=prompt("Edit notes (optional)",(t==null?void 0:t.note)||"")||void 0;r(z=>({...z,allergies:z.allergies.map((X,de)=>de===a?{name:i.trim(),reaction:(n==null?void 0:n.trim())||void 0,severity:M,note:(C==null?void 0:C.trim())||void 0}:X)}))}function ce(a){r(t=>({...t,allergies:t.allergies.filter((i,n)=>n!==a)}))}function he(){se(!0)}function N(){S.name.trim()&&(r(a=>{var t,i,n;return{...a,medications:[...a.medications,{name:S.name.trim(),dose:((t=S.dose)==null?void 0:t.trim())||void 0,amountDaily:((i=S.amountDaily)==null?void 0:i.trim())||void 0,schedule:((n=S.schedule)==null?void 0:n.trim())||void 0}]}}),$({name:"",dose:"",amountDaily:"",schedule:""}),se(!1))}function b(){$({name:"",dose:"",amountDaily:"",schedule:""}),se(!1)}function P(a){const t=s.medications[a],i=prompt("Edit medication name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit dose (optional)",(t==null?void 0:t.dose)||"")||void 0,x=prompt("Edit amount taken daily (optional)",(t==null?void 0:t.amountDaily)||"")||void 0,M=prompt("Edit schedule (optional)",(t==null?void 0:t.schedule)||"")||void 0;r(C=>({...C,medications:C.medications.map((z,X)=>X===a?{name:i.trim(),dose:(n==null?void 0:n.trim())||void 0,amountDaily:(x==null?void 0:x.trim())||void 0,schedule:(M==null?void 0:M.trim())||void 0}:z)}))}function ge(a){r(t=>({...t,medications:t.medications.filter((i,n)=>n!==a)}))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(We,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Health Profile"}),(()=>{const a=d?`${d.firstName} ${d.lastName}`:"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-gray-700",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})})(),e.jsxs("div",{className:"mt-6 flex items-center gap-6 text-sm",children:[e.jsx("button",{onClick:()=>A("overview"),className:`relative pb-2 ${g==="overview"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>A("documents"),className:`relative pb-2 flex items-center gap-2 ${g==="documents"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Documents ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:T})]}),e.jsx("button",{onClick:()=>A("ehr"),className:`relative pb-2 ${g==="ehr"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Connected Medical Records"})]}),g==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Personal Details",right:le?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{B(!1),y(null)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(s.phone.trim()){const a=Be(s.phone,"US");if(a){y(a);return}}B(!1),y(null)},className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>B(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:le?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Patient ID",e.jsx("input",{value:s.patientId,onChange:a=>r(t=>({...t,patientId:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Email",e.jsx("input",{value:s.email,onChange:a=>r(t=>({...t,email:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Age",e.jsx("input",{value:s.age,onChange:a=>r(t=>({...t,age:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Weight",e.jsx("input",{value:s.weight,onChange:a=>r(t=>({...t,weight:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Phone Number",e.jsx("input",{value:s.phone,onChange:a=>{const t=Ke(a.target.value,"US");r(i=>({...i,phone:t})),O&&y(null)},onBlur:()=>{if(s.phone.trim()){const a=Be(s.phone,"US");y(a)}},className:`mt-1 w-full rounded-md border px-3 py-2 ${O?"border-red-500":""}`})]}),O&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:O})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Gender",e.jsxs("select",{value:s.gender,onChange:a=>r(t=>({...t,gender:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Non-binary"}),e.jsx("option",{children:"Prefer not to say"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Race",e.jsx("input",{value:s.race,onChange:a=>r(t=>({...t,race:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Language Preference",e.jsx("input",{value:s.language,onChange:a=>r(t=>({...t,language:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsx("div",{className:"sm:col-span-2 flex items-center gap-2 text-sm mt-1",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s.emailVerified?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.emailVerified?"Verified":"Not verified"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"Patient ID",value:s.patientId,icon:e.jsx($e,{className:"w-4 h-4"}),epicSyncedAt:(fe=m.fieldSources.patientId)==null?void 0:fe.syncedAt}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:`${s.emailVerified?"text-emerald-700":"text-amber-600"} text-xs`,children:s.emailVerified?"Verified":"Not verified"})]})]}),e.jsx(h,{label:"Age",value:s.age,icon:e.jsx(Ze,{className:"w-4 h-4"}),missing:!s.age,epicSyncedAt:(ye=m.fieldSources.age)==null?void 0:ye.syncedAt}),e.jsx(h,{label:"Weight",value:s.weight,icon:e.jsx(tt,{className:"w-4 h-4"}),missing:!s.weight,epicSyncedAt:(je=m.fieldSources.weight)==null?void 0:je.syncedAt}),e.jsx(h,{label:"Phone Number",value:s.phone,icon:e.jsx(Qe,{className:"w-4 h-4"}),missing:!s.phone,epicSyncedAt:(ve=m.fieldSources.phone)==null?void 0:ve.syncedAt}),e.jsx(h,{label:"Gender",value:s.gender,icon:e.jsx($e,{className:"w-4 h-4"}),missing:!s.gender,epicSyncedAt:(be=m.fieldSources.gender)==null?void 0:be.syncedAt}),e.jsx(h,{label:"Race",value:s.race,missing:!s.race,epicSyncedAt:(Ne=m.fieldSources.race)==null?void 0:Ne.syncedAt}),e.jsx(h,{label:"Language Preference",value:s.language,missing:!s.language,epicSyncedAt:(we=m.fieldSources.language)==null?void 0:we.syncedAt})]})})}),e.jsx("div",{children:e.jsxs(D,{title:"Allergies",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.allergies||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Se=m.fieldSources.allergies)==null?void 0:Se.syncedAt)&&e.jsx(pe,{syncedAt:m.fieldSources.allergies.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.allergies.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[a.name,a.severity&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700",children:a.severity})]}),(a.reaction||a.note)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.reaction,a.note].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>ie(t),"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.allergies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No allergies added"})]}),te&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Allergy Name",e.jsx("input",{value:w.name,onChange:a=>L(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Severity",e.jsxs("select",{value:w.severity||"",onChange:a=>L(t=>({...t,severity:a.target.value||void 0})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Mild"}),e.jsx("option",{children:"Moderate"}),e.jsx("option",{children:"Severe"})]})]}),e.jsxs("label",{className:"text-gray-700",children:["Reaction",e.jsx("input",{value:w.reaction||"",onChange:a=>L(t=>({...t,reaction:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700 sm:col-span-2",children:["Notes",e.jsx("input",{value:w.note||"",onChange:a=>L(t=>({...t,note:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:E,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:!w.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${w.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!te&&e.jsxs("button",{onClick:oe,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ue,{className:"w-4 h-4"})," Add another allergy"]})]})})]}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{title:"Travel Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Home location (City, State or ZIP)",e.jsx("input",{value:k,onChange:a=>f(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g. 10001 or Buffalo, NY"})]}),e.jsxs("label",{className:"text-gray-700",children:["Travel radius",e.jsx("select",{value:F,onChange:a=>U(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["25mi","50mi","100mi","200mi","300mi","500mi","1000mi"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Y,disabled:V==="saving",className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${V==="saving"?"bg-gray-400 text-white cursor-wait":"bg-gray-900 text-white"}`,children:V==="saving"?"Saving…":"Save"}),V==="saved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-emerald-700",children:[e.jsx(Ve,{className:"w-4 h-4"})," ",J]}),V==="error"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Oe,{className:"w-4 h-4"})," ",J]})]})]})}),e.jsxs(D,{title:"Medications",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.medications||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Ce=m.fieldSources.medications)==null?void 0:Ce.syncedAt)&&e.jsx(pe,{syncedAt:m.fieldSources.medications.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.medications.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.name}),(a.dose||a.amountDaily||a.schedule)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.dose,a.amountDaily?`${a.amountDaily} per day`:"",a.schedule].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>P(t),"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ge(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.medications||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No medications listed"})]}),re&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Medication Name",e.jsx("input",{value:S.name,onChange:a=>$(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Dose",e.jsx("input",{value:S.dose||"",onChange:a=>$(t=>({...t,dose:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Amount taken daily",e.jsx("input",{value:S.amountDaily||"",onChange:a=>$(t=>({...t,amountDaily:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Schedule",e.jsx("input",{value:S.schedule||"",onChange:a=>$(t=>({...t,schedule:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:!S.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${S.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!re&&e.jsxs("button",{onClick:he,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ue,{className:"w-4 h-4"})," Add another medication"]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Health Profile",right:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>K(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:u?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Blood Group",e.jsx("select",{value:s.bloodGroup,onChange:a=>r(t=>({...t,bloodGroup:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Genotype",e.jsx("input",{value:s.genotype,onChange:a=>r(t=>({...t,genotype:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Hearing Impaired",e.jsxs("select",{value:s.hearingImpaired?"Yes":"No",onChange:a=>r(t=>({...t,hearingImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Vision Impaired",e.jsxs("select",{value:s.visionImpaired?"Yes":"No",onChange:a=>r(t=>({...t,visionImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Primary Condition",e.jsx("input",{value:s.primaryCondition,onChange:a=>r(t=>({...t,primaryCondition:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Diagnosed",e.jsx("input",{value:s.diagnosed,onChange:a=>r(t=>({...t,diagnosed:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"Blood Group",value:s.bloodGroup,missing:!s.bloodGroup,epicSyncedAt:(Ae=m.fieldSources.bloodGroup)==null?void 0:Ae.syncedAt}),e.jsx(h,{label:"Genotype",value:s.genotype,missing:!s.genotype,epicSyncedAt:(ke=m.fieldSources.genotype)==null?void 0:ke.syncedAt}),e.jsx(h,{label:"Hearing Impaired",value:s.hearingImpaired?"Yes":"No",epicSyncedAt:(Ie=m.fieldSources.hearingImpaired)==null?void 0:Ie.syncedAt}),e.jsx(h,{label:"Vision Impaired",value:s.visionImpaired?"Yes":"No",epicSyncedAt:(Ee=m.fieldSources.visionImpaired)==null?void 0:Ee.syncedAt}),e.jsx(h,{label:"Primary Condition",value:s.primaryCondition,missing:!s.primaryCondition,epicSyncedAt:(Pe=m.fieldSources.primaryCondition)==null?void 0:Pe.syncedAt}),e.jsx(h,{label:"Diagnosed",value:s.diagnosed,missing:!s.diagnosed,epicSyncedAt:(De=m.fieldSources.diagnosed)==null?void 0:De.syncedAt})]})})})]}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(D,{title:"Clinical Details",right:R?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Z(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Z(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:R?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["ECOG Performance Status",e.jsx("select",{value:s.ecog,onChange:a=>r(t=>({...t,ecog:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["0","1","2","3","4"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Disease Stage/Grade/Subtype",e.jsx("input",{value:s.diseaseStage,onChange:a=>r(t=>({...t,diseaseStage:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., Stage II; ER+/HER2-"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Key Biomarkers",e.jsx("input",{value:s.biomarkers,onChange:a=>r(t=>({...t,biomarkers:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., PD-L1 50%, EGFR exon 19"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comorbidities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityCardiac,onChange:a=>r(t=>({...t,comorbidityCardiac:a.target.checked}))})," Cardiac"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityRenal,onChange:a=>r(t=>({...t,comorbidityRenal:a.target.checked}))})," Renal"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityHepatic,onChange:a=>r(t=>({...t,comorbidityHepatic:a.target.checked}))})," Hepatic"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityAutoimmune,onChange:a=>r(t=>({...t,comorbidityAutoimmune:a.target.checked}))})," Autoimmune"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Infections"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHIV,onChange:a=>r(t=>({...t,infectionHIV:a.target.checked}))})," HIV"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHBV,onChange:a=>r(t=>({...t,infectionHBV:a.target.checked}))})," Hepatitis B"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHCV,onChange:a=>r(t=>({...t,infectionHCV:a.target.checked}))})," Hepatitis C"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(h,{label:"ECOG",value:s.ecog,missing:!s.ecog,epicSyncedAt:(Te=m.fieldSources.ecog)==null?void 0:Te.syncedAt}),e.jsx(h,{label:"Disease Stage/Subtype",value:s.diseaseStage,missing:!s.diseaseStage,epicSyncedAt:(Me=m.fieldSources.diseaseStage)==null?void 0:Me.syncedAt}),e.jsx(h,{label:"Key Biomarkers",value:s.biomarkers,missing:!s.biomarkers,epicSyncedAt:(He=m.fieldSources.biomarkers)==null?void 0:He.syncedAt}),e.jsx(h,{label:"Comorbidities",value:[s.comorbidityCardiac&&"Cardiac",s.comorbidityRenal&&"Renal",s.comorbidityHepatic&&"Hepatic",s.comorbidityAutoimmune&&"Autoimmune"].filter(Boolean).join(", "),epicSyncedAt:(Re=m.fieldSources.comorbidity)==null?void 0:Re.syncedAt}),e.jsx(h,{label:"Infections",value:[s.infectionHIV&&"HIV",s.infectionHBV&&"HBV",s.infectionHCV&&"HCV"].filter(Boolean).join(", "),epicSyncedAt:(_e=m.fieldSources.infection)==null?void 0:_e.syncedAt})]})})})}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(D,{title:"Prior Treatments",children:[e.jsxs("ul",{className:"divide-y",children:[(s.priorTherapies||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[a.name,a.date?` — ${a.date}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>{const i=prompt("Edit therapy name",a.name)||a.name,n=prompt("Edit date (optional)",a.date||"")||void 0;r(x=>({...x,priorTherapies:x.priorTherapies.map((M,C)=>C===t?{name:i.trim(),date:n==null?void 0:n.trim()}:M)}))},"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(i=>({...i,priorTherapies:i.priorTherapies.filter((n,x)=>x!==t)})),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.priorTherapies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No prior treatments listed"})]}),l&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Therapy Name",e.jsx("input",{value:p.name,onChange:a=>j(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Date (optional)",e.jsx("input",{value:p.date||"",onChange:a=>j(t=>({...t,date:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{j({name:"",date:""}),o(!1)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{p.name.trim()&&(r(a=>{var t;return{...a,priorTherapies:[...a.priorTherapies,{name:p.name.trim(),date:((t=p.date)==null?void 0:t.trim())||void 0}]}}),j({name:"",date:""}),o(!1))},disabled:!p.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${p.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!l&&e.jsxs("button",{onClick:()=>o(!0),className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ue,{className:"w-4 h-4"})," Add prior treatment"]})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Additional Information",right:ne?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Q(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:ne?e.jsx("textarea",{value:s.additionalInfo,onChange:a=>r(t=>({...t,additionalInfo:a.target.value})),rows:4,className:"w-full rounded-md border px-3 py-2 text-sm",placeholder:"Any important details you'd like us to know..."}):e.jsx("div",{className:"text-sm text-gray-700 min-h-[20px]",children:s.additionalInfo||"No additional information yet"})})}),!s.weight||!s.gender||!s.phone||!s.age||!s.race||!s.language||!s.bloodGroup||!s.genotype||!s.primaryCondition||!s.diagnosed||(s.allergies||[]).length===0||(s.medications||[]).length===0||!s.ecog||!s.diseaseStage?e.jsxs("div",{className:"mt-6 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Some details are missing. Please complete your profile."})]}):e.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{children:"Profile is up to date"})]})]}),g==="documents"&&e.jsx(nt,{onCountChange:W}),g==="ehr"&&(()=>{const a=(()=>{try{const i=localStorage.getItem("epic:patient:v1");if(i)return JSON.parse(i)}catch{}return null})();if(!(a!=null&&a.patientData))return e.jsxs("div",{className:"mt-6 rounded-xl border bg-white p-4 text-sm text-gray-600",children:[e.jsx("p",{children:"No EHR/EMR connected yet."}),e.jsx(Ge,{to:"/patients/ehr",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",children:"Connect EHR/EMR Provider"})]});const t=a.patientData;return e.jsxs("div",{className:"mt-6",children:[e.jsx(D,{title:"Connected Patient Information",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Patient ID"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Birth Date"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.birthDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gender"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.gender||"N/A"})]})]})}),Array.isArray(t.conditions)&&t.conditions.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Conditions",children:e.jsx("ul",{className:"divide-y",children:(t.conditions||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.display||i.code}),i.status&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status})]})},n))})})}),Array.isArray(t.medications)&&t.medications.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Medications",children:e.jsx("ul",{className:"divide-y",children:(t.medications||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.name}),(i.dosage||i.status)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.dosage,i.status].filter(Boolean).join(" • ")})]})},n))})})}),Array.isArray(t.allergies)&&t.allergies.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(D,{title:"Allergies",children:e.jsx("ul",{className:"divide-y",children:(t.allergies||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.substance}),(i.reaction||i.severity)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.severity&&`Severity: ${i.severity}`,i.reaction].filter(Boolean).join(" • ")})]})},n))})})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{localStorage.removeItem("epic:tokens:v1"),localStorage.removeItem("epic:patient:v1"),window.location.reload()},className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Disconnect EHR"})})]})})()]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{ft as default};
