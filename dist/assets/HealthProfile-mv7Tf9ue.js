import{c as xe,f as Fe,r as c,j as e,M as Je,L as Ge,i as Ye}from"./index-CCxlcZzJ.js";import{P as qe}from"./PatientHeader-D-pqIuas.js";import{g as $e,f as We}from"./phoneValidation-6utpIYm-.js";import{U as Be}from"./user-CXuQbio9.js";import{C as Ke}from"./calendar-DAt_spQH.js";import{P as Ze}from"./phone-CZwDnVHo.js";import{P as G,T as me}from"./trash-2-DrKMcwzo.js";import{P as ge}from"./plus-C5hRugPu.js";import{C as Oe}from"./circle-check-JL366_eZ.js";import"./HeaderActions-DkMyBX6h.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=xe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=xe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=xe("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),Ue="/.netlify/functions";function ze(d){const m=(d||"").trim();if(!m)throw new Error("Not authenticated. Please sign in and try again.");return m.toLowerCase().startsWith("bearer ")?m:`Bearer ${m}`}async function tt(d,m){const j=ze(m),y=await fetch(`${Ue}/profile-write`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:j},body:JSON.stringify(d)});if(!y.ok){const I=await y.json();throw new Error(I.error||"Failed to save profile")}return console.log("✅ Profile saved to persistent storage"),y.json()}async function at(d,m,j){const y=ze(j),I=new FormData;I.append("patientId",d),m.forEach(p=>{I.append("files",p)});const S=await fetch(`${Ue}/upload-file`,{method:"POST",headers:{Authorization:y},body:I});if(!S.ok){const p=await S.json();throw new Error(p.error||"Failed to upload files")}const _=await S.json();return console.log("✅ Files uploaded successfully:",_.files),_.files}const W="tc_health_profile_v1",Le="tc_health_profile_metadata_v1",st=new Set(["application/pdf"]),it=new Set([".pdf"]),pe=({syncedAt:d})=>d?e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs",children:[e.jsx("span",{children:"Synced from EPIC"}),d&&e.jsxs("span",{className:"text-blue-600",children:["— ",d]})]}):null,H=({title:d,children:m,right:j})=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:d}),j]}),e.jsx("div",{className:"p-4",children:m})]}),f=({label:d,value:m,icon:j,missing:y,epicSyncedAt:I})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[j,e.jsx("span",{className:"text-sm",children:d})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm ${y?"text-red-600":"text-gray-900"}`,children:m||(y?"Required":"")}),I&&e.jsx(pe,{syncedAt:I})]})]});function rt(d){if(d===0)return"0 B";const m=1024,j=["B","KB","MB","GB","TB"],y=Math.floor(Math.log(d)/Math.log(m));return`${parseFloat((d/Math.pow(m,y)).toFixed(2))} ${j[y]}`}function nt(d){const m=new Date(d);return`${m.getMonth()+1}/${m.getDate()}/${m.getFullYear()}`}function lt({onCountChange:d}){const[m,j]=c.useState("Diagnostic Reports"),[y,I]=c.useState(""),[S,_]=c.useState(()=>{try{const r=localStorage.getItem("tc_docs");return r?JSON.parse(r):[]}catch{return[]}}),[p,x]=c.useState(1),ee=10,s=c.useRef(null),{user:l}=Fe(),re=l?`${l.firstName} ${l.lastName}`:"You",[O,g]=c.useState(null);c.useEffect(()=>{localStorage.setItem("tc_docs",JSON.stringify(S)),d==null||d(S.length)},[S,d]);const K=c.useMemo(()=>S.filter(o=>o.category===m&&o.name.toLowerCase().includes(y.toLowerCase())),[S,m,y]),$=Math.max(1,Math.ceil(K.length/ee)),Z=K.slice((p-1)*ee,p*ee);c.useEffect(()=>{p>$&&x($)},[$,p]);const ne=()=>{var r;return(r=s.current)==null?void 0:r.click()};function Q(){try{const r=localStorage.getItem(W);if(r){const o=JSON.parse(r);if(o!=null&&o.patientId)return String(o.patientId);if(o!=null&&o.profileId)return String(o.profileId)}}catch{}return null}function te(r){if(st.has(r.type))return!0;const o=r.name.includes(".")?`.${r.name.split(".").pop()}`.toLowerCase():"";return!!o&&it.has(o)}async function ae(r){const o=window.__clinicalSummaryUploaderProps||{};g({mode:"loading",message:"AI is reviewing the document..."});const h=o.summarizeApiUrl,b=o.writeProfileApiUrl,P=o.authHeaderName||"Authorization",v=o.getAuthTokenClientFnName||"getAuthToken",U=o.showEligibilityBadges!==void 0?!!o.showEligibilityBadges:!0;if(!h||!b){g(null);return}const z=Q();if(!z){g({mode:"error",message:"Profile not found"});return}const L=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{const D=window,Y=D==null?void 0:D[v],N=typeof Y=="function"?await Promise.resolve(Y()):void 0;if(!N){g({mode:"error",message:"Authentication failed"});return}const q=new FormData;q.append("file",r),q.append("profileId",z),q.append("uploadId",L),q.append("options.showEligibilityBadges",String(!!U));const oe=new AbortController,B=await Promise.race([fetch(h,{method:"POST",headers:{[P]:`Bearer ${N}`},body:q,signal:oe.signal}),new Promise((C,w)=>setTimeout(()=>{try{oe.abort()}catch{}w(new Error("timeout"))},12e4))]);if(!B||!B.ok){let C="Summarization failed";const w=B==null?void 0:B.status;try{const M=await B.json();M!=null&&M.error&&(C=`Summarization failed: ${M.error}`)}catch{try{const M=await B.text();M&&(C=`Summarization failed: ${M}`)}catch{}}w===415?C="Summarization failed: Unsupported file type. Please upload a PDF.":w===422?C="Summarization failed: The document looks non-medical or unreadable.":w&&(C=`${C} (HTTP ${w})`),g({mode:"error",message:C});return}const T=await B.json();if(!(T!=null&&T.summaryMarkdown)){g({mode:"error",message:T!=null&&T.error?`Summarization failed: ${T.error}`:"Summarization failed: No summary generated"});return}const ie=Ye({summaryMarkdown:T.summaryMarkdown,eligibility:T.eligibility,audit:T.audit},!!U),ce=new AbortController;if(!(await Promise.race([fetch(b,{method:"PUT",headers:{"Content-Type":"application/json",[P]:`Bearer ${N}`},body:JSON.stringify({profileId:z,additionalInformationAppendMarkdown:ie}),signal:ce.signal}),new Promise((C,w)=>setTimeout(()=>{try{ce.abort()}catch{}w(new Error("timeout"))},12e4))])).ok){g({mode:"error",message:"Save failed"});return}try{const C=localStorage.getItem(W);if(C){const w=JSON.parse(C),M=w.additionalInfo||"";w.additionalInfo=(M?M+`

`:"")+ie,localStorage.setItem(W,JSON.stringify(w));try{await tt({...w,additionalInformationAppendMarkdown:ie},N)}catch(ue){console.warn("Warning: Could not save to persistent storage:",ue)}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"DocumentsUploader"}}))}catch{}}}catch{}g({mode:"success",message:"Summary saved to Additional Information"}),s.current&&(s.current.value=""),setTimeout(()=>g(null),2e3)}catch{g({mode:"error",message:"Upload failed"}),setTimeout(()=>g(null),2500)}}async function A(r){if(!r||r.length===0)return;const o=Array.from(r),h=o.filter(v=>!te(v));if(h.length>0){const v=h.map(U=>U.name).join(", ");g({mode:"error",message:`Unsupported file type: ${v}. Use PDF.`}),setTimeout(()=>g(null),2500)}const b=o.filter(v=>te(v));if(b.length===0)return;g({mode:"loading",message:"Uploading files to secure storage..."});const P=Q();if(!P){g({mode:"error",message:"Patient ID not found"}),setTimeout(()=>g(null),2500);return}try{const v=window,z=v==null?void 0:v["getAuthToken"],L=typeof z=="function"?await Promise.resolve(z()):void 0,D=await at(P,b,L),Y=D.map(N=>({id:`${Date.now()}_${Math.random().toString(36).slice(2)}`,name:N.filename,size:N.size,type:"application/pdf",uploadedBy:re,uploadedAt:Date.now(),category:m,url:N.url}));_(N=>[...Y,...N]),b.forEach(N=>ae(N)),g({mode:"success",message:`${D.length} file(s) uploaded successfully`}),setTimeout(()=>g(null),2e3),s.current&&(s.current.value="")}catch(v){console.error("Upload error:",v),g({mode:"error",message:v.message||"Failed to upload files"}),setTimeout(()=>g(null),2500)}}function F(r){const o=document.createElement("a");o.href=r.url,o.download=r.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function le(r){window.open(r.url,"_blank","noopener,noreferrer")}function se(r){const o=S.find(b=>b.id===r);if(!o)return;const h=prompt("Rename document",o.name);!h||h.trim()===""||_(b=>b.map(P=>P.id===r?{...P,name:h.trim()}:P))}function k(r){_(o=>o.filter(h=>h.id!==r))}const V=c.useMemo(()=>({diagnostic:S.filter(r=>r.category==="Diagnostic Reports").length,lab:S.filter(r=>r.category==="Lab Reports").length}),[S]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("button",{onClick:()=>j("Diagnostic Reports"),className:`relative pb-2 ${m==="Diagnostic Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Diagnostic Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:V.diagnostic})]}),e.jsxs("button",{onClick:()=>j("Lab Reports"),className:`relative pb-2 ${m==="Lab Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Lab Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:V.lab})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:y,onChange:r=>I(r.target.value),className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"})}),e.jsx("button",{onClick:ne,className:"inline-flex items-center gap-2 rounded-full bg-[#1033e5] text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Upload document"}),e.jsx("input",{ref:s,className:"hidden",type:"file",multiple:!0,accept:".pdf,application/pdf",onChange:r=>A(r.target.files)})]})]}),O&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 flex items-center justify-center",role:"dialog","aria-live":"polite",children:e.jsxs("div",{className:"rounded-lg bg-white px-6 py-5 shadow-md text-center",children:[O.mode==="loading"&&e.jsx("div",{className:"mx-auto mb-3 h-6 w-6 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin","aria-hidden":"true"}),e.jsx("div",{className:`text-sm ${O.mode==="error"?"text-red-700":O.mode==="success"?"text-emerald-700":"text-gray-900"}`,children:O.message})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Document Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Uploaded By"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[Z.map(r=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900",children:r.name}),e.jsx("span",{className:"text-xs text-gray-500",children:rt(r.size)})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.uploadedBy}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:nt(r.uploadedAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>le(r),className:"rounded-full border px-3 py-1.5 text-xs hover:bg-gray-50 inline-flex items-center gap-1",children:[e.jsx(Xe,{className:"w-4 h-4"})," View"]}),e.jsx("button",{onClick:()=>F(r),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"download",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>se(r.id),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"rename",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k(r.id),className:"p-1.5 text-red-600 hover:text-red-700","aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},r.id)),Z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-600",children:"No documents yet"})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Page ",p," of ",$]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:p===1,onClick:()=>x(r=>Math.max(1,r-1)),className:`rounded-lg border px-3 py-1.5 ${p===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{disabled:p===$,onClick:()=>x(r=>Math.min($,r+1)),className:`rounded-lg border px-3 py-1.5 ${p===$?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})]})]})]})}function yt(){var fe,ye,je,ve,be,Ne,we,Se,Ce,Ae,ke,Ee,Ie,Pe,De,Te,Me,He,_e,Re;const{user:d}=Fe(),[m,j]=c.useState("overview"),[y,I]=c.useState(()=>{try{const a=localStorage.getItem("tc_docs");return a?JSON.parse(a).length:0}catch{return 0}}),[S]=c.useState(()=>{try{return!localStorage.getItem(W)}catch{return!0}}),[_,p]=c.useState(null),[x,ee]=c.useState(()=>{try{const a=localStorage.getItem(Le);if(a)return JSON.parse(a)}catch{}return{fieldSources:{}}}),[s,l]=c.useState(()=>{try{const a=localStorage.getItem(W);if(a)return JSON.parse(a)}catch{}return{patientId:"CUS_j2kthfmgv3bzr5r",email:"",emailVerified:!1,age:"",weight:"",phone:"",gender:"",race:"",language:"",bloodGroup:"",genotype:"",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"",diagnosed:"",allergies:[],medications:[],additionalInfo:"",ecog:"",diseaseStage:"",biomarkers:"",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1}});c.useEffect(()=>{try{const a=localStorage.getItem("epic:patient:v1");if(!a)return;const i=JSON.parse(a).profileData;if(!i)return;const n={...x.fieldSources},u={};i.age&&!s.age&&(u.age=i.age.value,n.age={value:i.age.value,source:"epic",syncedAt:i.age.syncedAt}),i.gender&&!s.gender&&(u.gender=i.gender.value,n.gender={value:i.gender.value,source:"epic",syncedAt:i.gender.syncedAt}),i.primaryCondition&&!s.primaryCondition&&(u.primaryCondition=i.primaryCondition.value,n.primaryCondition={value:i.primaryCondition.value,source:"epic",syncedAt:i.primaryCondition.syncedAt}),i.medications&&(!s.medications||s.medications.length===0)&&(u.medications=i.medications.value,n.medications={value:i.medications.value,source:"epic",syncedAt:i.medications.syncedAt}),i.allergies&&(!s.allergies||s.allergies.length===0)&&(u.allergies=i.allergies.value,n.allergies={value:i.allergies.value,source:"epic",syncedAt:i.allergies.syncedAt}),Object.keys(u).length>0&&(l(R=>({...R,...u})),ee({fieldSources:n}),console.log("[HealthProfile] Auto-filled from EPIC data:",u))}catch(a){console.error("[HealthProfile] Error loading EPIC data:",a)}},[]),c.useEffect(()=>{l(a=>{let t={...a};(!t.email||t.email==="")&&(d!=null&&d.email)&&(t.email=d.email);try{const i=localStorage.getItem("tc_eligibility_profile");if(i){const n=JSON.parse(i),u=n.dob||"",R=()=>{if(!u)return"";const E=new Date(u);if(isNaN(E.getTime()))return"";const J=new Date;let X=J.getFullYear()-E.getFullYear();const de=J.getMonth()-E.getMonth();return(de<0||de===0&&J.getDate()<E.getDate())&&X--,String(X)};t.age||(t.age=n.age||R()),n.gender&&!t.gender&&(t.gender=n.gender),n.race&&!t.race&&(t.race=n.race),n.language&&!t.language&&(t.language=n.language),n.weight&&!t.weight&&(t.weight=n.weight),n.condition&&!t.primaryCondition&&(t.primaryCondition=n.condition),n.year&&!t.diagnosed&&(t.diagnosed=n.year)}}catch{}return Array.isArray(t.allergies)||(t.allergies=[]),Array.isArray(t.medications)||(t.medications=[]),Array.isArray(t.priorTherapies)||(t.priorTherapies=[]),typeof t.ecog!="string"&&(t.ecog=""),typeof t.diseaseStage!="string"&&(t.diseaseStage=""),typeof t.biomarkers!="string"&&(t.biomarkers=""),t.comorbidityCardiac=!!t.comorbidityCardiac,t.comorbidityRenal=!!t.comorbidityRenal,t.comorbidityHepatic=!!t.comorbidityHepatic,t.comorbidityAutoimmune=!!t.comorbidityAutoimmune,t.infectionHIV=!!t.infectionHIV,t.infectionHBV=!!t.infectionHBV,t.infectionHCV=!!t.infectionHCV,t})},[d]),c.useEffect(()=>{try{localStorage.setItem(W,JSON.stringify(s))}catch{}try{localStorage.setItem(Le,JSON.stringify(x))}catch{}try{window.dispatchEvent(new Event("storage"))}catch{}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile"}}))}catch{}},[s,x]),c.useEffect(()=>{const a=t=>{var i;try{const n=localStorage.getItem(W);if(n){const u=JSON.parse(n);if(t instanceof CustomEvent&&((i=t.detail)==null?void 0:i.source)==="HealthProfile")return;l(u)}}catch{}};return window.addEventListener("tc_profile_updated",a),window.addEventListener("focus",a),window.addEventListener("visibilitychange",a),()=>{window.removeEventListener("tc_profile_updated",a),window.removeEventListener("focus",a),window.removeEventListener("visibilitychange",a)}},[]);const[re,O]=c.useState(!1),[g,K]=c.useState(!1),[$,Z]=c.useState(!1),[ne,Q]=c.useState(!1),[te,ae]=c.useState(!1),[A,F]=c.useState({name:"",reaction:"",severity:void 0,note:""}),[le,se]=c.useState(!1),[k,V]=c.useState({name:"",dose:"",amountDaily:"",schedule:""}),[r,o]=c.useState(!1),[h,b]=c.useState({name:"",date:""}),[P,v]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"";const t=JSON.parse(a);return String(t.loc||"")}catch{return""}}),[U,z]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"50mi";const t=JSON.parse(a);return String(t.radius||"50mi")}catch{return"50mi"}}),[L,D]=c.useState("idle"),[Y,N]=c.useState("");function q(){D("saving");try{const a=localStorage.getItem("tc_eligibility_profile"),i={...a?JSON.parse(a):{},loc:P.trim(),radius:U};localStorage.setItem("tc_eligibility_profile",JSON.stringify(i)),window.dispatchEvent(new Event("storage"));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile",updated:["loc","radius"]}}))}catch{}N("Preferences saved"),D("saved"),setTimeout(()=>D("idle"),2e3)}catch{N("Could not save. Please try again."),D("error")}}function oe(){ae(!0)}function B(){A.name.trim()&&(l(a=>{var t,i;return{...a,allergies:[...a.allergies,{name:A.name.trim(),reaction:((t=A.reaction)==null?void 0:t.trim())||void 0,severity:A.severity,note:((i=A.note)==null?void 0:i.trim())||void 0}]}}),F({name:"",reaction:"",severity:void 0,note:""}),ae(!1))}function T(){F({name:"",reaction:"",severity:void 0,note:""}),ae(!1)}function ie(a){const t=s.allergies[a],i=prompt("Edit allergy name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit reaction (optional)",(t==null?void 0:t.reaction)||"")||void 0,u=prompt("Edit severity (Mild, Moderate, Severe) (optional)",(t==null?void 0:t.severity)||"")||void 0,R=u==="Mild"||u==="Moderate"||u==="Severe"?u:void 0,E=prompt("Edit notes (optional)",(t==null?void 0:t.note)||"")||void 0;l(J=>({...J,allergies:J.allergies.map((X,de)=>de===a?{name:i.trim(),reaction:(n==null?void 0:n.trim())||void 0,severity:R,note:(E==null?void 0:E.trim())||void 0}:X)}))}function ce(a){l(t=>({...t,allergies:t.allergies.filter((i,n)=>n!==a)}))}function he(){se(!0)}function C(){k.name.trim()&&(l(a=>{var t,i,n;return{...a,medications:[...a.medications,{name:k.name.trim(),dose:((t=k.dose)==null?void 0:t.trim())||void 0,amountDaily:((i=k.amountDaily)==null?void 0:i.trim())||void 0,schedule:((n=k.schedule)==null?void 0:n.trim())||void 0}]}}),V({name:"",dose:"",amountDaily:"",schedule:""}),se(!1))}function w(){V({name:"",dose:"",amountDaily:"",schedule:""}),se(!1)}function M(a){const t=s.medications[a],i=prompt("Edit medication name",t==null?void 0:t.name);if(!i)return;const n=prompt("Edit dose (optional)",(t==null?void 0:t.dose)||"")||void 0,u=prompt("Edit amount taken daily (optional)",(t==null?void 0:t.amountDaily)||"")||void 0,R=prompt("Edit schedule (optional)",(t==null?void 0:t.schedule)||"")||void 0;l(E=>({...E,medications:E.medications.map((J,X)=>X===a?{name:i.trim(),dose:(n==null?void 0:n.trim())||void 0,amountDaily:(u==null?void 0:u.trim())||void 0,schedule:(R==null?void 0:R.trim())||void 0}:J)}))}function ue(a){l(t=>({...t,medications:t.medications.filter((i,n)=>n!==a)}))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(qe,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Health Profile"}),(()=>{const a=d?`${d.firstName} ${d.lastName}`:"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-gray-700",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})})(),e.jsxs("div",{className:"mt-6 flex items-center gap-6 text-sm",children:[e.jsx("button",{onClick:()=>j("overview"),className:`relative pb-2 ${m==="overview"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>j("documents"),className:`relative pb-2 flex items-center gap-2 ${m==="documents"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Documents ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:y})]}),e.jsx("button",{onClick:()=>j("ehr"),className:`relative pb-2 ${m==="ehr"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Connected Medical Records"})]}),m==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(H,{title:"Personal Details",right:re?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{O(!1),p(null)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(s.phone.trim()){const a=$e(s.phone,"US");if(a){p(a);return}}O(!1),p(null)},className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>O(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:re?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Patient ID",e.jsx("input",{value:s.patientId,onChange:a=>l(t=>({...t,patientId:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Email",e.jsx("input",{value:s.email,onChange:a=>l(t=>({...t,email:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Age",e.jsx("input",{value:s.age,onChange:a=>l(t=>({...t,age:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Weight",e.jsx("input",{value:s.weight,onChange:a=>l(t=>({...t,weight:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Phone Number",e.jsx("input",{value:s.phone,onChange:a=>{const t=We(a.target.value,"US");l(i=>({...i,phone:t})),_&&p(null)},onBlur:()=>{if(s.phone.trim()){const a=$e(s.phone,"US");p(a)}},className:`mt-1 w-full rounded-md border px-3 py-2 ${_?"border-red-500":""}`})]}),_&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:_})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Gender",e.jsxs("select",{value:s.gender,onChange:a=>l(t=>({...t,gender:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Non-binary"}),e.jsx("option",{children:"Prefer not to say"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Race",e.jsx("input",{value:s.race,onChange:a=>l(t=>({...t,race:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Language Preference",e.jsx("input",{value:s.language,onChange:a=>l(t=>({...t,language:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsx("div",{className:"sm:col-span-2 flex items-center gap-2 text-sm mt-1",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s.emailVerified?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.emailVerified?"Verified":"Not verified"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(f,{label:"Patient ID",value:s.patientId,icon:e.jsx(Be,{className:"w-4 h-4"}),epicSyncedAt:(fe=x.fieldSources.patientId)==null?void 0:fe.syncedAt}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:`${s.emailVerified?"text-emerald-700":"text-amber-600"} text-xs`,children:s.emailVerified?"Verified":"Not verified"})]})]}),e.jsx(f,{label:"Age",value:s.age,icon:e.jsx(Ke,{className:"w-4 h-4"}),missing:!s.age,epicSyncedAt:(ye=x.fieldSources.age)==null?void 0:ye.syncedAt}),e.jsx(f,{label:"Weight",value:s.weight,icon:e.jsx(et,{className:"w-4 h-4"}),missing:!s.weight,epicSyncedAt:(je=x.fieldSources.weight)==null?void 0:je.syncedAt}),e.jsx(f,{label:"Phone Number",value:s.phone,icon:e.jsx(Ze,{className:"w-4 h-4"}),missing:!s.phone,epicSyncedAt:(ve=x.fieldSources.phone)==null?void 0:ve.syncedAt}),e.jsx(f,{label:"Gender",value:s.gender,icon:e.jsx(Be,{className:"w-4 h-4"}),missing:!s.gender,epicSyncedAt:(be=x.fieldSources.gender)==null?void 0:be.syncedAt}),e.jsx(f,{label:"Race",value:s.race,missing:!s.race,epicSyncedAt:(Ne=x.fieldSources.race)==null?void 0:Ne.syncedAt}),e.jsx(f,{label:"Language Preference",value:s.language,missing:!s.language,epicSyncedAt:(we=x.fieldSources.language)==null?void 0:we.syncedAt})]})})}),e.jsx("div",{children:e.jsxs(H,{title:"Allergies",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.allergies||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Se=x.fieldSources.allergies)==null?void 0:Se.syncedAt)&&e.jsx(pe,{syncedAt:x.fieldSources.allergies.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.allergies.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[a.name,a.severity&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700",children:a.severity})]}),(a.reaction||a.note)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.reaction,a.note].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>ie(t),"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.allergies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No allergies added"})]}),te&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Allergy Name",e.jsx("input",{value:A.name,onChange:a=>F(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Severity",e.jsxs("select",{value:A.severity||"",onChange:a=>F(t=>({...t,severity:a.target.value||void 0})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Mild"}),e.jsx("option",{children:"Moderate"}),e.jsx("option",{children:"Severe"})]})]}),e.jsxs("label",{className:"text-gray-700",children:["Reaction",e.jsx("input",{value:A.reaction||"",onChange:a=>F(t=>({...t,reaction:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700 sm:col-span-2",children:["Notes",e.jsx("input",{value:A.note||"",onChange:a=>F(t=>({...t,note:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:T,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!A.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${A.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!te&&e.jsxs("button",{onClick:oe,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another allergy"]})]})})]}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(H,{title:"Travel Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Home location (City, State or ZIP)",e.jsx("input",{value:P,onChange:a=>v(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g. 10001 or Buffalo, NY"})]}),e.jsxs("label",{className:"text-gray-700",children:["Travel radius",e.jsx("select",{value:U,onChange:a=>z(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["25mi","50mi","100mi","200mi","300mi","500mi","1000mi"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:q,disabled:L==="saving",className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${L==="saving"?"bg-gray-400 text-white cursor-wait":"bg-gray-900 text-white"}`,children:L==="saving"?"Saving…":"Save"}),L==="saved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-emerald-700",children:[e.jsx(Oe,{className:"w-4 h-4"})," ",Y]}),L==="error"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Ve,{className:"w-4 h-4"})," ",Y]})]})]})}),e.jsxs(H,{title:"Medications",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.medications||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Ce=x.fieldSources.medications)==null?void 0:Ce.syncedAt)&&e.jsx(pe,{syncedAt:x.fieldSources.medications.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.medications.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.name}),(a.dose||a.amountDaily||a.schedule)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.dose,a.amountDaily?`${a.amountDaily} per day`:"",a.schedule].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>M(t),"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ue(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.medications||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No medications listed"})]}),le&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Medication Name",e.jsx("input",{value:k.name,onChange:a=>V(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Dose",e.jsx("input",{value:k.dose||"",onChange:a=>V(t=>({...t,dose:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Amount taken daily",e.jsx("input",{value:k.amountDaily||"",onChange:a=>V(t=>({...t,amountDaily:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Schedule",e.jsx("input",{value:k.schedule||"",onChange:a=>V(t=>({...t,schedule:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:w,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:!k.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${k.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!le&&e.jsxs("button",{onClick:he,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another medication"]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(H,{title:"Health Profile",right:g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>K(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>K(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:g?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Blood Group",e.jsx("select",{value:s.bloodGroup,onChange:a=>l(t=>({...t,bloodGroup:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Genotype",e.jsx("input",{value:s.genotype,onChange:a=>l(t=>({...t,genotype:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Hearing Impaired",e.jsxs("select",{value:s.hearingImpaired?"Yes":"No",onChange:a=>l(t=>({...t,hearingImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Vision Impaired",e.jsxs("select",{value:s.visionImpaired?"Yes":"No",onChange:a=>l(t=>({...t,visionImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Primary Condition",e.jsx("input",{value:s.primaryCondition,onChange:a=>l(t=>({...t,primaryCondition:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Diagnosed",e.jsx("input",{value:s.diagnosed,onChange:a=>l(t=>({...t,diagnosed:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(f,{label:"Blood Group",value:s.bloodGroup,missing:!s.bloodGroup,epicSyncedAt:(Ae=x.fieldSources.bloodGroup)==null?void 0:Ae.syncedAt}),e.jsx(f,{label:"Genotype",value:s.genotype,missing:!s.genotype,epicSyncedAt:(ke=x.fieldSources.genotype)==null?void 0:ke.syncedAt}),e.jsx(f,{label:"Hearing Impaired",value:s.hearingImpaired?"Yes":"No",epicSyncedAt:(Ee=x.fieldSources.hearingImpaired)==null?void 0:Ee.syncedAt}),e.jsx(f,{label:"Vision Impaired",value:s.visionImpaired?"Yes":"No",epicSyncedAt:(Ie=x.fieldSources.visionImpaired)==null?void 0:Ie.syncedAt}),e.jsx(f,{label:"Primary Condition",value:s.primaryCondition,missing:!s.primaryCondition,epicSyncedAt:(Pe=x.fieldSources.primaryCondition)==null?void 0:Pe.syncedAt}),e.jsx(f,{label:"Diagnosed",value:s.diagnosed,missing:!s.diagnosed,epicSyncedAt:(De=x.fieldSources.diagnosed)==null?void 0:De.syncedAt})]})})})]}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(H,{title:"Clinical Details",right:$?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Z(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Z(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:$?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["ECOG Performance Status",e.jsx("select",{value:s.ecog,onChange:a=>l(t=>({...t,ecog:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["0","1","2","3","4"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Disease Stage/Grade/Subtype",e.jsx("input",{value:s.diseaseStage,onChange:a=>l(t=>({...t,diseaseStage:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., Stage II; ER+/HER2-"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Key Biomarkers",e.jsx("input",{value:s.biomarkers,onChange:a=>l(t=>({...t,biomarkers:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., PD-L1 50%, EGFR exon 19"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comorbidities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityCardiac,onChange:a=>l(t=>({...t,comorbidityCardiac:a.target.checked}))})," Cardiac"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityRenal,onChange:a=>l(t=>({...t,comorbidityRenal:a.target.checked}))})," Renal"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityHepatic,onChange:a=>l(t=>({...t,comorbidityHepatic:a.target.checked}))})," Hepatic"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityAutoimmune,onChange:a=>l(t=>({...t,comorbidityAutoimmune:a.target.checked}))})," Autoimmune"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Infections"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHIV,onChange:a=>l(t=>({...t,infectionHIV:a.target.checked}))})," HIV"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHBV,onChange:a=>l(t=>({...t,infectionHBV:a.target.checked}))})," Hepatitis B"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHCV,onChange:a=>l(t=>({...t,infectionHCV:a.target.checked}))})," Hepatitis C"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(f,{label:"ECOG",value:s.ecog,missing:!s.ecog,epicSyncedAt:(Te=x.fieldSources.ecog)==null?void 0:Te.syncedAt}),e.jsx(f,{label:"Disease Stage/Subtype",value:s.diseaseStage,missing:!s.diseaseStage,epicSyncedAt:(Me=x.fieldSources.diseaseStage)==null?void 0:Me.syncedAt}),e.jsx(f,{label:"Key Biomarkers",value:s.biomarkers,missing:!s.biomarkers,epicSyncedAt:(He=x.fieldSources.biomarkers)==null?void 0:He.syncedAt}),e.jsx(f,{label:"Comorbidities",value:[s.comorbidityCardiac&&"Cardiac",s.comorbidityRenal&&"Renal",s.comorbidityHepatic&&"Hepatic",s.comorbidityAutoimmune&&"Autoimmune"].filter(Boolean).join(", "),epicSyncedAt:(_e=x.fieldSources.comorbidity)==null?void 0:_e.syncedAt}),e.jsx(f,{label:"Infections",value:[s.infectionHIV&&"HIV",s.infectionHBV&&"HBV",s.infectionHCV&&"HCV"].filter(Boolean).join(", "),epicSyncedAt:(Re=x.fieldSources.infection)==null?void 0:Re.syncedAt})]})})})}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(H,{title:"Prior Treatments",children:[e.jsxs("ul",{className:"divide-y",children:[(s.priorTherapies||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[a.name,a.date?` — ${a.date}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>{const i=prompt("Edit therapy name",a.name)||a.name,n=prompt("Edit date (optional)",a.date||"")||void 0;l(u=>({...u,priorTherapies:u.priorTherapies.map((R,E)=>E===t?{name:i.trim(),date:n==null?void 0:n.trim()}:R)}))},"aria-label":"edit",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(i=>({...i,priorTherapies:i.priorTherapies.filter((n,u)=>u!==t)})),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.priorTherapies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No prior treatments listed"})]}),r&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Therapy Name",e.jsx("input",{value:h.name,onChange:a=>b(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Date (optional)",e.jsx("input",{value:h.date||"",onChange:a=>b(t=>({...t,date:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{b({name:"",date:""}),o(!1)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{h.name.trim()&&(l(a=>{var t;return{...a,priorTherapies:[...a.priorTherapies,{name:h.name.trim(),date:((t=h.date)==null?void 0:t.trim())||void 0}]}}),b({name:"",date:""}),o(!1))},disabled:!h.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${h.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!r&&e.jsxs("button",{onClick:()=>o(!0),className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add prior treatment"]})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(H,{title:"Additional Information",right:ne?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>Q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>Q(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(G,{className:"w-4 h-4"})," Edit"]}),children:ne?e.jsx("textarea",{value:s.additionalInfo,onChange:a=>l(t=>({...t,additionalInfo:a.target.value})),rows:4,className:"w-full rounded-md border px-3 py-2 text-sm",placeholder:"Any important details you'd like us to know..."}):e.jsx("div",{className:"text-sm text-gray-700 min-h-[20px]",children:s.additionalInfo||"No additional information yet"})})}),!s.weight||!s.gender||!s.phone||!s.age||!s.race||!s.language||!s.bloodGroup||!s.genotype||!s.primaryCondition||!s.diagnosed||(s.allergies||[]).length===0||(s.medications||[]).length===0||!s.ecog||!s.diseaseStage?e.jsxs("div",{className:"mt-6 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Some details are missing. Please complete your profile."})]}):e.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{children:"Profile is up to date"})]})]}),m==="documents"&&e.jsx(lt,{onCountChange:I}),m==="ehr"&&(()=>{const a=(()=>{try{const i=localStorage.getItem("epic:patient:v1");if(i)return JSON.parse(i)}catch{}return null})();if(!(a!=null&&a.patientData))return e.jsxs("div",{className:"mt-6 rounded-xl border bg-white p-4 text-sm text-gray-600",children:[e.jsx("p",{children:"No EHR/EMR connected yet."}),e.jsx(Ge,{to:"/patients/ehr",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",children:"Connect EHR/EMR Provider"})]});const t=a.patientData;return e.jsxs("div",{className:"mt-6",children:[e.jsx(H,{title:"Connected Patient Information",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Patient ID"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Birth Date"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.birthDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gender"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.gender||"N/A"})]})]})}),Array.isArray(t.conditions)&&t.conditions.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(H,{title:"Conditions",children:e.jsx("ul",{className:"divide-y",children:(t.conditions||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.display||i.code}),i.status&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status})]})},n))})})}),Array.isArray(t.medications)&&t.medications.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(H,{title:"Medications",children:e.jsx("ul",{className:"divide-y",children:(t.medications||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.name}),(i.dosage||i.status)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.dosage,i.status].filter(Boolean).join(" • ")})]})},n))})})}),Array.isArray(t.allergies)&&t.allergies.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(H,{title:"Allergies",children:e.jsx("ul",{className:"divide-y",children:(t.allergies||[]).map((i,n)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.substance}),(i.reaction||i.severity)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.severity&&`Severity: ${i.severity}`,i.reaction].filter(Boolean).join(" • ")})]})},n))})})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{localStorage.removeItem("epic:tokens:v1"),localStorage.removeItem("epic:patient:v1"),window.location.reload()},className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Disconnect EHR"})})]})})()]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{yt as default};
