import{R as a,u as R,j as e,L}from"./index-BDmcj3uD.js";import{g as E}from"./matching-EwNiNLll.js";import{P}from"./PatientHeader-DUXpnyx6.js";import"./trials-DUAD2qh_.js";import"./ctgov-0NYeoFZ-.js";import"./geocode-C0RmwoTY.js";import"./HeaderActions-BxMjWePd.js";function F(){const[m,b]=a.useState(""),[l,f]=a.useState([]),[j,x]=a.useState(!1),[N,v]=a.useState(""),[w,p]=a.useState(!1),[u,g]=a.useState(null),r=R();a.useMemo(()=>{const s=new URLSearchParams(r.search),t=Number(s.get("offset"));return Number.isFinite(t)&&t>0?Math.floor(t):0},[r.search]),a.useEffect(()=>{let s=!1;const t=async()=>{try{p(!0),g(null);const d=await E(100);s||f(d)}catch(d){s||g(d instanceof Error?d.message:"Failed to load matches")}finally{s||p(!1)}};t();const n=()=>t();return window.addEventListener("storage",n),window.addEventListener("visibilitychange",n),window.addEventListener("focus",n),()=>{s=!0,window.removeEventListener("storage",n),window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}},[]);const o=a.useMemo(()=>{const s=m.trim().toLowerCase();return s?l.filter(t=>[t.title,t.nctId,t.phase,t.status,t.location,t.center,...t.interventions].join(" ").toLowerCase().includes(s)):l},[m,l]),c=25,i=a.useMemo(()=>{const s=new URLSearchParams(r.search),t=Number(s.get("page"));return Number.isFinite(t)&&t>0?Math.floor(t):1},[r.search]),h=Math.max(1,Math.ceil(o.length/c)),S=a.useMemo(()=>o.slice((i-1)*c,i*c),[o,i,c]),y=(s,t)=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium whitespace-nowrap ${t==="green"?"bg-green-100 text-green-700":"bg-violet-100 text-violet-700"}`,children:s}),C=l.__noResultsWithinRadius===!0;return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(P,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Eligible Trials"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search",value:m,onChange:s=>b(s.target.value)})})]}),w&&e.jsx("div",{className:"mb-4 rounded-lg border border-blue-100 bg-blue-50 px-4 py-3 text-sm text-blue-800",children:"Refreshing matches…"}),u&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:u}),C&&l.length===0&&e.jsx("div",{className:"mb-6 rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-xl",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-900",children:"No trials found within your search radius"}),e.jsx("p",{className:"mt-1 text-sm text-amber-800",children:"We couldn't find any matching trials within your specified distance. Consider:"}),e.jsxs("ul",{className:"mt-2 list-inside list-disc space-y-1 text-sm text-amber-800",children:[e.jsx("li",{children:"Increasing your travel distance in your health profile"}),e.jsx("li",{children:"Checking your location is correctly set"}),e.jsx("li",{children:"Expanding your search to explore options further away"})]}),e.jsx("button",{onClick:()=>window.location.href="/patients/health-profile",className:"mt-3 inline-flex items-center gap-2 rounded-lg bg-amber-900 px-4 py-2 text-sm text-white hover:bg-amber-800",children:"Update Location Preferences →"})]})]})}),e.jsxs("div",{className:"overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Title"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial ID"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Phase"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Compatibility Score"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Interventions"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[S.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(L,{to:`/study/${s.nctId}`,state:{score:s.aiScore,rationale:s.aiRationale||s.reason},className:"text-gray-900 hover:underline",children:s.title})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.nctId}),e.jsx("td",{className:"px-4 py-3",children:y(s.status==="Now Recruiting"?"Recruiting":s.status,"green")}),e.jsx("td",{className:"px-4 py-3",children:y(s.phase,"violet")}),e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{children:[s.aiScore,"%"]}),(s.aiRationale||s.reason)&&e.jsx("button",{type:"button",onClick:()=>{v(`${s.title}

${s.aiRationale||s.reason}`),x(!0)},className:"ml-2 inline-flex items-center rounded-full border px-2 py-0.5 text-xs text-gray-600 hover:bg-gray-50","aria-label":"Why this match",children:"Why"})]}),(s.aiRationale||s.reason)&&e.jsx("div",{className:"mt-1 text-xs text-gray-500 line-clamp-2",children:s.aiRationale||s.reason})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.interventions.join(" / ")}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("a",{href:`https://clinicaltrials.gov/study/${encodeURIComponent(s.nctId)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-lg border px-3 py-1.5 text-xs hover:bg-gray-50",children:"View on ClinicalTrials.gov"})})]},s.slug)),o.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-6 text-center text-gray-500",children:["No trials to show. Add your primary condition and location in your ",e.jsx("a",{href:"/patients/health-profile",className:"underline",children:"Health Profile"})," to get matches."]})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-lg border px-3 py-1.5 hover:bg-gray-50 disabled:opacity-50",onClick:()=>{const s=Math.max(1,i-1),t=new URLSearchParams(r.search);t.set("page",String(s)),window.history.replaceState({},"",`${r.pathname}?${t.toString()}`)},disabled:i<=1,children:"Previous"}),e.jsx("button",{className:"rounded-lg border px-3 py-1.5 hover:bg-gray-50 disabled:opacity-50",onClick:()=>{const s=Math.min(h,i+1),t=new URLSearchParams(r.search);t.set("page",String(s)),window.history.replaceState({},"",`${r.pathname}?${t.toString()}`)},disabled:i>=h,children:"Next"})]}),e.jsxs("div",{children:["Page ",i," of ",h," · ",o.length," matches"]})]})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>x(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-xl border bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Why this trial matches you"}),e.jsx("button",{className:"rounded-md p-1 text-gray-500 hover:bg-gray-100",onClick:()=>x(!1),"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"mt-3 whitespace-pre-wrap text-sm text-gray-700",children:N})]})]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{F as default};
