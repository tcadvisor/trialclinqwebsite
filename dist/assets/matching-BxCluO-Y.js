const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./aiScoring-Czjr-gpW.js","./ctgov-D30T4kGK.js","./geocode-Hh4m7xXf.js"])))=>i.map(i=>d[i]);
import{_ as ht}from"./index-D6Ufhlin.js";import"./trials-DUAD2qh_.js";import{a as J,f as Ct}from"./ctgov-D30T4kGK.js";import{a as gt,g as Tt}from"./geocode-Hh4m7xXf.js";function K(t,n=0,o=100){return Math.max(n,Math.min(o,t))}function _t(){let t=0,n=0,o=0,i=0,s=0;try{const e=localStorage.getItem("auth:v1");if(e){const r=JSON.parse(e),c=(r==null?void 0:r.user)??{};c!=null&&c.email&&(t+=7),c!=null&&c.firstName&&(t+=7),c!=null&&c.lastName&&(t+=6)}}catch{}try{const e=localStorage.getItem("tc_consent");if(e){const r=JSON.parse(e),d=[r.section1,r.section2,r.section3,r.section4,r.final].reduce((S,h)=>S+(h?1:0),0);n=K(d*4,0,20)}}catch{}try{const e=localStorage.getItem("tc_docs");if(e){const r=JSON.parse(e),c=Array.isArray(r)?r.length:0;o=K(Math.min(c,4)*5,0,20)}}catch{}try{const e=JSON.parse(localStorage.getItem("tc_notify_email")||"true"),r=JSON.parse(localStorage.getItem("tc_notify_trials")||"true");i=(e?3:0)+(r?2:0)}catch{}try{const e=localStorage.getItem("tc_health_profile_v1");if(e){const r=JSON.parse(e),c=[r.weight,r.gender,r.phone,r.age,r.race,r.language,r.bloodGroup,r.genotype,r.primaryCondition,r.diagnosed,Array.isArray(r.allergies)&&r.allergies.length>0?"ok":"",Array.isArray(r.medications)&&r.medications.length>0?"ok":"",r.ecog,r.diseaseStage,r.biomarkers,Array.isArray(r.priorTherapies)&&r.priorTherapies.length>0?"ok":""],S=c.reduce((h,b)=>h+(b&&String(b).trim()!==""?1:0),0)/c.length;s=K(Math.round(S*35),0,35)}}catch{}const l={basics:t,consent:n,documents:o,notifications:i,healthProfile:s};return{percent:K(Math.round(t+n+o+i+s)),breakdown:l}}const xt="tc_health_profile_v1",Z="tc_eligibility_profile";function kt(){try{const t=localStorage.getItem(Z);if(!t)return null;const o=JSON.parse(t).dob||"";if(!o)return null;const i=new Date(o);if(isNaN(i.getTime()))return null;const s=new Date;let l=s.getFullYear()-i.getFullYear();const f=s.getMonth()-i.getMonth();return(f<0||f===0&&s.getDate()<i.getDate())&&l--,l}catch{return null}}function tt(){try{const t=localStorage.getItem(Z);if(!t)return{loc:""};const n=JSON.parse(t),o=String(n.loc||"").trim(),i=String(n.radius||"").trim()||void 0;return{loc:o,radius:i}}catch{return{loc:""}}}function Rt(t,n){const o=Array.isArray(t.medications)?[...t.medications].map(s=>String(s||"").toLowerCase().trim()).sort():[],i=Array.isArray(t.allergies)?[...t.allergies].map(s=>String(s||"").toLowerCase().trim()).sort():[];return JSON.stringify({age:t.age??null,gender:(t.gender||"").toLowerCase().trim(),primaryCondition:(t.primaryCondition||"").toLowerCase().trim(),additionalInfo:(t.additionalInfo||"").toString().trim(),meds:o,allergies:i,loc:(n.loc||"").toLowerCase().trim(),radius:(n.radius||"").toLowerCase().trim()})}function At(){let t=null,n=null,o=null,i=[],s=[],l=null;try{const f=localStorage.getItem(xt);if(f){const e=JSON.parse(f),r=Number(e==null?void 0:e.age);t=Number.isFinite(r)?r:null,n=(e!=null&&e.gender?String(e.gender):"").trim()||null,o=(e!=null&&e.primaryCondition?String(e.primaryCondition):"").trim()||null,Array.isArray(e==null?void 0:e.medications)&&(i=e.medications.map(h=>String((h==null?void 0:h.name)||"").toLowerCase()).filter(Boolean)),Array.isArray(e==null?void 0:e.allergies)&&(s=e.allergies.map(h=>String((h==null?void 0:h.name)||"").toLowerCase()).filter(Boolean));const c=(e!=null&&e.additionalInfo?String(e.additionalInfo):"").trim(),d=[];if(e!=null&&e.ecog&&d.push(`ECOG: ${e.ecog}`),e!=null&&e.diseaseStage&&d.push(`Stage/Subtype: ${e.diseaseStage}`),e!=null&&e.biomarkers&&d.push(`Biomarkers: ${e.biomarkers}`),Array.isArray(e==null?void 0:e.priorTherapies)&&e.priorTherapies.length){const h=e.priorTherapies.map(b=>[b==null?void 0:b.name,b==null?void 0:b.date].filter(Boolean).join(" ")).filter(Boolean).join("; ");h&&d.push(`Prior tx: ${h}`)}if(e!=null&&e.comorbidityCardiac||e!=null&&e.comorbidityRenal||e!=null&&e.comorbidityHepatic||e!=null&&e.comorbidityAutoimmune){const h=[e.comorbidityCardiac&&"cardiac",e.comorbidityRenal&&"renal",e.comorbidityHepatic&&"hepatic",e.comorbidityAutoimmune&&"autoimmune"].filter(Boolean).join(", ");h&&d.push(`Comorbidities: ${h}`)}if(e!=null&&e.infectionHIV||e!=null&&e.infectionHBV||e!=null&&e.infectionHCV){const h=[e.infectionHIV&&"HIV",e.infectionHBV&&"HBV",e.infectionHCV&&"HCV"].filter(Boolean).join(", ");h&&d.push(`Infections: ${h}`)}l=[c,d.join(`
`)].filter(Boolean).join(`
`)||null}}catch{}if(t==null&&(t=kt(),t==null))try{const f=localStorage.getItem(Z);if(f){const e=JSON.parse(f),r=Number(e.age);Number.isFinite(r)&&(t=r)}}catch{}return{age:t,gender:n,primaryCondition:o,medications:i,allergies:s,additionalInfo:l}}const Lt=new Set(["the","a","an","and","or","of","for","to","in","on","with","without","by","at","from","about","into","over","after","before","is","are","be","being","been","this","that","these","those","study","trial","clinical","investigating","investigation","impact","patients","patient","therapy","treatment"]);function k(t){return t?t.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(n=>n&&!Lt.has(n)):[]}function Et(t,n){if(!n.length)return!0;const o=t.toLowerCase();return n.every(i=>o.includes(i))}function Pt(t,n){const o=k(n);return o.length?t.filter(i=>{var e,r,c,d;const s=(((r=(e=i.protocolSection)==null?void 0:e.identificationModule)==null?void 0:r.briefTitle)||"").toString(),l=(((d=(c=i.protocolSection)==null?void 0:c.conditionsModule)==null?void 0:d.conditions)||[]).join(" "),f=`${s} ${l}`;return Et(f,o)}):t}function pt(t,n){if(t.length===0||n.length===0)return 0;const o=new Set(n);let i=0;for(const s of t)o.has(s)&&i++;return i}function Q(t,n=0,o=100){return Math.max(n,Math.min(o,t))}function Ot(t){var s,l;const n=((l=(s=t.protocolSection)==null?void 0:s.designModule)==null?void 0:l.phases)||[];if(!n||n.length===0)return"";const o=String(n[0]);if(/PHASE\s*1\/2/i.test(o)||/1\/2/.test(o))return"Phase I/II";if(/PHASE\s*2\/3/i.test(o)||/2\/3/.test(o))return"Phase II/III";const i=o.match(/\d+/);return i?`Phase ${i[0]}`:o}function Ft(t){var i,s;const n=(((s=(i=t.protocolSection)==null?void 0:i.statusModule)==null?void 0:s.overallStatus)||"").toString(),o=n.toUpperCase();return o==="RECRUITING"?"Recruiting":o==="ENROLLING_BY_INVITATION"?"Enrolling by invitation":n||""}function et(t){var o,i,s;const n=(s=(i=(o=t.protocolSection)==null?void 0:o.contactsLocationsModule)==null?void 0:i.locations)==null?void 0:s[0];return n?[n.city,n.state].filter(Boolean).join(", "):""}function Bt(t){var i,s;const o=(((s=(i=t.protocolSection)==null?void 0:i.contactsLocationsModule)==null?void 0:s.locations)||[]).map(l=>[l.city,l.state].filter(Boolean).join(", ").trim()).filter(Boolean);return Array.from(new Set(o))}function yt(t){if(!t)return;const n=String(t).match(/([0-9]+)(mi|km)?/i);if(!n)return;const o=Number(n[1]);return Number.isFinite(o)?(n[2]||"mi").toLowerCase()==="km"?Math.round(o*.621371):o:void 0}function Gt(t,n,o,i){const s=d=>d*Math.PI/180,f=s(o-t),e=s(i-n),r=Math.sin(f/2)**2+Math.cos(s(t))*Math.cos(s(o))*Math.sin(e/2)**2;return 3958.8*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function It(t){return(t||[]).flatMap(n=>k(n))}function bt(t){const n=(t||"").trim().toLowerCase();if(!n||n==="n/a"||n==="na"||n==="none")return;const o=n.match(/(\d+(?:\.\d+)?)/);if(!o)return;let i=Number(o[1]);if(Number.isFinite(i))return/month/.test(n)?i=i/12:/week/.test(n)?i=i/52:/day/.test(n)&&(i=i/365),i}function Mt(t){var i,s,l,f;const n=bt((s=(i=t==null?void 0:t.protocolSection)==null?void 0:i.eligibilityModule)==null?void 0:s.minimumAge),o=bt((f=(l=t==null?void 0:t.protocolSection)==null?void 0:l.eligibilityModule)==null?void 0:f.maximumAge);return n==null&&o==null?null:{min:n??void 0,max:o??void 0,maxExclusive:!1}}function $t(t){var o,i;const n=(((i=(o=t==null?void 0:t.protocolSection)==null?void 0:o.eligibilityModule)==null?void 0:i.sex)||"").toString().trim().toLowerCase();return n?n==="all"?"all":n.startsWith("female")?"female":n.startsWith("male")?"male":null:null}function qt(t,n){var G,L,$,q,W,D;const o=((L=(G=t.protocolSection)==null?void 0:G.identificationModule)==null?void 0:L.briefTitle)||"",i=k(o),s=((q=($=t.protocolSection)==null?void 0:$.conditionsModule)==null?void 0:q.conditions)||[],l=It(s),f=k(n.primaryCondition||""),e=k(n.additionalInfo||""),r=new Set(i.concat(l)),c=[];for(const E of f.concat(e))r.has(E)&&c.length<4&&c.push(E);const d=((D=(W=t.protocolSection)==null?void 0:W.statusModule)==null?void 0:D.overallStatus)||"",S=et(t),h=tt(),b=[];d&&b.push(/recruit/i.test(d)?"Recruiting":d),c.length&&b.push(`Matched on: ${c.join(", ")}`),S&&b.push(`Site: ${S}`),h.loc&&b.push(`Near: ${h.loc}`),h.radius&&b.push(`Within ${h.radius}`);const I=b.join(" · ");return I.length>160?I.slice(0,157)+"...":I}function Wt(t,n){var H,U,M,z,P,V;const o=((U=(H=t.protocolSection)==null?void 0:H.identificationModule)==null?void 0:U.briefTitle)||"",i=k(o),s=((z=(M=t.protocolSection)==null?void 0:M.conditionsModule)==null?void 0:z.conditions)||[],l=It(s),f=k(n.primaryCondition||""),e=k(n.additionalInfo||""),r=pt(i.concat(l),f.concat(e)),c=Math.max(1,f.length+e.length),d=Q(r/c*100,0,100),S=Math.round(.6*d),h=((V=(P=t.protocolSection)==null?void 0:P.statusModule)==null?void 0:V.overallStatus)||"",b=/recruit/i.test(h)?25:10,I=k(et(t)),G=k(n.additionalInfo||""),L=tt(),$=k(L.loc||""),q=pt(I,G.concat($)),W=Q(q*5,0,15),{breakdown:D}=_t(),E=Math.round(D.healthProfile/35*10);return Q(b+S+Vt(n,t)+W+E,0,100)}function Vt(t,n){var f,e;const o=typeof t.age=="number"?t.age:null;if(o==null)return 0;const i=Mt(n);if(i){const{min:r,max:c,maxExclusive:d}=i;return r!=null&&o<r||c!=null&&(d?o>=c:o>c)?0:5}const s=(((e=(f=n.protocolSection)==null?void 0:f.identificationModule)==null?void 0:e.briefTitle)||"").toString(),l=vt(s);return!l||l.min!=null&&o<l.min||l.max!=null&&(l.maxExclusive?o>=l.max:o>l.max)?0:5}function vt(t){const n=(t||"").toLowerCase();let o=n.match(/(\d{1,3})\s*(?:to|–|-|—)\s*(?:less\s+than\s*)?(\d{1,3})\s*(?:years?|yrs?|yo)\b/);if(o){const i=Number(o[1]),s=Number(o[2]),l=/less\s+than\s*\d{1,3}\s*(?:years?|yrs?|yo)\b/.test(n.slice(o.index||0,(o.index||0)+o[0].length));return{min:Number.isFinite(i)?i:void 0,max:Number.isFinite(s)?s:void 0,maxExclusive:l}}if(o=n.match(/(\d{1,3})\s*(?:years?|yrs?|yo)\s*(?:and\s*older|and\s*over|or\s*older)\b/),o){const i=Number(o[1]);return{min:Number.isFinite(i)?i:void 0}}if(o=n.match(/(?:under|less\s*than)\s*(\d{1,3})\s*(?:years?|yrs?|yo)\b/),o){const i=Number(o[1]);return{max:Number.isFinite(i)?i:void 0,maxExclusive:!0}}return/\b(pediatric|child|children|infant|adolescent)s?\b/.test(n)?{max:17,maxExclusive:!1}:/\bolder\s+adult|elderly|senior\b/.test(n)?{min:65}:/\badult(s)?\b/.test(n)&&!/\b(child|children|pediatric)\b/.test(n)?{min:18}:null}function B(t,n){const o=(t||"").toLowerCase();return n.some(i=>o.includes(i.toLowerCase()))}function Ht(t,n,o){var r,c;const i=(t.additionalInfo||"").toLowerCase(),s=(t.medications||[]).map(d=>String(d).toLowerCase()),l=`${(((c=(r=n.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toLowerCase()}
${(o||"").toLowerCase()}`;if(/(planned|schedule[rd])\s+(elective\s+)?(hepato|hepatobiliary|hepato[-\s]?pancreato[-\s]?biliary|pancreatic|colorectal)/.test(l)&&!B(i,["planned surgery","elective surgery","hepato","hepatobiliary","pancreat","colorectal","colectomy","whipple","hepatectomy"]))return{ok:!1,reason:"No qualifying elective HPB/colorectal surgery planned"};const e=["sildenafil","tadalafil","vardenafil","avanafil","pde5"];return B(l,["pde5","phosphodiesterase"])&&s.some(d=>e.some(S=>d.includes(S)))?{ok:!1,reason:"Daily PDE5 inhibitor"}:B(l,["tamsulosin therapy as a home medication","on tamsulosin at baseline","tamsulosin at baseline"])&&s.some(d=>d.includes("tamsulosin")||d.includes("flomax"))?{ok:!1,reason:"On tamsulosin at baseline"}:B(l,["genitourinary","gu procedure","urology procedure","prostate","bladder","ureter","kidney"])&&B(i,["prostate surgery","cystectomy","bladder surgery","ureter","nephrectomy","urology procedure"])?{ok:!1,reason:"GU procedure planned"}:B(l,["same day foley removal","remove foley on day of surgery","pod0"])&&B(i,["same day foley","pod0 foley removal","immediate catheter removal"])?{ok:!1,reason:"Same-day Foley removal planned"}:B(l,["ng tube retention","nasogastric tube retention","pod1"])&&B(i,["ng tube planned","nasogastric tube retention"])?{ok:!1,reason:"NG tube retention planned"}:{ok:!0}}function jt(t){const n=(t||"").toLowerCase();return/(female|women|woman)\s*-?\s*only\b/.test(n)||/\bfemales?\s+only\b/.test(n)?"female":/(male|men|man)\s*-?\s*only\b/.test(n)||/\bmales?\s+only\b/.test(n)?"male":/women\sof\schild-bearing\s*potential|pregnan/i.test(n)?"female":null}function St(t,n,o){var r,c;if(t==null||!Number.isFinite(t))return!0;const i=Mt(n);if(i){const{min:d,max:S,maxExclusive:h}=i;return!(d!=null&&t<d||S!=null&&(h?t>=S:t>S))}const l=`${(((c=(r=n.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toString()}
${o||""}`,f=vt(l);if(!f)return!0;const e=t;return!(f.min!=null&&e<f.min||f.max!=null&&(f.maxExclusive?e>=f.max:e>f.max))}function wt(t,n,o){var r,c;const i=(t||"").toLowerCase();if(!i)return!0;const s=$t(n);if(s){if(s==="all")return!0;if(s==="female")return i.startsWith("fem");if(s==="male")return i.startsWith("male")}const f=`${(((c=(r=n.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toString()}
${o||""}`,e=jt(f);return e?!(e==="female"&&!i.startsWith("fem")||e==="male"&&!i.startsWith("male")):!0}async function zt(t=50){var nt,ot,it,rt,st,at,ct,lt,ut,ft,dt,mt;const n="__tc_cached_matches_v1",o=At(),i=tt(),s=Rt(o,i),l=globalThis[n];if((nt=l==null?void 0:l.data)!=null&&nt.length&&l.fingerprint===s)return l.data.slice(0,t);const f=(o.primaryCondition||"").trim(),r=k(o.additionalInfo||"").slice(0,3).join(" "),c=f||r||"",d=Math.max(10,Math.min(100,t)),S=["RECRUITING","ENROLLING_BY_INVITATION"],{loc:h,radius:b}=i;let I={};try{I=await gt()||{}}catch{I={}}const G=(I==null?void 0:I.label)||h,L=yt(b),$=typeof L=="number"&&Number.isFinite(L),q=typeof I.lat=="number"&&typeof I.lng=="number",W=$&&q;if($&&!q){const a=[];return a.__noResultsWithinRadius=!0,a}const D=async(a,u={withGeo:!0,withStatuses:!0})=>{const g={q:a,pageSize:d};if(u.withGeo&&q)if(g.loc=G,W){const p=`${L}mi`,y={...g,lat:I.lat,lng:I.lng,radius:p};return u.withStatuses?(await Promise.all(S.map(m=>J({...y,status:m})))).flatMap(m=>m.studies||[]):(await J(y)).studies||[]}else{const p={...g,lat:I.lat,lng:I.lng};return u.withStatuses?(await Promise.all(S.map(C=>J({...p,status:C})))).flatMap(C=>C.studies||[]):(await J(p)).studies||[]}return g.loc=G,u.withStatuses?(await Promise.all(S.map(y=>J({...g,status:y})))).flatMap(y=>y.studies||[]):(await J(g)).studies||[]},E=[{query:c,opts:{withGeo:!0,withStatuses:!0}},{query:c,opts:{withGeo:!0,withStatuses:!1},skipWhenEnforceRadius:!0},{query:c,opts:{withGeo:!1,withStatuses:!0}},{query:c,opts:{withGeo:!1,withStatuses:!1},skipWhenEnforceRadius:!0}];G&&E.push({query:"",opts:{withGeo:!0,withStatuses:!0},filterAfter:!!c}),E.push({query:"",opts:{withGeo:!1,withStatuses:!0},filterAfter:!!c,skipWhenEnforceRadius:!0}),f&&f!==c&&E.push({query:f,opts:{withGeo:!0,withStatuses:!0}});let H=[];for(const a of E)if(!(a.skipWhenEnforceRadius&&W))try{const u=await D(a.query,a.opts),g=a.filterAfter&&c?Pt(u,c):u;if(g&&g.length>0){H=g;break}}catch{}H||(H=[]);const U=new Set,M=[];for(const a of H){const u=((it=(ot=a.protocolSection)==null?void 0:ot.identificationModule)==null?void 0:it.nctId)||"";if(!u||U.has(u))continue;const g=(((st=(rt=a.protocolSection)==null?void 0:rt.statusModule)==null?void 0:st.overallStatus)||"").toString().toUpperCase();if(g!=="RECRUITING"&&g!=="ENROLLING_BY_INVITATION"||!St(o.age,a)||!wt(o.gender,a))continue;U.add(u);const p=((ct=(at=a.protocolSection)==null?void 0:at.identificationModule)==null?void 0:ct.briefTitle)||u,y=Ft(a),_=Ot(a),C=((ft=(ut=(lt=a.protocolSection)==null?void 0:lt.sponsorCollaboratorsModule)==null?void 0:ut.leadSponsor)==null?void 0:ft.name)||"",m=Bt(a),w=m[0]||et(a);let v=Wt(a,o),N;const x=((mt=(dt=a.protocolSection)==null?void 0:dt.conditionsModule)==null?void 0:mt.conditions)||[],A=qt(a,o);try{const{getCachedAiScore:O}=await ht(async()=>{const{getCachedAiScore:X}=await import("./aiScoring-Czjr-gpW.js");return{getCachedAiScore:X}},__vite__mapDeps([0,1,2]),import.meta.url),F=O(u,o);F&&typeof F.score=="number"&&(v=F.score,N=F.rationale)}catch{}const R={slug:u.toLowerCase(),nctId:u,title:p,status:y,phase:_,aiScore:v,interventions:x.slice(0,3),center:C,location:w,reason:A,aiRationale:N};R.locations=m,M.push(R)}const z=M.map(a=>({...a}));let P,V=!1;try{const a=await gt(),u=typeof a.lat=="number"?a.lat:void 0,g=typeof a.lng=="number"?a.lng:void 0,p=yt(a.radius);if(P=p,u!=null&&g!=null){const y=Array.from(new Set(M.flatMap(m=>{const w=m.locations||[],v=w.length?w:[],N=(m.location||"").trim();return[...v,N].map(x=>x.trim()).filter(Boolean)}))),_=new Map,C=await Promise.all(y.map(async m=>{try{const w=await Tt(m);return[m,w]}catch{return[m,null]}}));for(const[m,w]of C){const v=w&&typeof w.lat=="number"?w.lat:void 0,N=w&&typeof w.lng=="number"?w.lng:void 0;v!=null&&N!=null&&_.set(m,{lat:v,lng:N})}for(const m of M){const w=m.locations||[],v=w.length?w:[(m.location||"").trim()].filter(Boolean);let N="",x;for(const A of v){const R=A.trim();if(!R)continue;const O=_.get(R);if(O&&typeof O.lat=="number"&&typeof O.lng=="number"){const F=Gt(u,g,O.lat,O.lng);(x==null||F<x)&&(x=F,N=R)}else N||(N=R)}N&&(m.location=N),x!=null&&(m.distanceMi=Math.round(x),m.inRadius=typeof p=="number"?x<=p:void 0)}}}catch{}const Y=typeof P=="number"?P:$?L:void 0;if(W&&typeof Y=="number"){const a=M.filter(u=>typeof u.distanceMi!="number"?!1:u.distanceMi<=Y);V=a.length===0,M.length=0,M.push(...a)}else if(typeof Y=="number"){const a=M.filter(u=>typeof u.distanceMi!="number"||u.distanceMi<=Y);a.length>0&&(M.length=0,M.push(...a))}let T;if(V&&z.length){const a=typeof Y=="number"?Y:void 0;T=z.filter(p=>a==null?!0:typeof p.distanceMi=="number"?p.distanceMi>a:!0).sort((p,y)=>{const _=typeof p.distanceMi=="number"?p.distanceMi:Number.POSITIVE_INFINITY,C=typeof y.distanceMi=="number"?y.distanceMi:Number.POSITIVE_INFINITY;return _!==C?_-C:(y.aiScore??0)-(p.aiScore??0)}).slice(0,10)}M.__noResultsWithinRadius=V,T!=null&&T.length&&(M.__fallbackSimilar=T);async function Nt(a,u){var _,C;const g=a.slice(0,Math.min(u,a.length)),p=[];for(let m=0;m<g.length;m+=10)p.push(g.slice(m,m+10));const y=new Set;for(const m of p){const w=await Promise.all(m.map(async v=>{try{return await Ct(v.nctId)}catch{return{studies:[]}}}));for(let v=0;v<m.length;v++){const N=m[v],x=w[v],A=x.studies&&x.studies[0],R=(C=(_=A==null?void 0:A.protocolSection)==null?void 0:_.eligibilityModule)==null?void 0:C.eligibilityCriteria,O=St(o.age,A||{},R),F=wt(o.gender,A||{},R),X=Ht(o,A||{},R);(!O||!F||!X.ok)&&y.add(N.nctId)}}return a.filter(m=>!y.has(m.nctId))}const j=await Nt(M,40);j.__noResultsWithinRadius=V,T!=null&&T.length&&(j.__fallbackSimilar=T);for(const a of j)if(typeof a.distanceMi=="number"){const u=a.distanceMi;let g=0;if(typeof P=="number"&&Number.isFinite(P)){const p=P;u<=p?g=25*(1-u/p):g=-15*Math.min(2,(u-p)/p)}else g=20*(1-Math.min(500,u)/500);a.aiScore=Q(Math.round((a.aiScore??0)+g),0,100)}j.sort((a,u)=>{const g=(u.aiScore??0)-(a.aiScore??0);if(g!==0)return g;const p=typeof a.distanceMi=="number"?a.distanceMi:Number.POSITIVE_INFINITY,y=typeof u.distanceMi=="number"?u.distanceMi:Number.POSITIVE_INFINITY;return p-y});try{const{scoreTopKWithAI:a}=await ht(async()=>{const{scoreTopKWithAI:g}=await import("./aiScoring-Czjr-gpW.js");return{scoreTopKWithAI:g}},__vite__mapDeps([0,1,2]),import.meta.url),u=await a(j,15,o);return u.__noResultsWithinRadius=V,T!=null&&T.length&&(u.__fallbackSimilar=T),globalThis[n]={data:u,ts:Date.now(),fingerprint:s},u.slice(0,t)}catch{return globalThis[n]={data:j,ts:Date.now(),fingerprint:s},j.slice(0,t)}}export{Wt as a,_t as c,zt as g,At as r};
