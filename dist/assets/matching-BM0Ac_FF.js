const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./aiScoring-BceqKYZR.js","./ctgov-D30T4kGK.js","./geocode-Cez6o5Pc.js"])))=>i.map(i=>d[i]);
import{_ as ct}from"./index-DLD9h1BK.js";import"./trials-DUAD2qh_.js";import{a as q,f as wt}from"./ctgov-D30T4kGK.js";import{a as lt,g as Mt}from"./geocode-Cez6o5Pc.js";function D(o,e=0,i=100){return Math.max(e,Math.min(i,o))}function It(){let o=0,e=0,i=0,n=0,s=0;try{const t=localStorage.getItem("auth:v1");if(t){const r=JSON.parse(t),c=(r==null?void 0:r.user)??{};c!=null&&c.email&&(o+=7),c!=null&&c.firstName&&(o+=7),c!=null&&c.lastName&&(o+=6)}}catch{}try{const t=localStorage.getItem("tc_consent");if(t){const r=JSON.parse(t),m=[r.section1,r.section2,r.section3,r.section4,r.final].reduce((b,u)=>b+(u?1:0),0);e=D(m*4,0,20)}}catch{}try{const t=localStorage.getItem("tc_docs");if(t){const r=JSON.parse(t),c=Array.isArray(r)?r.length:0;i=D(Math.min(c,4)*5,0,20)}}catch{}try{const t=JSON.parse(localStorage.getItem("tc_notify_email")||"true"),r=JSON.parse(localStorage.getItem("tc_notify_trials")||"true");n=(t?3:0)+(r?2:0)}catch{}try{const t=localStorage.getItem("tc_health_profile_v1");if(t){const r=JSON.parse(t),c=[r.weight,r.gender,r.phone,r.age,r.race,r.language,r.bloodGroup,r.genotype,r.primaryCondition,r.diagnosed,Array.isArray(r.allergies)&&r.allergies.length>0?"ok":"",Array.isArray(r.medications)&&r.medications.length>0?"ok":"",r.ecog,r.diseaseStage,r.biomarkers,Array.isArray(r.priorTherapies)&&r.priorTherapies.length>0?"ok":""],b=c.reduce((u,y)=>u+(y&&String(y).trim()!==""?1:0),0)/c.length;s=D(Math.round(b*35),0,35)}}catch{}const l={basics:o,consent:e,documents:i,notifications:n,healthProfile:s};return{percent:D(Math.round(o+e+i+n+s)),breakdown:l}}const vt="tc_health_profile_v1",U="tc_eligibility_profile";function Nt(){try{const o=localStorage.getItem(U);if(!o)return null;const i=JSON.parse(o).dob||"";if(!i)return null;const n=new Date(i);if(isNaN(n.getTime()))return null;const s=new Date;let l=s.getFullYear()-n.getFullYear();const d=s.getMonth()-n.getMonth();return(d<0||d===0&&s.getDate()<n.getDate())&&l--,l}catch{return null}}function z(){try{const o=localStorage.getItem(U);if(!o)return{loc:""};const e=JSON.parse(o),i=String(e.loc||"").trim(),n=String(e.radius||"").trim()||void 0;return{loc:i,radius:n}}catch{return{loc:""}}}function xt(){let o=null,e=null,i=null,n=[],s=[],l=null;try{const d=localStorage.getItem(vt);if(d){const t=JSON.parse(d),r=Number(t==null?void 0:t.age);o=Number.isFinite(r)?r:null,e=(t!=null&&t.gender?String(t.gender):"").trim()||null,i=(t!=null&&t.primaryCondition?String(t.primaryCondition):"").trim()||null,Array.isArray(t==null?void 0:t.medications)&&(n=t.medications.map(u=>String((u==null?void 0:u.name)||"").toLowerCase()).filter(Boolean)),Array.isArray(t==null?void 0:t.allergies)&&(s=t.allergies.map(u=>String((u==null?void 0:u.name)||"").toLowerCase()).filter(Boolean));const c=(t!=null&&t.additionalInfo?String(t.additionalInfo):"").trim(),m=[];if(t!=null&&t.ecog&&m.push(`ECOG: ${t.ecog}`),t!=null&&t.diseaseStage&&m.push(`Stage/Subtype: ${t.diseaseStage}`),t!=null&&t.biomarkers&&m.push(`Biomarkers: ${t.biomarkers}`),Array.isArray(t==null?void 0:t.priorTherapies)&&t.priorTherapies.length){const u=t.priorTherapies.map(y=>[y==null?void 0:y.name,y==null?void 0:y.date].filter(Boolean).join(" ")).filter(Boolean).join("; ");u&&m.push(`Prior tx: ${u}`)}if(t!=null&&t.comorbidityCardiac||t!=null&&t.comorbidityRenal||t!=null&&t.comorbidityHepatic||t!=null&&t.comorbidityAutoimmune){const u=[t.comorbidityCardiac&&"cardiac",t.comorbidityRenal&&"renal",t.comorbidityHepatic&&"hepatic",t.comorbidityAutoimmune&&"autoimmune"].filter(Boolean).join(", ");u&&m.push(`Comorbidities: ${u}`)}if(t!=null&&t.infectionHIV||t!=null&&t.infectionHBV||t!=null&&t.infectionHCV){const u=[t.infectionHIV&&"HIV",t.infectionHBV&&"HBV",t.infectionHCV&&"HCV"].filter(Boolean).join(", ");u&&m.push(`Infections: ${u}`)}l=[c,m.join(`
`)].filter(Boolean).join(`
`)||null}}catch{}if(o==null&&(o=Nt(),o==null))try{const d=localStorage.getItem(U);if(d){const t=JSON.parse(d),r=Number(t.age);Number.isFinite(r)&&(o=r)}}catch{}return{age:o,gender:e,primaryCondition:i,medications:n,allergies:s,additionalInfo:l}}const Tt=new Set(["the","a","an","and","or","of","for","to","in","on","with","without","by","at","from","about","into","over","after","before","is","are","be","being","been","this","that","these","those","study","trial","clinical","investigating","investigation","impact","patients","patient","therapy","treatment"]);function v(o){return o?o.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(e=>e&&!Tt.has(e)):[]}function Ct(o,e){if(!e.length)return!0;const i=o.toLowerCase();return e.every(n=>i.includes(n))}function kt(o,e){const i=v(e);return i.length?o.filter(n=>{var t,r,c,m;const s=(((r=(t=n.protocolSection)==null?void 0:t.identificationModule)==null?void 0:r.briefTitle)||"").toString(),l=(((m=(c=n.protocolSection)==null?void 0:c.conditionsModule)==null?void 0:m.conditions)||[]).join(" "),d=`${s} ${l}`;return Ct(d,i)}):o}function ut(o,e){if(o.length===0||e.length===0)return 0;const i=new Set(e);let n=0;for(const s of o)i.has(s)&&n++;return n}function J(o,e=0,i=100){return Math.max(e,Math.min(i,o))}function _t(o){var s,l;const e=((l=(s=o.protocolSection)==null?void 0:s.designModule)==null?void 0:l.phases)||[];if(!e||e.length===0)return"";const i=String(e[0]);if(/PHASE\s*1\/2/i.test(i)||/1\/2/.test(i))return"Phase I/II";if(/PHASE\s*2\/3/i.test(i)||/2\/3/.test(i))return"Phase II/III";const n=i.match(/\d+/);return n?`Phase ${n[0]}`:i}function Rt(o){var n,s;const e=(((s=(n=o.protocolSection)==null?void 0:n.statusModule)==null?void 0:s.overallStatus)||"").toString(),i=e.toUpperCase();return i==="RECRUITING"?"Recruiting":i==="ENROLLING_BY_INVITATION"?"Enrolling by invitation":e||""}function K(o){var i,n,s;const e=(s=(n=(i=o.protocolSection)==null?void 0:i.contactsLocationsModule)==null?void 0:n.locations)==null?void 0:s[0];return e?[e.city,e.state].filter(Boolean).join(", "):""}function ft(o){if(!o)return;const e=String(o).match(/([0-9]+)(mi|km)?/i);if(!e)return;const i=Number(e[1]);return Number.isFinite(i)?(e[2]||"mi").toLowerCase()==="km"?Math.round(i*.621371):i:void 0}function At(o,e,i,n){const s=m=>m*Math.PI/180,d=s(i-o),t=s(n-e),r=Math.sin(d/2)**2+Math.cos(s(o))*Math.cos(s(i))*Math.sin(t/2)**2;return 3958.8*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function gt(o){return(o||[]).flatMap(e=>v(e))}function dt(o){const e=(o||"").trim().toLowerCase();if(!e||e==="n/a"||e==="na"||e==="none")return;const i=e.match(/(\d+(?:\.\d+)?)/);if(!i)return;let n=Number(i[1]);if(Number.isFinite(n))return/month/.test(e)?n=n/12:/week/.test(e)?n=n/52:/day/.test(e)&&(n=n/365),n}function pt(o){var n,s,l,d;const e=dt((s=(n=o==null?void 0:o.protocolSection)==null?void 0:n.eligibilityModule)==null?void 0:s.minimumAge),i=dt((d=(l=o==null?void 0:o.protocolSection)==null?void 0:l.eligibilityModule)==null?void 0:d.maximumAge);return e==null&&i==null?null:{min:e??void 0,max:i??void 0,maxExclusive:!1}}function Et(o){var i,n;const e=(((n=(i=o==null?void 0:o.protocolSection)==null?void 0:i.eligibilityModule)==null?void 0:n.sex)||"").toString().trim().toLowerCase();return e?e==="all"?"all":e.startsWith("female")?"female":e.startsWith("male")?"male":null:null}function Lt(o,e){var B,E,L,$,k,_;const i=((E=(B=o.protocolSection)==null?void 0:B.identificationModule)==null?void 0:E.briefTitle)||"",n=v(i),s=(($=(L=o.protocolSection)==null?void 0:L.conditionsModule)==null?void 0:$.conditions)||[],l=gt(s),d=v(e.primaryCondition||""),t=v(e.additionalInfo||""),r=new Set(n.concat(l)),c=[];for(const F of d.concat(t))r.has(F)&&c.length<4&&c.push(F);const m=((_=(k=o.protocolSection)==null?void 0:k.statusModule)==null?void 0:_.overallStatus)||"",b=K(o),u=z(),y=[];m&&y.push(/recruit/i.test(m)?"Recruiting":m),c.length&&y.push(`Matched on: ${c.join(", ")}`),b&&y.push(`Site: ${b}`),u.loc&&y.push(`Near: ${u.loc}`),u.radius&&y.push(`Within ${u.radius}`);const C=y.join(" · ");return C.length>160?C.slice(0,157)+"...":C}function Pt(o,e){var I,N,W,H,P,V;const i=((N=(I=o.protocolSection)==null?void 0:I.identificationModule)==null?void 0:N.briefTitle)||"",n=v(i),s=((H=(W=o.protocolSection)==null?void 0:W.conditionsModule)==null?void 0:H.conditions)||[],l=gt(s),d=v(e.primaryCondition||""),t=v(e.additionalInfo||""),r=ut(n.concat(l),d.concat(t)),c=Math.max(1,d.length+t.length),m=J(r/c*100,0,100),b=Math.round(.6*m),u=((V=(P=o.protocolSection)==null?void 0:P.statusModule)==null?void 0:V.overallStatus)||"",y=/recruit/i.test(u)?25:10,C=v(K(o)),B=v(e.additionalInfo||""),E=z(),L=v(E.loc||""),$=ut(C,B.concat(L)),k=J($*5,0,15),{breakdown:_}=It(),F=Math.round(_.healthProfile/35*10);return J(y+b+Gt(e,o)+k+F,0,100)}function Gt(o,e){var d,t;const i=typeof o.age=="number"?o.age:null;if(i==null)return 0;const n=pt(e);if(n){const{min:r,max:c,maxExclusive:m}=n;return r!=null&&i<r||c!=null&&(m?i>=c:i>c)?0:5}const s=(((t=(d=e.protocolSection)==null?void 0:d.identificationModule)==null?void 0:t.briefTitle)||"").toString(),l=yt(s);return!l||l.min!=null&&i<l.min||l.max!=null&&(l.maxExclusive?i>=l.max:i>l.max)?0:5}function yt(o){const e=(o||"").toLowerCase();let i=e.match(/(\d{1,3})\s*(?:to|–|-|—)\s*(?:less\s+than\s*)?(\d{1,3})\s*(?:years?|yrs?|yo)\b/);if(i){const n=Number(i[1]),s=Number(i[2]),l=/less\s+than\s*\d{1,3}\s*(?:years?|yrs?|yo)\b/.test(e.slice(i.index||0,(i.index||0)+i[0].length));return{min:Number.isFinite(n)?n:void 0,max:Number.isFinite(s)?s:void 0,maxExclusive:l}}if(i=e.match(/(\d{1,3})\s*(?:years?|yrs?|yo)\s*(?:and\s*older|and\s*over|or\s*older)\b/),i){const n=Number(i[1]);return{min:Number.isFinite(n)?n:void 0}}if(i=e.match(/(?:under|less\s*than)\s*(\d{1,3})\s*(?:years?|yrs?|yo)\b/),i){const n=Number(i[1]);return{max:Number.isFinite(n)?n:void 0,maxExclusive:!0}}return/\b(pediatric|child|children|infant|adolescent)s?\b/.test(e)?{max:17,maxExclusive:!1}:/\bolder\s+adult|elderly|senior\b/.test(e)?{min:65}:/\badult(s)?\b/.test(e)&&!/\b(child|children|pediatric)\b/.test(e)?{min:18}:null}function A(o,e){const i=(o||"").toLowerCase();return e.some(n=>i.includes(n.toLowerCase()))}function Ot(o,e,i){var r,c;const n=(o.additionalInfo||"").toLowerCase(),s=(o.medications||[]).map(m=>String(m).toLowerCase()),l=`${(((c=(r=e.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toLowerCase()}
${(i||"").toLowerCase()}`;if(/(planned|schedule[rd])\s+(elective\s+)?(hepato|hepatobiliary|hepato[-\s]?pancreato[-\s]?biliary|pancreatic|colorectal)/.test(l)&&!A(n,["planned surgery","elective surgery","hepato","hepatobiliary","pancreat","colorectal","colectomy","whipple","hepatectomy"]))return{ok:!1,reason:"No qualifying elective HPB/colorectal surgery planned"};const t=["sildenafil","tadalafil","vardenafil","avanafil","pde5"];return A(l,["pde5","phosphodiesterase"])&&s.some(m=>t.some(b=>m.includes(b)))?{ok:!1,reason:"Daily PDE5 inhibitor"}:A(l,["tamsulosin therapy as a home medication","on tamsulosin at baseline","tamsulosin at baseline"])&&s.some(m=>m.includes("tamsulosin")||m.includes("flomax"))?{ok:!1,reason:"On tamsulosin at baseline"}:A(l,["genitourinary","gu procedure","urology procedure","prostate","bladder","ureter","kidney"])&&A(n,["prostate surgery","cystectomy","bladder surgery","ureter","nephrectomy","urology procedure"])?{ok:!1,reason:"GU procedure planned"}:A(l,["same day foley removal","remove foley on day of surgery","pod0"])&&A(n,["same day foley","pod0 foley removal","immediate catheter removal"])?{ok:!1,reason:"Same-day Foley removal planned"}:A(l,["ng tube retention","nasogastric tube retention","pod1"])&&A(n,["ng tube planned","nasogastric tube retention"])?{ok:!1,reason:"NG tube retention planned"}:{ok:!0}}function Bt(o){const e=(o||"").toLowerCase();return/(female|women|woman)\s*-?\s*only\b/.test(e)||/\bfemales?\s+only\b/.test(e)?"female":/(male|men|man)\s*-?\s*only\b/.test(e)||/\bmales?\s+only\b/.test(e)?"male":/women\sof\schild-bearing\s*potential|pregnan/i.test(e)?"female":null}function mt(o,e,i){var r,c;if(o==null||!Number.isFinite(o))return!0;const n=pt(e);if(n){const{min:m,max:b,maxExclusive:u}=n;return!(m!=null&&o<m||b!=null&&(u?o>=b:o>b))}const l=`${(((c=(r=e.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toString()}
${i||""}`,d=yt(l);if(!d)return!0;const t=o;return!(d.min!=null&&t<d.min||d.max!=null&&(d.maxExclusive?t>=d.max:t>d.max))}function ht(o,e,i){var r,c;const n=(o||"").toLowerCase();if(!n)return!0;const s=Et(e);if(s){if(s==="all")return!0;if(s==="female")return n.startsWith("fem");if(s==="male")return n.startsWith("male")}const d=`${(((c=(r=e.protocolSection)==null?void 0:r.identificationModule)==null?void 0:c.briefTitle)||"").toString()}
${i||""}`,t=Bt(d);return t?!(t==="female"&&!n.startsWith("fem")||t==="male"&&!n.startsWith("male")):!0}async function Vt(o=50){var V,Q,X,Z,tt,et,ot,nt,it,rt,st,at;const e="__tc_cached_matches_v1",i=globalThis[e];if((V=i==null?void 0:i.data)!=null&&V.length)return i.data.slice(0,o);const n=xt(),s=(n.primaryCondition||"").trim(),d=v(n.additionalInfo||"").slice(0,3).join(" "),t=s||d||"",r=Math.max(10,Math.min(100,o)),c=["RECRUITING","ENROLLING_BY_INVITATION"],{loc:m,radius:b}=z();let u={};try{u=await lt()||{}}catch{u={}}const y=(u==null?void 0:u.label)||m,C=ft(b),B=typeof C=="number"&&Number.isFinite(C),E=typeof u.lat=="number"&&typeof u.lng=="number",L=B&&E;if(B&&!E){const a=[];return a.__noResultsWithinRadius=!0,a}const $=async(a,f={withGeo:!0,withStatuses:!0})=>{const h={q:a,pageSize:r};if(f.withGeo&&E)if(h.loc=y,L){const p=`${C}mi`,S={...h,lat:u.lat,lng:u.lng,radius:p};return f.withStatuses?(await Promise.all(c.map(g=>q({...S,status:g})))).flatMap(g=>g.studies||[]):(await q(S)).studies||[]}else{const p={...h,lat:u.lat,lng:u.lng};return f.withStatuses?(await Promise.all(c.map(x=>q({...p,status:x})))).flatMap(x=>x.studies||[]):(await q(p)).studies||[]}return h.loc=y,f.withStatuses?(await Promise.all(c.map(S=>q({...h,status:S})))).flatMap(S=>S.studies||[]):(await q(h)).studies||[]},k=[{query:t,opts:{withGeo:!0,withStatuses:!0}},{query:t,opts:{withGeo:!0,withStatuses:!1},skipWhenEnforceRadius:!0},{query:t,opts:{withGeo:!1,withStatuses:!0}},{query:t,opts:{withGeo:!1,withStatuses:!1},skipWhenEnforceRadius:!0}];y&&k.push({query:"",opts:{withGeo:!0,withStatuses:!0},filterAfter:!!t}),k.push({query:"",opts:{withGeo:!1,withStatuses:!0},filterAfter:!!t,skipWhenEnforceRadius:!0}),s&&s!==t&&k.push({query:s,opts:{withGeo:!0,withStatuses:!0}});let _=[];for(const a of k)if(!(a.skipWhenEnforceRadius&&L))try{const f=await $(a.query,a.opts),h=a.filterAfter&&t?kt(f,t):f;if(h&&h.length>0){_=h;break}}catch{}_||(_=[]);const F=new Set,I=[];for(const a of _){const f=((X=(Q=a.protocolSection)==null?void 0:Q.identificationModule)==null?void 0:X.nctId)||"";if(!f||F.has(f))continue;const h=(((tt=(Z=a.protocolSection)==null?void 0:Z.statusModule)==null?void 0:tt.overallStatus)||"").toString().toUpperCase();if(h!=="RECRUITING"&&h!=="ENROLLING_BY_INVITATION"||!mt(n.age,a)||!ht(n.gender,a))continue;F.add(f);const p=((ot=(et=a.protocolSection)==null?void 0:et.identificationModule)==null?void 0:ot.briefTitle)||f,S=Rt(a),T=_t(a),x=((rt=(it=(nt=a.protocolSection)==null?void 0:nt.sponsorCollaboratorsModule)==null?void 0:it.leadSponsor)==null?void 0:rt.name)||"",g=K(a);let w=Pt(a,n),M;const R=((at=(st=a.protocolSection)==null?void 0:st.conditionsModule)==null?void 0:at.conditions)||[],j=Lt(a,n);try{const{getCachedAiScore:G}=await ct(async()=>{const{getCachedAiScore:Y}=await import("./aiScoring-BceqKYZR.js");return{getCachedAiScore:Y}},__vite__mapDeps([0,1,2]),import.meta.url),O=G(f,n);O&&typeof O.score=="number"&&(w=O.score,M=O.rationale)}catch{}I.push({slug:f.toLowerCase(),nctId:f,title:p,status:S,phase:T,aiScore:w,interventions:R.slice(0,3),center:x,location:g,reason:j,aiRationale:M})}let N,W=!1;try{const a=await lt(),f=typeof a.lat=="number"?a.lat:void 0,h=typeof a.lng=="number"?a.lng:void 0,p=ft(a.radius);if(N=p,f!=null&&h!=null){const S=Array.from(new Set(I.map(g=>(g.location||"").trim()).filter(Boolean))),T=new Map,x=await Promise.all(S.map(async g=>{try{const w=await Mt(g);return[g,w]}catch{return[g,null]}}));for(const[g,w]of x){const M=w&&typeof w.lat=="number"?w.lat:void 0,R=w&&typeof w.lng=="number"?w.lng:void 0;M!=null&&R!=null&&T.set(g,{lat:M,lng:R})}for(const g of I){const w=(g.location||"").trim(),M=w?T.get(w):void 0;if(M){const R=At(f,h,M.lat,M.lng);g.distanceMi=Math.round(R),g.inRadius=typeof p=="number"?R<=p:void 0}}}}catch{}if(L&&typeof N=="number"){const a=I.filter(f=>typeof f.distanceMi!="number"?!0:f.distanceMi<=N);W=a.length===0,I.length=0,I.push(...a)}else if(typeof N=="number"){const a=I.filter(f=>typeof f.distanceMi!="number"||f.distanceMi<=N);a.length>0&&(I.length=0,I.push(...a))}I.__noResultsWithinRadius=W;async function H(a,f){var T,x;const h=a.slice(0,Math.min(f,a.length)),p=[];for(let g=0;g<h.length;g+=10)p.push(h.slice(g,g+10));const S=new Set;for(const g of p){const w=await Promise.all(g.map(async M=>{try{return await wt(M.nctId)}catch{return{studies:[]}}}));for(let M=0;M<g.length;M++){const R=g[M],j=w[M],G=j.studies&&j.studies[0],O=(x=(T=G==null?void 0:G.protocolSection)==null?void 0:T.eligibilityModule)==null?void 0:x.eligibilityCriteria,Y=mt(n.age,G||{},O),bt=ht(n.gender,G||{},O),St=Ot(n,G||{},O);(!Y||!bt||!St.ok)&&S.add(R.nctId)}}return a.filter(g=>!S.has(g.nctId))}const P=await H(I,40);for(const a of P)if(typeof a.distanceMi=="number"){const f=a.distanceMi;let h=0;if(typeof N=="number"&&Number.isFinite(N)){const p=N;f<=p?h=25*(1-f/p):h=-15*Math.min(2,(f-p)/p)}else h=20*(1-Math.min(500,f)/500);a.aiScore=J(Math.round((a.aiScore??0)+h),0,100)}P.sort((a,f)=>{const h=(f.aiScore??0)-(a.aiScore??0);if(h!==0)return h;const p=typeof a.distanceMi=="number"?a.distanceMi:Number.POSITIVE_INFINITY,S=typeof f.distanceMi=="number"?f.distanceMi:Number.POSITIVE_INFINITY;return p-S});try{const{scoreTopKWithAI:a}=await ct(async()=>{const{scoreTopKWithAI:h}=await import("./aiScoring-BceqKYZR.js");return{scoreTopKWithAI:h}},__vite__mapDeps([0,1,2]),import.meta.url),f=await a(P,15,n);return globalThis[e]={data:f,ts:Date.now()},f.slice(0,o)}catch{return globalThis[e]={data:P,ts:Date.now()},P.slice(0,o)}}export{Pt as a,It as c,Vt as g,xt as r};
