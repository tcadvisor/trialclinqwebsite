import{R as a,u as v,j as e,L as w}from"./index-znp1ZwVH.js";import{g as C}from"./matching-uTvbvH7r.js";import{P as S}from"./PatientHeader-DPzpo3ls.js";import"./trials-DUAD2qh_.js";import"./ctgov-0NYeoFZ-.js";import"./geocode-C0RmwoTY.js";import"./HeaderActions-Bq1MN6TK.js";function I(){const[d,p]=a.useState(""),[l,u]=a.useState([]),[g,m]=a.useState(!1),[y,f]=a.useState(""),i=v();a.useMemo(()=>{const s=new URLSearchParams(i.search),t=Number(s.get("offset"));return Number.isFinite(t)&&t>0?Math.floor(t):0},[i.search]),a.useEffect(()=>{let s=!1;const t=async()=>{const N=await C(100);s||u(N)};t();const n=()=>t();return window.addEventListener("storage",n),window.addEventListener("visibilitychange",n),window.addEventListener("focus",n),()=>{s=!0,window.removeEventListener("storage",n),window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}},[]);const c=a.useMemo(()=>{const s=d.trim().toLowerCase();return s?l.filter(t=>[t.title,t.nctId,t.phase,t.status,t.location,t.center,...t.interventions].join(" ").toLowerCase().includes(s)):l},[d,l]),o=25,r=a.useMemo(()=>{const s=new URLSearchParams(i.search),t=Number(s.get("page"));return Number.isFinite(t)&&t>0?Math.floor(t):1},[i.search]),x=Math.max(1,Math.ceil(c.length/o)),j=a.useMemo(()=>c.slice((r-1)*o,r*o),[c,r,o]),h=(s,t)=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium whitespace-nowrap ${t==="green"?"bg-green-100 text-green-700":"bg-violet-100 text-violet-700"}`,children:s}),b=l.__noResultsWithinRadius===!0;return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(S,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Eligible Trials"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search",value:d,onChange:s=>p(s.target.value)})})]}),b&&l.length===0&&e.jsx("div",{className:"mb-6 rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-xl",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-900",children:"No trials found within your search radius"}),e.jsx("p",{className:"mt-1 text-sm text-amber-800",children:"We couldn't find any matching trials within your specified distance. Consider:"}),e.jsxs("ul",{className:"mt-2 list-inside list-disc space-y-1 text-sm text-amber-800",children:[e.jsx("li",{children:"Increasing your travel distance in your health profile"}),e.jsx("li",{children:"Checking your location is correctly set"}),e.jsx("li",{children:"Expanding your search to explore options further away"})]}),e.jsx("button",{onClick:()=>window.location.href="/patients/health-profile",className:"mt-3 inline-flex items-center gap-2 rounded-lg bg-amber-900 px-4 py-2 text-sm text-white hover:bg-amber-800",children:"Update Location Preferences →"})]})]})}),e.jsxs("div",{className:"overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Title"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial ID"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Phase"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Compatibility Score"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Interventions"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[j.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(w,{to:`/study/${s.nctId}`,state:{score:s.aiScore,rationale:s.aiRationale||s.reason},className:"text-gray-900 hover:underline",children:s.title})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.nctId}),e.jsx("td",{className:"px-4 py-3",children:h(s.status==="Now Recruiting"?"Recruiting":s.status,"green")}),e.jsx("td",{className:"px-4 py-3",children:h(s.phase,"violet")}),e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{children:[s.aiScore,"%"]}),(s.aiRationale||s.reason)&&e.jsx("button",{type:"button",onClick:()=>{f(`${s.title}

${s.aiRationale||s.reason}`),m(!0)},className:"ml-2 inline-flex items-center rounded-full border px-2 py-0.5 text-xs text-gray-600 hover:bg-gray-50","aria-label":"Why this match",children:"Why"})]}),(s.aiRationale||s.reason)&&e.jsx("div",{className:"mt-1 text-xs text-gray-500 line-clamp-2",children:s.aiRationale||s.reason})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.interventions.join(" / ")}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("a",{href:`https://clinicaltrials.gov/study/${encodeURIComponent(s.nctId)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-lg border px-3 py-1.5 text-xs hover:bg-gray-50",children:"View on ClinicalTrials.gov"})})]},s.slug)),c.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-6 text-center text-gray-500",children:["No trials to show. Add your primary condition and location in your ",e.jsx("a",{href:"/patients/health-profile",className:"underline",children:"Health Profile"})," to get matches."]})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-lg border px-3 py-1.5 hover:bg-gray-50 disabled:opacity-50",onClick:()=>{const s=Math.max(1,r-1),t=new URLSearchParams(i.search);t.set("page",String(s)),window.history.replaceState({},"",`${i.pathname}?${t.toString()}`)},disabled:r<=1,children:"Previous"}),e.jsx("button",{className:"rounded-lg border px-3 py-1.5 hover:bg-gray-50 disabled:opacity-50",onClick:()=>{const s=Math.min(x,r+1),t=new URLSearchParams(i.search);t.set("page",String(s)),window.history.replaceState({},"",`${i.pathname}?${t.toString()}`)},disabled:r>=x,children:"Next"})]}),e.jsxs("div",{children:["Page ",r," of ",x," · ",c.length," matches"]})]})]})]}),g&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-xl border bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Why this trial matches you"}),e.jsx("button",{className:"rounded-md p-1 text-gray-500 hover:bg-gray-100",onClick:()=>m(!1),"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"mt-3 whitespace-pre-wrap text-sm text-gray-700",children:y})]})]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{I as default};
