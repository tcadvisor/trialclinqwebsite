import{f as C,r,j as e,L as l}from"./index-DLD9h1BK.js";import{c as f,g as k}from"./matching-BM0Ac_FF.js";import{P as I}from"./PatientHeader-D7OzikkY.js";import"./trials-DUAD2qh_.js";import"./ctgov-D30T4kGK.js";import"./geocode-Cez6o5Pc.js";import"./HeaderActions-VMSc5EzH.js";function M(){const{user:n}=C(),d=n?`${n.firstName} ${n.lastName}`:"",[c,y]=r.useState(()=>f()),[b,m]=r.useState([]),[j,o]=r.useState(!1),[N,v]=r.useState(""),[w,x]=r.useState(!1),[R,h]=r.useState(!1),[p,u]=r.useState(null);return r.useEffect(()=>{let t=!1;const s=async()=>{try{h(!0),u(null);const i=await k(50);t||(m(i),x(i.__noResultsWithinRadius===!0))}catch(i){t||(m([]),x(!1),u(i instanceof Error?i.message:"Failed to load matches"))}finally{t||h(!1)}};s();const a=()=>s();return window.addEventListener("storage",a),window.addEventListener("visibilitychange",a),window.addEventListener("focus",a),()=>{t=!0,window.removeEventListener("storage",a),window.removeEventListener("visibilitychange",a),window.removeEventListener("focus",a)}},[]),r.useEffect(()=>{const t=()=>y(f());return t(),window.addEventListener("storage",t),window.addEventListener("visibilitychange",t),window.addEventListener("focus",t),()=>{window.removeEventListener("storage",t),window.removeEventListener("visibilitychange",t),window.removeEventListener("focus",t)}},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(I,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-semibold",children:["Welcome back, ",d]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Complete your health profile for better trial matches"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[c.percent,"%"]})]}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-gray-100",children:e.jsx("div",{className:"h-2 rounded-full bg-green-500",style:{width:`${c.percent}%`}})}),e.jsx(l,{to:"/patients/health-profile",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-gray-900 text-white px-3 py-2 text-sm hover:bg-black",children:"Complete now"})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-4",children:[e.jsx("div",{className:"text-sm font-medium",children:"Upload New Medical Record"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"You can quickly upload newly acquired medical records to make trial matches more specific"}),e.jsx("input",{ref:t=>{window.__dashUploadRef=t},type:"file",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];if(!s)return;const a=new FileReader;a.onload=()=>{try{const i=localStorage.getItem("tc_docs"),g=i?JSON.parse(i):[],E=`${Date.now()}_${Math.random().toString(36).slice(2)}`,S=(d||"You").trim()||"You",L={id:E,name:s.name,type:s.type,size:s.size,uploadedBy:S,uploadedAt:Date.now(),category:"Diagnostic Reports",url:a.result};g.unshift(L),localStorage.setItem("tc_docs",JSON.stringify(g));try{window.dispatchEvent(new Event("storage"))}catch{}alert("File added to your records. For detailed summarization, use Health Profile > Documents.")}catch{}try{t.target.value=""}catch{}},a.onerror=()=>{try{t.target.value=""}catch{}alert("Failed to read file.")},a.readAsDataURL(s)}}),e.jsx("button",{className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{const t=window.__dashUploadRef;t==null||t.click()},children:"Upload file"})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Consent Status"}),e.jsx("div",{className:"mt-2 text-lg font-semibold text-green-700",children:"Active"})]}),e.jsx("div",{className:"h-8 w-8 rounded-md bg-green-100"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Last updated: 17 Jun, 2025"})]}),e.jsxs("div",{className:"rounded-xl border border-blue-200 bg-blue-50 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"Connect Your EHR"}),e.jsx("p",{className:"mt-2 text-sm text-blue-700",children:"Securely import your electronic health records from your hospital or clinic to improve trial matching"}),e.jsx(l,{to:"/patients/ehr",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Connect Now"})]})]}),e.jsxs("section",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Trial Matches"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"}),e.jsx(l,{to:"/",className:"rounded-full border px-4 py-2 text-sm hover:bg-gray-50",children:"New search"})]})]}),R&&e.jsx("div",{className:"mt-4 rounded-lg border border-blue-100 bg-blue-50 px-4 py-3 text-sm text-blue-800",children:"Refreshing matches…"}),p&&e.jsx("div",{className:"mt-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:p}),w&&e.jsx("div",{className:"mt-4 rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-xl",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-900",children:"No trials found within your search radius"}),e.jsx("p",{className:"mt-1 text-sm text-amber-800",children:"We couldn't find any matching trials within your specified distance. Try increasing your travel distance to see more options."}),e.jsx(l,{to:"/patients/health-profile",className:"mt-2 inline-flex items-center gap-2 rounded-lg bg-amber-900 px-4 py-2 text-sm text-white hover:bg-amber-800",children:"Update Location Preferences →"})]})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50/80 backdrop-blur text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Title"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial ID"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Trial Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Compatibility Score"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Interventions"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:b.slice(0,4).map(t=>{var s;return e.jsxs("tr",{className:"border-t hover:bg-gray-50/60 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsx(l,{to:`/study/${t.nctId}`,state:{score:t.aiScore,rationale:t.aiRationale||t.reason},className:"text-gray-900 hover:underline line-clamp-2",children:t.title}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 flex flex-wrap gap-2",children:[t.location&&e.jsx("span",{children:t.location}),t.center&&e.jsxs("span",{className:"hidden sm:inline",children:["• ",t.center]})]})]}),e.jsx("td",{className:"px-4 py-3 text-gray-500 align-top whitespace-nowrap",children:t.nctId}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${(s=t.status)!=null&&s.includes("Recruiting")?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:t.status==="Now Recruiting"?"Recruiting":t.status})}),e.jsxs("td",{className:"px-4 py-3 align-top min-w-[180px]",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[t.aiScore,"%"]}),(t.aiRationale||t.reason)&&e.jsx("button",{type:"button",onClick:()=>{v(`${t.title}

${t.aiRationale||t.reason}`),o(!0)},className:"ml-2 inline-flex items-center rounded-full border px-2 py-0.5 text-xs text-gray-600 hover:bg-gray-100","aria-label":"Why this match",children:"Why"})]}),(t.aiRationale||t.reason)&&e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 line-clamp-2",children:t.aiRationale||t.reason})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 align-top max-w-[220px]",children:e.jsx("div",{className:"line-clamp-2",children:t.interventions.join(" / ")})}),e.jsx("td",{className:"px-4 py-3 text-right align-top",children:e.jsx("a",{href:`https://clinicaltrials.gov/study/${encodeURIComponent(t.nctId)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-lg border px-3 py-1.5 text-xs hover:bg-gray-50 whitespace-nowrap",children:"View on ClinicalTrials.gov"})})]},t.slug)})})]}),e.jsx(l,{to:"/patients/eligible?page=1",className:"border-t px-4 py-3 block text-sm text-gray-600 hover:bg-gray-50 text-center",children:"See more"})]})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>o(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-xl border bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Why this trial matches you"}),e.jsx("button",{className:"rounded-md p-1 text-gray-500 hover:bg-gray-100",onClick:()=>o(!1),"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"mt-3 whitespace-pre-wrap text-sm text-gray-700",children:N})]})]})]})}export{M as default};
