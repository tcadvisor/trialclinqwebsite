const l="trial_interests_local_v1";function i(){try{const s=localStorage.getItem(l);return s?JSON.parse(s):{}}catch{return{}}}function p(s){try{localStorage.setItem(l,JSON.stringify(s))}catch{console.warn("Failed to save interests to localStorage")}}async function d(s,a,o,r){try{console.log("[ExpressInterest] Starting request",{nctId:s,patientId:o,userId:r});const e=await fetch("/.netlify/functions/express-interest",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":r,"x-patient-id":o},body:JSON.stringify({nctId:s,trialTitle:a})});console.log("[ExpressInterest] Response received",{status:e.status,contentType:e.headers.get("content-type")});const t=await e.text();if(t.includes("<!DOCTYPE")||t.includes("<html"))throw console.warn("[ExpressInterest] Got HTML response - functions not available"),new Error("Functions not deployed");let n={ok:!1};if(t)try{n=JSON.parse(t)}catch(c){throw console.error("[ExpressInterest] Failed to parse JSON:",c),new Error("Invalid JSON response")}if(!e.ok)throw new Error(n.message||`HTTP ${e.status} error`);return{ok:!0,alreadyInterested:n.alreadyInterested||!1,message:n.message||"Interest expressed successfully"}}catch(e){e instanceof Error&&e.message,console.warn("[ExpressInterest] Using localStorage fallback");try{const t=i(),n=t[o]||[];return n.includes(s.toUpperCase())?{ok:!0,alreadyInterested:!0,message:"Interest already expressed (local)"}:(n.push(s.toUpperCase()),t[o]=n,p(t),{ok:!0,alreadyInterested:!1,message:"Interest expressed successfully (local)"})}catch(t){return console.error("[ExpressInterest] Fallback failed:",t),{ok:!1,message:"Could not express interest"}}}}async function u(s,a){try{const o=await fetch(`/.netlify/functions/get-trial-interests?nctId=${encodeURIComponent(s)}`,{method:"GET",headers:{"Content-Type":"application/json","x-user-id":a}}),r=await o.text();if(r.includes("<!DOCTYPE")||r.includes("<html"))throw console.warn("[GetInterests] Got HTML response - functions not available"),new Error("Functions not deployed");let e={ok:!1,interestedPatients:[]};if(r)try{e=JSON.parse(r)}catch(t){throw console.error("[GetInterests] Failed to parse JSON:",t),new Error("Invalid response format")}if(!o.ok)throw new Error(e.message||`HTTP ${o.status}: Failed to fetch interested patients`);return{ok:!0,patients:e.interestedPatients||[],count:e.count||0,message:e.message||"Success"}}catch{console.warn("[GetInterests] Using localStorage fallback");try{const r=i(),e=s.toUpperCase(),t=[];for(const[n,c]of Object.entries(r))c.includes(e)&&t.push({id:Math.random(),patientId:n,nctId:e,expressedAt:new Date().toISOString()});return{ok:!0,patients:t,count:t.length,message:t.length>0?"Success (local)":"No interested patients"}}catch(r){return console.error("[GetInterests] Fallback failed:",r),{ok:!1,patients:[],count:0,message:"Could not fetch interested patients"}}}}export{d as e,u as g};
