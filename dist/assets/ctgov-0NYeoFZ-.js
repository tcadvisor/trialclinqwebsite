async function l(e,t,r=15e3){const i=new AbortController;let o,n,c;try{t&&t.signal&&(o=t.signal,o.aborted?i.abort():(n=()=>i.abort(),o.addEventListener("abort",n))),c=setTimeout(()=>i.abort(),r);const a={...t||{},signal:i.signal},p=await fetch(e,a);return c&&clearTimeout(c),p}catch{return null}finally{if(c&&clearTimeout(c),o&&n)try{o.removeEventListener("abort",n)}catch{}}}const d={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function y({q:e="",status:t="",type:r="",loc:i="",lat:o,lng:n,radius:c,pageSize:a=12,pageToken:p="",pageNumber:S}){const M="https://clinicaltrials.gov/api/v2/studies",b=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.statusModule.startDateStruct","protocolSection.statusModule.primaryCompletionDateStruct"].join(","),s=new URLSearchParams;if(s.set("format","json"),s.set("pageSize",String(a)),s.set("fields",b),s.set("countTotal","true"),t){const u=m=>{const h=(m||"").trim();h&&s.append("filter.overallStatus",h.toUpperCase())};Array.isArray(t)?t.forEach(u):typeof t=="string"&&t.includes(",")?t.split(",").forEach(u):u(String(t))}if(r&&s.set("filter.studyType",r),e&&s.set("query.cond",e),typeof o=="number"&&typeof n=="number"){const u=c||"50mi";s.set("filter.geo",`distance(${o},${n},${u})`)}else i&&s.set("query.locn",i);return typeof S=="number"&&S>0&&s.set("pageNumber",String(S)),p&&s.set("pageToken",p),`${M}?${s.toString()}`}async function g(e,t){try{const r=(d==null?void 0:d.VITE_CT_PROXY_URL)||"/.netlify/functions/ctgov",i=await l(r,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"studies",query:e}),signal:t});if(i&&i.ok)return await i.json();if(i&&i.status===404)try{const o=y(e),n=await l(o,{method:"GET",signal:t});if(n&&n.ok)return await n.json()}catch{}if(i)try{const o=await i.json().catch(()=>null);if(o&&(Array.isArray(o.studies)||o.totalCount===0))return o}catch{}try{const o=y(e),n=await l(o,{method:"GET",signal:t});if(n&&n.ok)return await n.json()}catch{}return{studies:[]}}catch{try{const i=y(e),o=await l(i,{method:"GET",signal:t});if(o&&o.ok)return await o.json()}catch{}return{studies:[]}}}function w(e){var i,o,n;const t=(n=(o=(i=e.protocolSection)==null?void 0:i.contactsLocationsModule)==null?void 0:o.locations)==null?void 0:n[0];return[t==null?void 0:t.city,t==null?void 0:t.state,t==null?void 0:t.country].filter(Boolean).join(", ")}function T(e){var r,i;const t=(i=(r=e.protocolSection)==null?void 0:r.identificationModule)==null?void 0:i.nctId;return t?`https://clinicaltrials.gov/study/${t}`:"#"}function f(e){try{if(!e)return{studies:[]};if(Array.isArray(e.studies))return e;if(e.study)return{studies:[e.study]};if(e.protocolSection)return{studies:[e]}}catch{}return{studies:[]}}async function j(e,t){try{const r=(d==null?void 0:d.VITE_CT_PROXY_URL)||"/.netlify/functions/ctgov",i=await l(r,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"study",nctId:e}),signal:t});if(i&&i.ok)try{const o=await i.json();return f(o)}catch{}if(i&&i.status===404)try{const o=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria"].join(","),n=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(o)}`,c=await l(n,{method:"GET",signal:t});if(c&&c.ok){const a=await c.json();return f(a)}}catch{}if(i)try{const o=await i.json().catch(()=>null);if(o)return f(o)}catch{}try{const o=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria"].join(","),n=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(o)}`,c=await l(n,{method:"GET",signal:t});if(c&&c.ok){const a=await c.json();return f(a)}}catch{}return{studies:[]}}catch{try{const i=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria"].join(","),o=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(i)}`,n=await l(o,{method:"GET",signal:t});if(n&&n.ok){const c=await n.json();return f(c)}}catch{}return{studies:[]}}}export{g as a,w as b,T as c,j as f,l as s};
