async function a(e,o,r=15e3){const i=new AbortController;let t,n,c;try{o&&o.signal&&(t=o.signal,t.aborted?i.abort():(n=()=>i.abort(),t.addEventListener("abort",n))),c=setTimeout(()=>i.abort(),r);const l={...o||{},signal:i.signal},f=await fetch(e,l);return c&&clearTimeout(c),f}catch{return null}finally{if(c&&clearTimeout(c),t&&n)try{t.removeEventListener("abort",n)}catch{}}}const d={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function y({q:e="",status:o="",type:r="",loc:i="",lat:t,lng:n,radius:c,pageSize:l=12,pageToken:f="",pageNumber:S}){const g="https://clinicaltrials.gov/api/v2/studies",M=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.statusModule.startDateStruct","protocolSection.statusModule.primaryCompletionDateStruct","protocolSection.eligibilityModule.minimumAge","protocolSection.eligibilityModule.maximumAge","protocolSection.eligibilityModule.sex"].join(","),s=new URLSearchParams;if(s.set("format","json"),s.set("pageSize",String(l)),s.set("fields",M),s.set("countTotal","true"),o){const u=b=>{const m=(b||"").trim();m&&s.append("filter.overallStatus",m.toUpperCase())};Array.isArray(o)?o.forEach(u):typeof o=="string"&&o.includes(",")?o.split(",").forEach(u):u(String(o))}if(r&&s.set("filter.studyType",r),e&&s.set("query.cond",e),typeof t=="number"&&typeof n=="number"){const u=c||"50mi";s.set("filter.geo",`distance(${t},${n},${u})`)}else i&&s.set("query.locn",i);return typeof S=="number"&&S>0&&s.set("pageNumber",String(S)),f&&s.set("pageToken",f),`${g}?${s.toString()}`}async function h(e,o){try{const r=(d==null?void 0:d.VITE_CT_PROXY_URL)||"/.netlify/functions/ctgov",i=await a(r,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"studies",query:e}),signal:o});if(i&&i.ok)return await i.json();if(i&&i.status===404)try{const t=y(e),n=await a(t,{method:"GET",signal:o});if(n&&n.ok)return await n.json()}catch{}if(i)try{const t=await i.json().catch(()=>null);if(t&&(Array.isArray(t.studies)||t.totalCount===0))return t}catch{}try{const t=y(e),n=await a(t,{method:"GET",signal:o});if(n&&n.ok)return await n.json()}catch{}return{studies:[]}}catch{try{const i=y(e),t=await a(i,{method:"GET",signal:o});if(t&&t.ok)return await t.json()}catch{}return{studies:[]}}}function w(e){var i,t,n;const o=(n=(t=(i=e.protocolSection)==null?void 0:i.contactsLocationsModule)==null?void 0:t.locations)==null?void 0:n[0];return[o==null?void 0:o.city,o==null?void 0:o.state,o==null?void 0:o.country].filter(Boolean).join(", ")}function T(e){var r,i;const o=(i=(r=e.protocolSection)==null?void 0:r.identificationModule)==null?void 0:i.nctId;return o?`https://clinicaltrials.gov/study/${o}`:"#"}function p(e){try{if(!e)return{studies:[]};if(Array.isArray(e.studies))return e;if(e.study)return{studies:[e.study]};if(e.protocolSection)return{studies:[e]}}catch{}return{studies:[]}}async function j(e,o){try{const r=(d==null?void 0:d.VITE_CT_PROXY_URL)||"/.netlify/functions/ctgov",i=await a(r,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"study",nctId:e}),signal:o});if(i&&i.ok)try{const t=await i.json();return p(t)}catch{}if(i&&i.status===404)try{const t=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria","protocolSection.eligibilityModule.minimumAge","protocolSection.eligibilityModule.maximumAge","protocolSection.eligibilityModule.sex"].join(","),n=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(t)}`,c=await a(n,{method:"GET",signal:o});if(c&&c.ok){const l=await c.json();return p(l)}}catch{}if(i)try{const t=await i.json().catch(()=>null);if(t)return p(t)}catch{}try{const t=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria","protocolSection.eligibilityModule.minimumAge","protocolSection.eligibilityModule.maximumAge","protocolSection.eligibilityModule.sex"].join(","),n=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(t)}`,c=await a(n,{method:"GET",signal:o});if(c&&c.ok){const l=await c.json();return p(l)}}catch{}return{studies:[]}}catch{try{const i=["protocolSection.identificationModule.nctId","protocolSection.identificationModule.briefTitle","protocolSection.statusModule.overallStatus","protocolSection.conditionsModule.conditions","protocolSection.designModule.phases","protocolSection.contactsLocationsModule.locations","protocolSection.sponsorCollaboratorsModule.leadSponsor","protocolSection.descriptionModule.briefSummary","protocolSection.eligibilityModule.eligibilityCriteria"].join(","),t=`https://clinicaltrials.gov/api/v2/studies/${encodeURIComponent(e)}?format=json&fields=${encodeURIComponent(i)}`,n=await a(t,{method:"GET",signal:o});if(n&&n.ok){const c=await n.json();return p(c)}}catch{}return{studies:[]}}}export{h as a,w as b,T as c,j as f,a as s};
