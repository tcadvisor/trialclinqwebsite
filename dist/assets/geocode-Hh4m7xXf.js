import{s as y}from"./ctgov-D30T4kGK.js";const O={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},D="tc_geocode_cache_v1",E="tc_eligibility_profile",C={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"District of Columbia"};function F(l){const e=(l||"").trim();if(!e)return;const i=e.toUpperCase();if(C[i])return C[i];const n=e.toLowerCase();return Object.values(C).find(b=>b.toLowerCase()===n)}function P(){try{return JSON.parse(localStorage.getItem(D)||"{}")}catch{return{}}}function S(l){try{localStorage.setItem(D,JSON.stringify(l))}catch{}}function j(l){const e=l.trim().replace(/\s+/g," ");if(!e)return[];const i=[e],n=e.toLowerCase(),a=e.split(",").map(t=>t.trim()).filter(Boolean),b=a.length?a[a.length-1]:"",d=F(b);d&&b.length;const r=e.split(/[\s,]+/).map(t=>t.replace(/\./g,"").toUpperCase()).filter(Boolean).some(t=>!!C[t]),s=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","district of columbia","washington dc","washington d.c."];if(r||/\busa\b|\bunited states\b|\bUS\b/i.test(e)||n.includes(" united states")||i.push(`${e}, United States`),s.includes(n)&&i.push(`${e}, United States`),n==="new york"&&i.push("New York, NY"),n==="washington"&&i.push("Washington, DC"),d&&a.length>=2){const t=a.slice(0,-1).join(", ").trim();t&&(i.push(`${t}, ${d}`),i.push(`${t}, ${d}, United States`))}return d&&a.length===1&&(i.push(d),i.push(`${d}, United States`)),Array.from(new Set(i))}async function R(l){try{const e=new URLSearchParams({format:"jsonv2",limit:"1",q:l}),i=await y(`https://nominatim.openstreetmap.org/search?${e.toString()}`);if(!i||!i.ok)return null;const n=await i.json(),a=n==null?void 0:n[0],b=Number(a==null?void 0:a.lat),d=Number(a==null?void 0:a.lon),o=((a==null?void 0:a.display_name)||"").toString();return!Number.isFinite(b)||!Number.isFinite(d)?null:{lat:b,lng:d,label:o}}catch{return null}}function K(){try{const l=localStorage.getItem(E);if(!l)return{loc:""};const e=JSON.parse(l);return{loc:String(e.loc||"").trim(),radius:String(e.radius||"").trim()||void 0}}catch{return{loc:""}}}async function W(l){var e,i;try{const n=l.trim();if(!n)return null;const a=P();if(a[n])return{...a[n]};const d=(O==null?void 0:O.VITE_GEO_WEBHOOK_URL)||"/.netlify/functions/geocode";if(typeof window<"u"){const o=j(n);for(const r of o)try{const s=await y(d,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({q:r})});if(s&&s.ok){const c=await s.json(),t=Number(c.lat),h=Number(c.lng),u=typeof c.label=="string"?c.label:void 0;if(Number.isFinite(t)&&Number.isFinite(h))return a[n]={lat:t,lng:h,label:u},S(a),{lat:t,lng:h,label:u}}}catch{}for(const r of o){const s=await R(r);if(s)return a[n]={lat:s.lat,lng:s.lng,label:s.label},S(a),s}return null}try{const o=await y(d,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({q:n})});if(o&&o.ok){const r=await o.json(),s=Number(r.lat),c=Number(r.lng),t=typeof r.label=="string"?r.label:void 0;if(Number.isFinite(s)&&Number.isFinite(c))return a[n]={lat:s,lng:c,label:t},S(a),{lat:s,lng:c,label:t}}}catch{}try{let o=n;/^\s*(usa?|united\s+states?)\s*$/i.test(n)&&(o="United States");const r=(e=String(o).match(/^(\d{5})(?:-\d{4})?$/))==null?void 0:e[1];if(r)try{const s=await y(`https://api.zippopotam.us/us/${r}`);if(s&&s.ok){const c=await s.json(),t=(i=c==null?void 0:c.places)==null?void 0:i[0],h=Number(t==null?void 0:t.latitude),u=Number(t==null?void 0:t.longitude),k=String((t==null?void 0:t["place name"])||(t==null?void 0:t.place)||"").trim(),A=String((t==null?void 0:t["state abbreviation"])||(t==null?void 0:t.state)||"").trim(),p=[k,A].filter(Boolean).join(", ");if(Number.isFinite(h)&&Number.isFinite(u)&&A&&h>24&&h<50&&u>-130&&u<-65)return a[n]={lat:h,lng:u,label:p},S(a),{lat:h,lng:u,label:p}}}catch{}}catch{}try{const o=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","DC"],r=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming","district of columbia","washington dc","washington d.c."],s=n.toUpperCase(),c=n.toLowerCase(),h=o.some(m=>s.includes(m))||r.some(m=>c.includes(m))||/\busa\b|\bunited states\b|\bUS\b/i.test(n)||n.match(/\d{5}/),u=n.split(",").map(m=>m.trim()).filter(Boolean),k=u.length?u[u.length-1].toLowerCase():"",A=o.includes(k.toUpperCase())||r.includes(k),p={format:"jsonv2",limit:"10"};h&&(p.countrycodes="us");let U;if(u.length>=2&&A){const m=u.slice(0,-1).join(", ").trim(),w=u.slice(-1).join(", ").trim();U=new URLSearchParams({...p,city:m,state:w,country:"United States"})}else if(r.includes(c))U=new URLSearchParams({...p,state:n,country:"United States"});else{const m=h?`${n}, United States`:n;U=new URLSearchParams({...p,q:m})}try{const m=await y(`https://nominatim.openstreetmap.org/search?${U.toString()}`);if(m&&m.ok){const w=await m.json();if(w&&w.length>0){let g=w[0];if(h){const v=w.filter(f=>{const N=((f==null?void 0:f.display_name)||"").toUpperCase();return N.includes("UNITED STATES")||N.includes("USA")||N.includes(", US")||N.endsWith("US")});v.length>0?g=v[0]:g=w.find(f=>{const N=Number(f==null?void 0:f.lat),M=Number(f==null?void 0:f.lon);return Number.isFinite(N)&&Number.isFinite(M)&&N>24&&N<50&&M>-130&&M<-65})||g}const I=Number(g==null?void 0:g.lat),L=Number(g==null?void 0:g.lon),T=((g==null?void 0:g.display_name)||"").toString();if(Number.isFinite(I)&&Number.isFinite(L))return a[n]={lat:I,lng:L,label:T},S(a),{lat:I,lng:L,label:T}}}}catch{}}catch{}return null}catch{return null}}async function $(){const{loc:l,radius:e}=K();if(!l)return{radius:e};const i=await W(l);return i&&Number.isFinite(i.lat)&&Number.isFinite(i.lng)?{...i,radius:e}:{radius:e}}export{$ as a,W as g,K as r};
