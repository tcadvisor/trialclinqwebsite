import{f as j,R as d,j as e,L as o}from"./index-3kZk0rNx.js";import{S as v}from"./SiteHeader-CHrr19_Y.js";import{g as h}from"./providerTrials-D3cdPr4h.js";import{g as b}from"./trialInterests-GnY5KQLx.js";import"./HeaderActions-BUfyNln2.js";const w="provider:appointments:v1:";function I(s){return`${w}${s}`}function A(s){try{const c=I(s),t=localStorage.getItem(c);if(!t)return[];const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}function g(s){return A(s)}const S="provider:matches:v1:";function k(s){return`${S}${s}`}function $(s){try{const c=k(s),t=localStorage.getItem(c);if(!t)return[];const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}function u(s){return $(s)}function R(){const{user:s}=j(),c=s?`${s.firstName} ${s.lastName}`:"",t=(s==null?void 0:s.userId)||"",[a,y]=d.useState(()=>t?h(t):[]),[x,N]=d.useState(()=>t?g(t):[]),[T,f]=d.useState(()=>t?u(t):[]),[m,p]=d.useState(new Map);return d.useEffect(()=>{if(!t)return;const r=i=>{i.key===`provider:trials:v1:${t}`?y(h(t)):i.key===`provider:appointments:v1:${t}`?N(g(t)):i.key===`provider:matches:v1:${t}`&&f(u(t))};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[t]),d.useEffect(()=>{if(!t||a.length===0){p(new Map);return}(async()=>{const i=new Map;for(const n of a)try{const l=await b(n.nctId,t);l.ok&&l.patients.length>0&&i.set(n.nctId,l.patients)}catch(l){console.error(`Failed to fetch interested patients for ${n.nctId}:`,l)}p(i)})()},[t,a]),e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(v,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Welcome back, ",c]}),e.jsxs("div",{className:"mt-6 grid lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-50 grid place-items-center text-xl",children:"+"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Add or link a trial"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Connect an existing trial to your profile or register a new one to start managing participants and matches."})]})]}),e.jsx(o,{to:"/providers/trials",className:"mt-4 inline-block rounded-full bg-gray-900 px-4 py-2 text-white text-sm hover:bg-black",children:"Add new"})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-5",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Trials Managed"}),e.jsx("div",{className:"mt-2 text-3xl font-semibold",children:a.length}),e.jsx(o,{to:"/providers/trials/all",className:"mt-3 inline-block text-sm text-blue-600 hover:underline",children:"View"})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-5",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Upcoming Appointments"}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm",children:x.length===0?e.jsx("li",{className:"rounded-lg border p-3 text-gray-600",children:"No upcoming appointments"}):x.slice(0,2).map(r=>e.jsxs("li",{className:"rounded-lg border p-3",children:[r.title," — ",r.time," — ",r.location]},r.id))}),e.jsx(o,{to:"/providers/appointments",className:"mt-3 w-full inline-block rounded-full border px-4 py-2 text-sm hover:bg-gray-50",children:"View All Appointments"})]})]}),e.jsxs("div",{className:"mt-6 grid lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 rounded-2xl border bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"px-4 py-3",children:"Trial Title"}),e.jsx("th",{className:"px-4 py-3",children:"NCT ID"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Sponsor"})]})}),e.jsxs("tbody",{className:"divide-y",children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-gray-600",colSpan:4,children:'No trials added yet. Use "Active Clinical Trials" to add from ClinicalTrials.gov.'})}),a.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:r.title}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.nctId}),e.jsx("td",{className:"px-4 py-3",children:r.status||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:r.sponsor||"-"})]},r.nctId))]})]})}),e.jsx("div",{className:"p-4",children:e.jsx(o,{to:"/providers/trials/all",className:"w-full inline-block text-center rounded-full border px-4 py-2 text-sm hover:bg-gray-50",children:"View All Trials"})})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Interested Patients"}),m.size===0?e.jsx("div",{className:"mt-4 text-center text-sm text-gray-600 py-6",children:"No patients have expressed interest yet"}):e.jsx("ul",{className:"mt-2 space-y-2 text-sm",children:Array.from(m.entries()).flatMap(([r,i])=>i.slice(0,4).map(n=>{var l;return e.jsxs("li",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((l=n.email)==null?void 0:l.split("@")[0])||"Patient"}),e.jsx("div",{className:"text-gray-600 text-xs",children:n.primaryCondition||n.gender||"No condition info"}),e.jsx("div",{className:"text-gray-500 text-xs mt-0.5",children:r})]}),e.jsx("button",{className:"rounded-full border px-3 py-1 text-xs hover:bg-gray-50",children:"Contact"})]},`${n.patientId}-${r}`)})).slice(0,4)}),e.jsx(o,{to:"/providers/volunteers",className:"mt-3 w-full inline-block text-center rounded-full border px-4 py-2 text-sm hover:bg-gray-50",children:"View All Interested Patients"})]})]})]})]})}export{R as default};
