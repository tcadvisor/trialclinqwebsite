const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./aiScoring-BceqKYZR.js","./ctgov-D30T4kGK.js","./geocode-Cez6o5Pc.js"])))=>i.map(i=>d[i]);
import{g as ue,u as he,e as fe,f as pe,R as x,_ as ge,j as e}from"./index-tp3jFlXE.js";import{H as be}from"./HomeHeader-BtH9-5pg.js";import{B as S,M as ye,C as A,b as M,S as E,e as je}from"./separator-DtoYtvbq.js";import{f as ve,b as Ne}from"./ctgov-D30T4kGK.js";import{r as re,a as Se}from"./matching-BRrzpJrP.js";import{A as we}from"./arrow-left-CV5OS2nL.js";import{L as ke}from"./loader-circle-BrmCovGR.js";import"./HeaderActions-R4sMM2lu.js";import"./search-DJL6A17W.js";import"./shield-BsG1tWcS.js";import"./trials-DUAD2qh_.js";import"./geocode-Cez6o5Pc.js";function ne(o){const r=String(o||"").replace(/\r/g,"").trim();if(!r)return[];const n=r.split(/\n{2,}/).map(a=>a.trim()).filter(Boolean);return n.length>1?n:r.split(new RegExp("(?<=[.!?])\\s+(?=[A-Z(])")).map(a=>a.trim()).filter(Boolean)}function Ce(o){const r=(o||"").toLowerCase();let n=r.match(/(\d{1,3})\s*(?:to|–|-|—)\s*(?:less\s+than\s*)?(\d{1,3})\s*(?:years?|yrs?|yo)\b/);if(n){const a=Number(n[1]),c=Number(n[2]),m=/less\s+than\s*\d{1,3}\s*(?:years?|yrs?|yo)\b/.test(r.slice(n.index||0,(n.index||0)+n[0].length));return{min:Number.isFinite(a)?a:void 0,max:Number.isFinite(c)?c:void 0,maxExclusive:m}}if(n=r.match(/(\d{1,3})\s*(?:years?|yrs?|yo)\s*(?:and\s*older|and\s*over|or\s*older)\b/),n){const a=Number(n[1]);return{min:Number.isFinite(a)?a:void 0}}if(n=r.match(/(?:under|less\s*than)\s*(\d{1,3})\s*(?:years?|yrs?|yo)\b/),n){const a=Number(n[1]);return{max:Number.isFinite(a)?a:void 0,maxExclusive:!0}}return/\b(pediatric|child|children|infant|adolescent)s?\b/.test(r)?{max:17}:/\bolder\s+adult|elderly|senior\b/.test(r)?{min:65}:/\badult(s)?\b/.test(r)&&!/\b(child|children|pediatric)\b/.test(r)?{min:18}:null}function $e(o){const r=m=>{const t=[],j=m.replace(/\r/g,"").split(/\n+/);let d="";const v=()=>{const u=d.trim();u&&t.push(u),d=""};for(let u of j){const h=u.trim();if(!h){d&&v();continue}const w=h.match(/^(?:[\*\-•–—]\s+|\d+[\.)]\s+)/);w?(d&&v(),d=h.slice(w[0].length).trim()):d=d?d+" "+h:h}return d&&v(),t},n=String(o||"").trim();if(!n)return{inclusion:[],exclusion:[],notes:[]};const a=n.search(/inclusion\s+criteria/i),c=n.search(/exclusion\s+criteria/i);if(a>=0&&c>a){const m=n.slice(a,c).replace(/^[^\n]*\n?/,""),t=n.slice(c).replace(/^[^\n]*\n?/,"");return{inclusion:r(m),exclusion:r(t),notes:[]}}if(c>=0&&(a<0||c<a)){const m=n.slice(c).replace(/^[^\n]*\n?/,"");return{inclusion:[],exclusion:r(m),notes:[]}}return{inclusion:r(n),exclusion:[],notes:[]}}function le({value:o}){const c=2*Math.PI*37,m=Math.max(0,Math.min(100,Math.round(o))),t=c-m/100*c,j=x.useId();return e.jsxs("svg",{width:84,height:84,viewBox:"0 0 84 84","aria-label":`Match score ${m}%`,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:j,x1:"0",y1:"0",x2:String(84),y2:String(84),gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0%",stopColor:"#bfdbfe"}),e.jsx("stop",{offset:"100%",stopColor:"#1d4ed8"})]})}),e.jsx("circle",{cx:84/2,cy:84/2,r:37,stroke:"#e5e7eb",strokeWidth:10,fill:"none"}),e.jsx("circle",{cx:84/2,cy:84/2,r:37,stroke:`url(#${j})`,strokeWidth:10,fill:"none",strokeLinecap:"round",strokeDasharray:`${c} ${c}`,strokeDashoffset:t,transform:`rotate(-90 ${84/2} ${84/2})`}),e.jsxs("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",fontSize:"14",fontWeight:"700",fill:"#0f172a",children:[m,"%"]})]})}function Oe(){var O,T,D,G,U,V,Z,q,J,K,Q,X,Y,H,ee,te,se;const{nctId:o=""}=ue(),r=he(),n=fe(),{isAuthenticated:a}=pe(),c=r!=null&&r.state&&typeof r.state.score=="number"?r.state.score:null,m=r!=null&&r.state&&typeof r.state.rationale=="string"?r.state.rationale:"",[t,j]=x.useState(null),[d,v]=x.useState(!0),[u,h]=x.useState(""),[w,ae]=x.useState(!1),[I,oe]=x.useState(!1),[k,z]=x.useState(c),[B,ce]=x.useState(m);x.useEffect(()=>{let i=!0;return(async()=>{var l;v(!0),h("");try{const g=await ve(o);if(!i)return;const b=((l=g.studies)==null?void 0:l[0])||null;j(b)}catch{if(!i)return;h("Failed to load study details.")}finally{i&&v(!1)}})(),()=>{i=!1}},[o]);const C=((T=(O=t==null?void 0:t.protocolSection)==null?void 0:O.identificationModule)==null?void 0:T.briefTitle)||"",L=((G=(D=t==null?void 0:t.protocolSection)==null?void 0:D.statusModule)==null?void 0:G.overallStatus)||"",$=((V=(U=t==null?void 0:t.protocolSection)==null?void 0:U.conditionsModule)==null?void 0:V.conditions)||[],P=((q=(Z=t==null?void 0:t.protocolSection)==null?void 0:Z.designModule)==null?void 0:q.phases)||[],R=((Q=(K=(J=t==null?void 0:t.protocolSection)==null?void 0:J.sponsorCollaboratorsModule)==null?void 0:K.leadSponsor)==null?void 0:Q.name)||"",W=t?Ne(t):"";x.useEffect(()=>{let i=!1;return(async()=>{try{if(!o||!t)return;const l=re();if(k==null)try{z(Se(t,l))}catch{}try{const{scoreStudyWithAI:g}=await ge(async()=>{const{scoreStudyWithAI:ie}=await import("./aiScoring-BceqKYZR.js");return{scoreStudyWithAI:ie}},__vite__mapDeps([0,1,2]),import.meta.url),b=await g(o,l);!i&&b&&(z(b.score),ce(b.rationale||""))}catch{}}catch{}})(),()=>{i=!0}},[o,(Y=(X=t==null?void 0:t.protocolSection)==null?void 0:X.identificationModule)==null?void 0:Y.nctId]);const _=((ee=(H=t==null?void 0:t.protocolSection)==null?void 0:H.descriptionModule)==null?void 0:ee.briefSummary)||"",f=((se=(te=t==null?void 0:t.protocolSection)==null?void 0:te.eligibilityModule)==null?void 0:se.eligibilityCriteria)||"",{inclusion:N,exclusion:p}=$e(f),s=Ce(`${C}
${f}`);function de(){const i=[],l=re(),g=`${C}
${f}`.toLowerCase(),b=(l.additionalInfo||"").toLowerCase();if(((s==null?void 0:s.min)!=null||(s==null?void 0:s.max)!=null)&&(l.age==null||!Number.isFinite(l.age))){const y=(s==null?void 0:s.min)!=null&&(s==null?void 0:s.max)!=null?`${s.min}–${s.max} yrs`:(s==null?void 0:s.min)!=null?`${s.min}+ yrs`:`< ${s==null?void 0:s.max} yrs`;i.push(`Add your age or DOB (trial targets ${y}).`)}return(()=>{const y=g;return/(female|women)\s*-?\s*only\b/.test(y)||/\bfemales?\s+only\b/.test(y)?"female":/(male|men)\s*-?\s*only\b/.test(y)||/\bmales?\s+only\b/.test(y)?"male":null})()&&!(l.gender||"").trim()&&i.push("Add your gender (this study limits enrollment by gender)."),/(planned|schedule[rd]).{0,30}(elective\s+)?(hepato|hepatobiliary|hepato[-\s]?pancreato[-\s]?biliary|pancreatic|colorectal)/i.test(g)&&(/(planned surgery|elective surgery|hepato|hepatobiliary|pancreat|colorectal|colectomy|whipple|hepatectomy)/i.test(b)||i.push("Confirm a planned elective HPB/colorectal surgery (add in Additional Info).")),/\bECOG\b/i.test(f)&&!/ecog\s*:\s*\d/i.test(l.additionalInfo||"")&&i.push("Add your ECOG performance status."),/(biomarker|mutation|egfr|brca|pd-?l1|her2)/i.test(f)&&!/(biomarker|egfr|brca|pd-?l1|her2)/i.test(l.additionalInfo||"")&&i.push("Add key biomarkers relevant to your condition."),/(creatinine|egfr|bilirubin|alt|ast)/i.test(f)&&i.push("Provide recent lab values (e.g., creatinine, liver function) if available."),/(tamsulosin|pde5|sildenafil|tadalafil|vardenafil|avanafil)/i.test(f)&&(!Array.isArray(l.medications)||l.medications.length===0)&&i.push("List your current medications to verify drug restrictions."),Array.from(new Set(i))}const F=de(),me=w?N.length:Math.min(10,N.length),xe=I?p.length:Math.min(10,p.length);return e.jsxs("div",{className:"flex flex-col w-full items-center relative bg-white",children:[e.jsx(be,{}),e.jsxs("main",{className:"w-full max-w-[1000px] px-4 py-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 text-sm text-gray-600",children:e.jsxs("button",{onClick:()=>window.history.back(),className:"inline-flex items-center gap-1 text-blue-700 hover:underline",children:[e.jsx(we,{className:"w-4 h-4"})," Back to search"]})}),d&&e.jsxs("div",{className:"p-6 text-center text-gray-600 flex items-center justify-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"})," Loading study…"]}),!d&&u&&e.jsx("div",{className:"p-6 border border-red-200 bg-red-50 text-red-800 rounded-md",children:u}),!d&&!u&&!t&&e.jsx("div",{className:"p-6 border rounded-md text-gray-600",children:"Study not found or unavailable right now."}),!d&&!u&&t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold mb-3 leading-snug flex-1",children:C}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"text-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx(le,{value:k??0}),e.jsx("div",{className:"mt-1 text-xs text-gray-700",children:"Match score"})]}):e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"blur-md pointer-events-none opacity-60",children:e.jsx(le,{value:k??0})}),e.jsx("button",{onClick:()=>n("/patients/volunteer"),className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-500/10 to-blue-600/20 hover:from-blue-500/20 hover:to-blue-600/30 rounded-lg transition-all text-blue-700 font-semibold text-xs px-3 py-2",children:"Unlock Score"})]})})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[L&&e.jsx(S,{variant:"secondary",children:L}),P.length>0&&e.jsx(S,{variant:"secondary",children:P.join(", ")}),R&&e.jsx(S,{variant:"secondary",children:R}),o&&e.jsx(S,{className:"bg-gray-100 text-gray-700 hover:bg-gray-100",children:o}),s&&e.jsx(S,{className:"bg-amber-100 text-amber-800 hover:bg-amber-100",children:s.min!=null&&s.max!=null?`${s.min}–${s.max}${s.maxExclusive?" (max excl.)":""} yrs`:s.min!=null?`${s.min}+ yrs`:s.max!=null?`< ${s.max} yrs`:""})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-gray-700",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:W})]}),B&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Why: ",B]}),$&&$.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:$.slice(0,6).map(i=>e.jsx(S,{className:"bg-blue-50 text-blue-700 hover:bg-blue-50",children:i},i))})]}),e.jsx(A,{children:e.jsxs(M,{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Overview"}),e.jsx(E,{}),e.jsx("div",{className:"text-sm text-gray-700 space-y-3",children:ne(_).length>0?ne(_).map((i,l)=>e.jsx("p",{children:i},l)):e.jsx("p",{children:"No summary available."})})]})}),F.length>0&&e.jsx(A,{children:e.jsxs(M,{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"To confirm eligibility"}),e.jsx(E,{}),e.jsx("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-700",children:F.map((i,l)=>e.jsx("li",{children:i},l))}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Tip: update your ",e.jsx("a",{className:"underline",href:"/patients/health-profile",children:"Health Profile"})," so we can auto-check these."]})]})}),e.jsx(A,{children:e.jsxs(M,{className:"p-6 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Eligibility"}),e.jsx(E,{}),N.length===0&&p.length===0?e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:f||"Refer to sponsor for details."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Inclusion Criteria"}),e.jsx("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-700",children:N.slice(0,me).map((i,l)=>e.jsx("li",{children:i},l))}),N.length>10&&e.jsx("button",{className:"mt-2 text-xs text-blue-700 hover:underline",onClick:()=>ae(i=>!i),children:w?"Show less":`Show all (${N.length})`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Exclusion Criteria"}),p.length>0?e.jsx("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-700",children:p.slice(0,xe).map((i,l)=>e.jsx("li",{children:i},l))}):e.jsx("div",{className:"text-sm text-gray-700",children:"Not specified."}),p.length>10&&e.jsx("button",{className:"mt-2 text-xs text-blue-700 hover:underline",onClick:()=>oe(i=>!i),children:I?"Show less":`Show all (${p.length})`})]})]})]})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(je,{asChild:!0,className:"bg-gray-900 text-white rounded-full",children:e.jsx("a",{href:`https://clinicaltrials.gov/study/${o}`,target:"_blank",rel:"noreferrer",children:"View on ClinicalTrials.gov"})})})]})]})]})}export{Oe as default};
