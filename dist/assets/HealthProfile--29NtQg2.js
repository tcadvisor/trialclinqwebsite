import{c as xe,f as Ve,r as c,j as e,M as Oe,L as Le,i as Fe}from"./index-znp1ZwVH.js";import{P as ze}from"./PatientHeader-DPzpo3ls.js";import{U as Re}from"./user-BiBQecRE.js";import{C as Ue}from"./calendar-CgeODw4o.js";import{P as Ge}from"./phone-BA2C09La.js";import{P as F,T as me}from"./trash-2-B5wXd-Ny.js";import{P as ge}from"./plus-DUOaaLgi.js";import{C as _e}from"./circle-check-DX0H9v5i.js";import"./HeaderActions-Bq1MN6TK.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=xe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=xe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=xe("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),J="tc_health_profile_v1",$e="tc_health_profile_metadata_v1",We=new Set(["application/pdf"]),Ke=new Set([".pdf"]),ue=({syncedAt:m})=>m?e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs",children:[e.jsx("span",{children:"Synced from EPIC"}),m&&e.jsxs("span",{className:"text-blue-600",children:["— ",m]})]}):null,k=({title:m,children:g,right:S})=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:m}),S]}),e.jsx("div",{className:"p-4",children:g})]}),p=({label:m,value:g,icon:S,missing:I,epicSyncedAt:Y})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[S,e.jsx("span",{className:"text-sm",children:m})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm ${I?"text-red-600":"text-gray-900"}`,children:g||(I?"Required":"")}),Y&&e.jsx(ue,{syncedAt:Y})]})]});function Ze(m){if(m===0)return"0 B";const g=1024,S=["B","KB","MB","GB","TB"],I=Math.floor(Math.log(m)/Math.log(g));return`${parseFloat((m/Math.pow(g,I)).toFixed(2))} ${S[I]}`}function Qe(m){const g=new Date(m);return`${g.getMonth()+1}/${g.getDate()}/${g.getFullYear()}`}function Xe({onCountChange:m}){const[g,S]=c.useState("Diagnostic Reports"),[I,Y]=c.useState(""),[H,d]=c.useState(()=>{try{const l=localStorage.getItem("tc_docs");return l?JSON.parse(l):[]}catch{return[]}}),[E,s]=c.useState(1),n=10,z=c.useRef(null),{user:U}=Ve(),se=U?`${U.firstName} ${U.lastName}`:"You",[_,h]=c.useState(null);c.useEffect(()=>{localStorage.setItem("tc_docs",JSON.stringify(H)),m==null||m(H.length)},[H,m]);const q=c.useMemo(()=>H.filter(o=>o.category===g&&o.name.toLowerCase().includes(I.toLowerCase())),[H,g,I]),T=Math.max(1,Math.ceil(q.length/n)),W=q.slice((E-1)*n,E*n);c.useEffect(()=>{E>T&&s(T)},[T,E]);const ie=()=>{var l;return(l=z.current)==null?void 0:l.click()};function X(){try{const l=localStorage.getItem(J);if(l){const o=JSON.parse(l);if(o!=null&&o.patientId)return String(o.patientId);if(o!=null&&o.profileId)return String(o.profileId)}}catch{}return null}function y(l){if(We.has(l.type))return!0;const o=l.name.includes(".")?`.${l.name.split(".").pop()}`.toLowerCase():"";return!!o&&Ke.has(o)}async function V(l){const o=window.__clinicalSummaryUploaderProps||{};h({mode:"loading",message:"AI is reviewing the document..."});const f=o.summarizeApiUrl,P=o.writeProfileApiUrl,D=o.authHeaderName||"Authorization",te=o.getAuthTokenClientFnName||"getAuthToken",u=o.showEligibilityBadges!==void 0?!!o.showEligibilityBadges:!0;if(!f||!P){h(null);return}const C=X();if(!C){h({mode:"error",message:"Profile not found"});return}const Z=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{const B=window,$=B==null?void 0:B[te],ae=typeof $=="function"?await Promise.resolve($()):void 0;if(!ae){h({mode:"error",message:"Authentication failed"});return}const G=new FormData;G.append("file",l),G.append("profileId",C),G.append("uploadId",Z),G.append("options.showEligibilityBadges",String(!!u));const ne=new AbortController,R=await Promise.race([fetch(f,{method:"POST",headers:{[D]:`Bearer ${ae}`},body:G,signal:ne.signal}),new Promise((j,v)=>setTimeout(()=>{try{ne.abort()}catch{}v(new Error("timeout"))},12e4))]);if(!R||!R.ok){let j="Summarization failed";const v=R==null?void 0:R.status;try{const N=await R.json();N!=null&&N.error&&(j=`Summarization failed: ${N.error}`)}catch{try{const N=await R.text();N&&(j=`Summarization failed: ${N}`)}catch{}}v===415?j="Summarization failed: Unsupported file type. Please upload a PDF.":v===422?j="Summarization failed: The document looks non-medical or unreadable.":v&&(j=`${j} (HTTP ${v})`),h({mode:"error",message:j});return}const A=await R.json();if(!(A!=null&&A.summaryMarkdown)){h({mode:"error",message:A!=null&&A.error?`Summarization failed: ${A.error}`:"Summarization failed: No summary generated"});return}const oe=Fe({summaryMarkdown:A.summaryMarkdown,eligibility:A.eligibility,audit:A.audit},!!u),ce=new AbortController;if(!(await Promise.race([fetch(P,{method:"PUT",headers:{"Content-Type":"application/json",[D]:`Bearer ${ae}`},body:JSON.stringify({profileId:C,additionalInformationAppendMarkdown:oe}),signal:ce.signal}),new Promise((j,v)=>setTimeout(()=>{try{ce.abort()}catch{}v(new Error("timeout"))},12e4))])).ok){h({mode:"error",message:"Save failed"});return}try{const j=localStorage.getItem(J);if(j){const v=JSON.parse(j),N=v.additionalInfo||"";v.additionalInfo=(N?N+`

`:"")+oe,localStorage.setItem(J,JSON.stringify(v));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"DocumentsUploader"}}))}catch{}}}catch{}h({mode:"success",message:"Summary saved to Additional Information"}),z.current&&(z.current.value=""),setTimeout(()=>h(null),2e3)}catch{h({mode:"error",message:"Upload failed"}),setTimeout(()=>h(null),2500)}}async function le(l){if(!l||l.length===0)return;const o=Array.from(l),f=o.filter(u=>!y(u));if(f.length>0){const u=f.map(C=>C.name).join(", ");h({mode:"error",message:`Unsupported file type: ${u}. Use PDF.`}),setTimeout(()=>h(null),2500)}const P=o.filter(u=>y(u));if(P.length===0)return;const D=P.map(async u=>{const C=await new Promise((Z,B)=>{const $=new FileReader;$.onload=()=>Z($.result),$.onerror=()=>B(new Error("Failed to read file")),$.readAsDataURL(u)});return V(u),{id:`${Date.now()}_${Math.random().toString(36).slice(2)}`,name:u.name,size:u.size,type:u.type,uploadedBy:se,uploadedAt:Date.now(),category:g,url:C}}),te=await Promise.all(D);d(u=>[...te,...u])}function ee(l){const o=document.createElement("a");o.href=l.url,o.download=l.name,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function b(l){window.open(l.url,"_blank","noopener,noreferrer")}function O(l){const o=H.find(P=>P.id===l);if(!o)return;const f=prompt("Rename document",o.name);!f||f.trim()===""||d(P=>P.map(D=>D.id===l?{...D,name:f.trim()}:D))}function re(l){d(o=>o.filter(f=>f.id!==l))}const K=c.useMemo(()=>({diagnostic:H.filter(l=>l.category==="Diagnostic Reports").length,lab:H.filter(l=>l.category==="Lab Reports").length}),[H]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("button",{onClick:()=>S("Diagnostic Reports"),className:`relative pb-2 ${g==="Diagnostic Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Diagnostic Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:K.diagnostic})]}),e.jsxs("button",{onClick:()=>S("Lab Reports"),className:`relative pb-2 ${g==="Lab Reports"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Lab Reports ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:K.lab})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:I,onChange:l=>Y(l.target.value),className:"w-64 rounded-full border px-4 py-2 text-sm focus:outline-none",placeholder:"Search"})}),e.jsx("button",{onClick:ie,className:"inline-flex items-center gap-2 rounded-full bg-[#1033e5] text-white px-3 py-2 text-sm hover:bg-blue-700",children:"Upload document"}),e.jsx("input",{ref:z,className:"hidden",type:"file",multiple:!0,accept:".pdf,application/pdf",onChange:l=>le(l.target.files)})]})]}),_&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 flex items-center justify-center",role:"dialog","aria-live":"polite",children:e.jsxs("div",{className:"rounded-lg bg-white px-6 py-5 shadow-md text-center",children:[_.mode==="loading"&&e.jsx("div",{className:"mx-auto mb-3 h-6 w-6 border-2 border-gray-300 border-t-gray-900 rounded-full animate-spin","aria-hidden":"true"}),e.jsx("div",{className:`text-sm ${_.mode==="error"?"text-red-700":_.mode==="success"?"text-emerald-700":"text-gray-900"}`,children:_.message})]})}),e.jsxs("div",{className:"mt-4 overflow-hidden rounded-xl border bg-white",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Document Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Uploaded By"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date Uploaded"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsxs("tbody",{children:[W.map(l=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900",children:l.name}),e.jsx("span",{className:"text-xs text-gray-500",children:Ze(l.size)})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:l.uploadedBy}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:Qe(l.uploadedAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>b(l),className:"rounded-full border px-3 py-1.5 text-xs hover:bg-gray-50 inline-flex items-center gap-1",children:[e.jsx(Ye,{className:"w-4 h-4"})," View"]}),e.jsx("button",{onClick:()=>ee(l),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"download",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>O(l.id),className:"p-1.5 text-gray-600 hover:text-gray-900","aria-label":"rename",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(l.id),className:"p-1.5 text-red-600 hover:text-red-700","aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},l.id)),W.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-600",children:"No documents yet"})})]})]}),e.jsxs("div",{className:"border-t px-4 py-3 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Page ",E," of ",T]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:E===1,onClick:()=>s(l=>Math.max(1,l-1)),className:`rounded-lg border px-3 py-1.5 ${E===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{disabled:E===T,onClick:()=>s(l=>Math.min(T,l+1)),className:`rounded-lg border px-3 py-1.5 ${E===T?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})]})]})]})}function ct(){var N,he,ye,fe,je,ve,be,Ne,we,Se,Ce,Ae,ke,Ie,Ee,Pe,De,Me,He,Te;const{user:m}=Ve(),[g,S]=c.useState("overview"),[I,Y]=c.useState(()=>{try{const a=localStorage.getItem("tc_docs");return a?JSON.parse(a).length:0}catch{return 0}}),[H]=c.useState(()=>{try{return!localStorage.getItem(J)}catch{return!0}}),[d,E]=c.useState(()=>{try{const a=localStorage.getItem($e);if(a)return JSON.parse(a)}catch{}return{fieldSources:{}}}),[s,n]=c.useState(()=>{try{const a=localStorage.getItem(J);if(a)return JSON.parse(a)}catch{}return{patientId:"CUS_j2kthfmgv3bzr5r",email:"",emailVerified:!1,age:"",weight:"",phone:"",gender:"",race:"",language:"",bloodGroup:"",genotype:"",hearingImpaired:!1,visionImpaired:!1,primaryCondition:"",diagnosed:"",allergies:[],medications:[],additionalInfo:"",ecog:"",diseaseStage:"",biomarkers:"",priorTherapies:[],comorbidityCardiac:!1,comorbidityRenal:!1,comorbidityHepatic:!1,comorbidityAutoimmune:!1,infectionHIV:!1,infectionHBV:!1,infectionHCV:!1}});c.useEffect(()=>{try{const a=localStorage.getItem("epic:patient:v1");if(!a)return;const i=JSON.parse(a).profileData;if(!i)return;const r={...d.fieldSources},x={};i.age&&!s.age&&(x.age=i.age.value,r.age={value:i.age.value,source:"epic",syncedAt:i.age.syncedAt}),i.gender&&!s.gender&&(x.gender=i.gender.value,r.gender={value:i.gender.value,source:"epic",syncedAt:i.gender.syncedAt}),i.primaryCondition&&!s.primaryCondition&&(x.primaryCondition=i.primaryCondition.value,r.primaryCondition={value:i.primaryCondition.value,source:"epic",syncedAt:i.primaryCondition.syncedAt}),i.medications&&(!s.medications||s.medications.length===0)&&(x.medications=i.medications.value,r.medications={value:i.medications.value,source:"epic",syncedAt:i.medications.syncedAt}),i.allergies&&(!s.allergies||s.allergies.length===0)&&(x.allergies=i.allergies.value,r.allergies={value:i.allergies.value,source:"epic",syncedAt:i.allergies.syncedAt}),Object.keys(x).length>0&&(n(M=>({...M,...x})),E({fieldSources:r}),console.log("[HealthProfile] Auto-filled from EPIC data:",x))}catch(a){console.error("[HealthProfile] Error loading EPIC data:",a)}},[]),c.useEffect(()=>{n(a=>{let t={...a};(!t.email||t.email==="")&&(m!=null&&m.email)&&(t.email=m.email);try{const i=localStorage.getItem("tc_eligibility_profile");if(i){const r=JSON.parse(i),x=r.dob||"",M=()=>{if(!x)return"";const w=new Date(x);if(isNaN(w.getTime()))return"";const L=new Date;let Q=L.getFullYear()-w.getFullYear();const de=L.getMonth()-w.getMonth();return(de<0||de===0&&L.getDate()<w.getDate())&&Q--,String(Q)};t.age||(t.age=r.age||M()),r.gender&&!t.gender&&(t.gender=r.gender),r.race&&!t.race&&(t.race=r.race),r.language&&!t.language&&(t.language=r.language),r.weight&&!t.weight&&(t.weight=r.weight),r.condition&&!t.primaryCondition&&(t.primaryCondition=r.condition),r.year&&!t.diagnosed&&(t.diagnosed=r.year)}}catch{}return Array.isArray(t.allergies)||(t.allergies=[]),Array.isArray(t.medications)||(t.medications=[]),Array.isArray(t.priorTherapies)||(t.priorTherapies=[]),typeof t.ecog!="string"&&(t.ecog=""),typeof t.diseaseStage!="string"&&(t.diseaseStage=""),typeof t.biomarkers!="string"&&(t.biomarkers=""),t.comorbidityCardiac=!!t.comorbidityCardiac,t.comorbidityRenal=!!t.comorbidityRenal,t.comorbidityHepatic=!!t.comorbidityHepatic,t.comorbidityAutoimmune=!!t.comorbidityAutoimmune,t.infectionHIV=!!t.infectionHIV,t.infectionHBV=!!t.infectionHBV,t.infectionHCV=!!t.infectionHCV,t})},[m]),c.useEffect(()=>{try{localStorage.setItem(J,JSON.stringify(s))}catch{}try{localStorage.setItem($e,JSON.stringify(d))}catch{}try{window.dispatchEvent(new Event("storage"))}catch{}try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile"}}))}catch{}},[s,d]),c.useEffect(()=>{const a=t=>{var i;try{const r=localStorage.getItem(J);if(r){const x=JSON.parse(r);if(t instanceof CustomEvent&&((i=t.detail)==null?void 0:i.source)==="HealthProfile")return;n(x)}}catch{}};return window.addEventListener("tc_profile_updated",a),window.addEventListener("focus",a),window.addEventListener("visibilitychange",a),()=>{window.removeEventListener("tc_profile_updated",a),window.removeEventListener("focus",a),window.removeEventListener("visibilitychange",a)}},[]);const[z,U]=c.useState(!1),[se,_]=c.useState(!1),[h,q]=c.useState(!1),[T,W]=c.useState(!1),[ie,X]=c.useState(!1),[y,V]=c.useState({name:"",reaction:"",severity:void 0,note:""}),[le,ee]=c.useState(!1),[b,O]=c.useState({name:"",dose:"",amountDaily:"",schedule:""}),[re,K]=c.useState(!1),[l,o]=c.useState({name:"",date:""}),[f,P]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"";const t=JSON.parse(a);return String(t.loc||"")}catch{return""}}),[D,te]=c.useState(()=>{try{const a=localStorage.getItem("tc_eligibility_profile");if(!a)return"50mi";const t=JSON.parse(a);return String(t.radius||"50mi")}catch{return"50mi"}}),[u,C]=c.useState("idle"),[Z,B]=c.useState("");function $(){C("saving");try{const a=localStorage.getItem("tc_eligibility_profile"),i={...a?JSON.parse(a):{},loc:f.trim(),radius:D};localStorage.setItem("tc_eligibility_profile",JSON.stringify(i)),window.dispatchEvent(new Event("storage"));try{window.dispatchEvent(new CustomEvent("tc_profile_updated",{detail:{source:"HealthProfile",updated:["loc","radius"]}}))}catch{}B("Preferences saved"),C("saved"),setTimeout(()=>C("idle"),2e3)}catch{B("Could not save. Please try again."),C("error")}}function ae(){X(!0)}function G(){y.name.trim()&&(n(a=>{var t,i;return{...a,allergies:[...a.allergies,{name:y.name.trim(),reaction:((t=y.reaction)==null?void 0:t.trim())||void 0,severity:y.severity,note:((i=y.note)==null?void 0:i.trim())||void 0}]}}),V({name:"",reaction:"",severity:void 0,note:""}),X(!1))}function ne(){V({name:"",reaction:"",severity:void 0,note:""}),X(!1)}function R(a){const t=s.allergies[a],i=prompt("Edit allergy name",t==null?void 0:t.name);if(!i)return;const r=prompt("Edit reaction (optional)",(t==null?void 0:t.reaction)||"")||void 0,x=prompt("Edit severity (Mild, Moderate, Severe) (optional)",(t==null?void 0:t.severity)||"")||void 0,M=x==="Mild"||x==="Moderate"||x==="Severe"?x:void 0,w=prompt("Edit notes (optional)",(t==null?void 0:t.note)||"")||void 0;n(L=>({...L,allergies:L.allergies.map((Q,de)=>de===a?{name:i.trim(),reaction:(r==null?void 0:r.trim())||void 0,severity:M,note:(w==null?void 0:w.trim())||void 0}:Q)}))}function A(a){n(t=>({...t,allergies:t.allergies.filter((i,r)=>r!==a)}))}function oe(){ee(!0)}function ce(){b.name.trim()&&(n(a=>{var t,i,r;return{...a,medications:[...a.medications,{name:b.name.trim(),dose:((t=b.dose)==null?void 0:t.trim())||void 0,amountDaily:((i=b.amountDaily)==null?void 0:i.trim())||void 0,schedule:((r=b.schedule)==null?void 0:r.trim())||void 0}]}}),O({name:"",dose:"",amountDaily:"",schedule:""}),ee(!1))}function pe(){O({name:"",dose:"",amountDaily:"",schedule:""}),ee(!1)}function j(a){const t=s.medications[a],i=prompt("Edit medication name",t==null?void 0:t.name);if(!i)return;const r=prompt("Edit dose (optional)",(t==null?void 0:t.dose)||"")||void 0,x=prompt("Edit amount taken daily (optional)",(t==null?void 0:t.amountDaily)||"")||void 0,M=prompt("Edit schedule (optional)",(t==null?void 0:t.schedule)||"")||void 0;n(w=>({...w,medications:w.medications.map((L,Q)=>Q===a?{name:i.trim(),dose:(r==null?void 0:r.trim())||void 0,amountDaily:(x==null?void 0:x.trim())||void 0,schedule:(M==null?void 0:M.trim())||void 0}:L)}))}function v(a){n(t=>({...t,medications:t.medications.filter((i,r)=>r!==a)}))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e.jsx(ze,{}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold",children:"Health Profile"}),(()=>{const a=m?`${m.firstName} ${m.lastName}`:"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-gray-700",children:a}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})})(),e.jsxs("div",{className:"mt-6 flex items-center gap-6 text-sm",children:[e.jsx("button",{onClick:()=>S("overview"),className:`relative pb-2 ${g==="overview"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>S("documents"),className:`relative pb-2 flex items-center gap-2 ${g==="documents"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:["Documents ",e.jsx("span",{className:"ml-1 inline-flex items-center justify-center px-1.5 h-5 text-xs rounded-full bg-gray-100",children:I})]}),e.jsx("button",{onClick:()=>S("ehr"),className:`relative pb-2 ${g==="ehr"?"border-b-2 border-[#1033e5] text-gray-900":"text-gray-600"}`,children:"Connected Medical Records"})]}),g==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(k,{title:"Personal Details",right:z?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>U(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>U(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>U(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(F,{className:"w-4 h-4"})," Edit"]}),children:z?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Patient ID",e.jsx("input",{value:s.patientId,onChange:a=>n(t=>({...t,patientId:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Email",e.jsx("input",{value:s.email,onChange:a=>n(t=>({...t,email:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Age",e.jsx("input",{value:s.age,onChange:a=>n(t=>({...t,age:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Weight",e.jsx("input",{value:s.weight,onChange:a=>n(t=>({...t,weight:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Phone Number",e.jsx("input",{value:s.phone,onChange:a=>n(t=>({...t,phone:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Gender",e.jsxs("select",{value:s.gender,onChange:a=>n(t=>({...t,gender:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Non-binary"}),e.jsx("option",{children:"Prefer not to say"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Race",e.jsx("input",{value:s.race,onChange:a=>n(t=>({...t,race:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Language Preference",e.jsx("input",{value:s.language,onChange:a=>n(t=>({...t,language:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsx("div",{className:"sm:col-span-2 flex items-center gap-2 text-sm mt-1",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${s.emailVerified?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.emailVerified?"Verified":"Not verified"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(p,{label:"Patient ID",value:s.patientId,icon:e.jsx(Re,{className:"w-4 h-4"}),epicSyncedAt:(N=d.fieldSources.patientId)==null?void 0:N.syncedAt}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:`${s.emailVerified?"text-emerald-700":"text-amber-600"} text-xs`,children:s.emailVerified?"Verified":"Not verified"})]})]}),e.jsx(p,{label:"Age",value:s.age,icon:e.jsx(Ue,{className:"w-4 h-4"}),missing:!s.age,epicSyncedAt:(he=d.fieldSources.age)==null?void 0:he.syncedAt}),e.jsx(p,{label:"Weight",value:s.weight,icon:e.jsx(qe,{className:"w-4 h-4"}),missing:!s.weight,epicSyncedAt:(ye=d.fieldSources.weight)==null?void 0:ye.syncedAt}),e.jsx(p,{label:"Phone Number",value:s.phone,icon:e.jsx(Ge,{className:"w-4 h-4"}),missing:!s.phone,epicSyncedAt:(fe=d.fieldSources.phone)==null?void 0:fe.syncedAt}),e.jsx(p,{label:"Gender",value:s.gender,icon:e.jsx(Re,{className:"w-4 h-4"}),missing:!s.gender,epicSyncedAt:(je=d.fieldSources.gender)==null?void 0:je.syncedAt}),e.jsx(p,{label:"Race",value:s.race,missing:!s.race,epicSyncedAt:(ve=d.fieldSources.race)==null?void 0:ve.syncedAt}),e.jsx(p,{label:"Language Preference",value:s.language,missing:!s.language,epicSyncedAt:(be=d.fieldSources.language)==null?void 0:be.syncedAt})]})})}),e.jsx("div",{children:e.jsxs(k,{title:"Allergies",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.allergies||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((Ne=d.fieldSources.allergies)==null?void 0:Ne.syncedAt)&&e.jsx(ue,{syncedAt:d.fieldSources.allergies.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.allergies.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[a.name,a.severity&&e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700",children:a.severity})]}),(a.reaction||a.note)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.reaction,a.note].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>R(t),"aria-label":"edit",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.allergies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No allergies added"})]}),ie&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Allergy Name",e.jsx("input",{value:y.name,onChange:a=>V(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Severity",e.jsxs("select",{value:y.severity||"",onChange:a=>V(t=>({...t,severity:a.target.value||void 0})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Mild"}),e.jsx("option",{children:"Moderate"}),e.jsx("option",{children:"Severe"})]})]}),e.jsxs("label",{className:"text-gray-700",children:["Reaction",e.jsx("input",{value:y.reaction||"",onChange:a=>V(t=>({...t,reaction:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700 sm:col-span-2",children:["Notes",e.jsx("input",{value:y.note||"",onChange:a=>V(t=>({...t,note:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:ne,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:G,disabled:!y.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${y.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!ie&&e.jsxs("button",{onClick:ae,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another allergy"]})]})})]}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{title:"Travel Preferences",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Home location (City, State or ZIP)",e.jsx("input",{value:f,onChange:a=>P(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g. 10001 or Buffalo, NY"})]}),e.jsxs("label",{className:"text-gray-700",children:["Travel radius",e.jsx("select",{value:D,onChange:a=>te(a.target.value),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["25mi","50mi","100mi","200mi","300mi","500mi","1000mi"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:$,disabled:u==="saving",className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${u==="saving"?"bg-gray-400 text-white cursor-wait":"bg-gray-900 text-white"}`,children:u==="saving"?"Saving…":"Save"}),u==="saved"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-emerald-700",children:[e.jsx(_e,{className:"w-4 h-4"})," ",Z]}),u==="error"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Be,{className:"w-4 h-4"})," ",Z]})]})]})}),e.jsxs(k,{title:"Medications",right:e.jsxs("div",{className:"flex items-center gap-2",children:[(s.medications||[]).length===0&&e.jsx("span",{className:"text-red-600 text-xs",children:"Required"}),((we=d.fieldSources.medications)==null?void 0:we.syncedAt)&&e.jsx(ue,{syncedAt:d.fieldSources.medications.syncedAt})]}),children:[e.jsxs("ul",{className:"divide-y",children:[s.medications.map((a,t)=>e.jsxs("li",{className:"py-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.name}),(a.dose||a.amountDaily||a.schedule)&&e.jsx("div",{className:"text-xs text-gray-600",children:[a.dose,a.amountDaily?`${a.amountDaily} per day`:"",a.schedule].filter(Boolean).join(" • ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>j(t),"aria-label":"edit",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(t),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.medications||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No medications listed"})]}),le&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Medication Name",e.jsx("input",{value:b.name,onChange:a=>O(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Dose",e.jsx("input",{value:b.dose||"",onChange:a=>O(t=>({...t,dose:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Amount taken daily",e.jsx("input",{value:b.amountDaily||"",onChange:a=>O(t=>({...t,amountDaily:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Schedule",e.jsx("input",{value:b.schedule||"",onChange:a=>O(t=>({...t,schedule:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:pe,className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:!b.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${b.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!le&&e.jsxs("button",{onClick:oe,className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add another medication"]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(k,{title:"Health Profile",right:se?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>_(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>_(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>_(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(F,{className:"w-4 h-4"})," Edit"]}),children:se?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["Blood Group",e.jsx("select",{value:s.bloodGroup,onChange:a=>n(t=>({...t,bloodGroup:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Genotype",e.jsx("input",{value:s.genotype,onChange:a=>n(t=>({...t,genotype:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Hearing Impaired",e.jsxs("select",{value:s.hearingImpaired?"Yes":"No",onChange:a=>n(t=>({...t,hearingImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Vision Impaired",e.jsxs("select",{value:s.visionImpaired?"Yes":"No",onChange:a=>n(t=>({...t,visionImpaired:a.target.value==="Yes"})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Primary Condition",e.jsx("input",{value:s.primaryCondition,onChange:a=>n(t=>({...t,primaryCondition:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Diagnosed",e.jsx("input",{value:s.diagnosed,onChange:a=>n(t=>({...t,diagnosed:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(p,{label:"Blood Group",value:s.bloodGroup,missing:!s.bloodGroup,epicSyncedAt:(Se=d.fieldSources.bloodGroup)==null?void 0:Se.syncedAt}),e.jsx(p,{label:"Genotype",value:s.genotype,missing:!s.genotype,epicSyncedAt:(Ce=d.fieldSources.genotype)==null?void 0:Ce.syncedAt}),e.jsx(p,{label:"Hearing Impaired",value:s.hearingImpaired?"Yes":"No",epicSyncedAt:(Ae=d.fieldSources.hearingImpaired)==null?void 0:Ae.syncedAt}),e.jsx(p,{label:"Vision Impaired",value:s.visionImpaired?"Yes":"No",epicSyncedAt:(ke=d.fieldSources.visionImpaired)==null?void 0:ke.syncedAt}),e.jsx(p,{label:"Primary Condition",value:s.primaryCondition,missing:!s.primaryCondition,epicSyncedAt:(Ie=d.fieldSources.primaryCondition)==null?void 0:Ie.syncedAt}),e.jsx(p,{label:"Diagnosed",value:s.diagnosed,missing:!s.diagnosed,epicSyncedAt:(Ee=d.fieldSources.diagnosed)==null?void 0:Ee.syncedAt})]})})})]}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(k,{title:"Clinical Details",right:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>q(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>q(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(F,{className:"w-4 h-4"})," Edit"]}),children:h?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:["ECOG Performance Status",e.jsx("select",{value:s.ecog,onChange:a=>n(t=>({...t,ecog:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2 bg-white",children:["0","1","2","3","4"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Disease Stage/Grade/Subtype",e.jsx("input",{value:s.diseaseStage,onChange:a=>n(t=>({...t,diseaseStage:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., Stage II; ER+/HER2-"})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:["Key Biomarkers",e.jsx("input",{value:s.biomarkers,onChange:a=>n(t=>({...t,biomarkers:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2",placeholder:"e.g., PD-L1 50%, EGFR exon 19"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comorbidities"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityCardiac,onChange:a=>n(t=>({...t,comorbidityCardiac:a.target.checked}))})," Cardiac"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityRenal,onChange:a=>n(t=>({...t,comorbidityRenal:a.target.checked}))})," Renal"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityHepatic,onChange:a=>n(t=>({...t,comorbidityHepatic:a.target.checked}))})," Hepatic"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.comorbidityAutoimmune,onChange:a=>n(t=>({...t,comorbidityAutoimmune:a.target.checked}))})," Autoimmune"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Infections"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHIV,onChange:a=>n(t=>({...t,infectionHIV:a.target.checked}))})," HIV"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHBV,onChange:a=>n(t=>({...t,infectionHBV:a.target.checked}))})," Hepatitis B"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!s.infectionHCV,onChange:a=>n(t=>({...t,infectionHCV:a.target.checked}))})," Hepatitis C"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6",children:[e.jsx(p,{label:"ECOG",value:s.ecog,missing:!s.ecog,epicSyncedAt:(Pe=d.fieldSources.ecog)==null?void 0:Pe.syncedAt}),e.jsx(p,{label:"Disease Stage/Subtype",value:s.diseaseStage,missing:!s.diseaseStage,epicSyncedAt:(De=d.fieldSources.diseaseStage)==null?void 0:De.syncedAt}),e.jsx(p,{label:"Key Biomarkers",value:s.biomarkers,missing:!s.biomarkers,epicSyncedAt:(Me=d.fieldSources.biomarkers)==null?void 0:Me.syncedAt}),e.jsx(p,{label:"Comorbidities",value:[s.comorbidityCardiac&&"Cardiac",s.comorbidityRenal&&"Renal",s.comorbidityHepatic&&"Hepatic",s.comorbidityAutoimmune&&"Autoimmune"].filter(Boolean).join(", "),epicSyncedAt:(He=d.fieldSources.comorbidity)==null?void 0:He.syncedAt}),e.jsx(p,{label:"Infections",value:[s.infectionHIV&&"HIV",s.infectionHBV&&"HBV",s.infectionHCV&&"HCV"].filter(Boolean).join(", "),epicSyncedAt:(Te=d.fieldSources.infection)==null?void 0:Te.syncedAt})]})})})}),e.jsx("div",{className:"mt-4 grid md:grid-cols-3 gap-4",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(k,{title:"Prior Treatments",children:[e.jsxs("ul",{className:"divide-y",children:[(s.priorTherapies||[]).map((a,t)=>e.jsxs("li",{className:"py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-gray-900",children:[a.name,a.date?` — ${a.date}`:""]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("button",{onClick:()=>{const i=prompt("Edit therapy name",a.name)||a.name,r=prompt("Edit date (optional)",a.date||"")||void 0;n(x=>({...x,priorTherapies:x.priorTherapies.map((M,w)=>w===t?{name:i.trim(),date:r==null?void 0:r.trim()}:M)}))},"aria-label":"edit",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>n(i=>({...i,priorTherapies:i.priorTherapies.filter((r,x)=>x!==t)})),"aria-label":"delete",children:e.jsx(me,{className:"w-4 h-4"})})]})]},t)),(s.priorTherapies||[]).length===0&&e.jsx("li",{className:"py-3 text-sm text-gray-600",children:"No prior treatments listed"})]}),re&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("label",{className:"text-gray-700",children:["Therapy Name",e.jsx("input",{value:l.name,onChange:a=>o(t=>({...t,name:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("label",{className:"text-gray-700",children:["Date (optional)",e.jsx("input",{value:l.date||"",onChange:a=>o(t=>({...t,date:a.target.value})),className:"mt-1 w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{o({name:"",date:""}),K(!1)},className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>{l.name.trim()&&(n(a=>{var t;return{...a,priorTherapies:[...a.priorTherapies,{name:l.name.trim(),date:((t=l.date)==null?void 0:t.trim())||void 0}]}}),o({name:"",date:""}),K(!1))},disabled:!l.name.trim(),className:`inline-flex items-center gap-1 text-sm rounded-full px-3 py-1.5 ${l.name.trim()?"bg-gray-900 text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save"})]})]}),!re&&e.jsxs("button",{onClick:()=>K(!0),className:"mt-3 inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"})," Add prior treatment"]})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(k,{title:"Additional Information",right:T?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W(!1),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:"Cancel"}),e.jsx("button",{onClick:()=>W(!1),className:"inline-flex items-center gap-1 text-sm rounded-full bg-gray-900 text-white px-3 py-1.5",children:"Save"})]}):e.jsxs("button",{onClick:()=>W(!0),className:"inline-flex items-center gap-1 text-sm rounded-full border px-3 py-1.5",children:[e.jsx(F,{className:"w-4 h-4"})," Edit"]}),children:T?e.jsx("textarea",{value:s.additionalInfo,onChange:a=>n(t=>({...t,additionalInfo:a.target.value})),rows:4,className:"w-full rounded-md border px-3 py-2 text-sm",placeholder:"Any important details you'd like us to know..."}):e.jsx("div",{className:"text-sm text-gray-700 min-h-[20px]",children:s.additionalInfo||"No additional information yet"})})}),!s.weight||!s.gender||!s.phone||!s.age||!s.race||!s.language||!s.bloodGroup||!s.genotype||!s.primaryCondition||!s.diagnosed||(s.allergies||[]).length===0||(s.medications||[]).length===0||!s.ecog||!s.diseaseStage?e.jsxs("div",{className:"mt-6 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Some details are missing. Please complete your profile."})]}):e.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{children:"Profile is up to date"})]})]}),g==="documents"&&e.jsx(Xe,{onCountChange:Y}),g==="ehr"&&(()=>{const a=(()=>{try{const i=localStorage.getItem("epic:patient:v1");if(i)return JSON.parse(i)}catch{}return null})();if(!(a!=null&&a.patientData))return e.jsxs("div",{className:"mt-6 rounded-xl border bg-white p-4 text-sm text-gray-600",children:[e.jsx("p",{children:"No EHR/EMR connected yet."}),e.jsx(Le,{to:"/patients/ehr",className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",children:"Connect EHR/EMR Provider"})]});const t=a.patientData;return e.jsxs("div",{className:"mt-6",children:[e.jsx(k,{title:"Connected Patient Information",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Patient ID"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Birth Date"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.birthDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gender"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mt-1",children:t.gender||"N/A"})]})]})}),Array.isArray(t.conditions)&&t.conditions.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(k,{title:"Conditions",children:e.jsx("ul",{className:"divide-y",children:(t.conditions||[]).map((i,r)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.display||i.code}),i.status&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status})]})},r))})})}),Array.isArray(t.medications)&&t.medications.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(k,{title:"Medications",children:e.jsx("ul",{className:"divide-y",children:(t.medications||[]).map((i,r)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.name}),(i.dosage||i.status)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.dosage,i.status].filter(Boolean).join(" • ")})]})},r))})})}),Array.isArray(t.allergies)&&t.allergies.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(k,{title:"Allergies",children:e.jsx("ul",{className:"divide-y",children:(t.allergies||[]).map((i,r)=>e.jsx("li",{className:"py-3 flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:i.substance}),(i.reaction||i.severity)&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:[i.severity&&`Severity: ${i.severity}`,i.reaction].filter(Boolean).join(" • ")})]})},r))})})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{localStorage.removeItem("epic:tokens:v1"),localStorage.removeItem("epic:patient:v1"),window.location.reload()},className:"inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Disconnect EHR"})})]})})()]}),e.jsx("footer",{className:"w-full border-t mt-16",children:e.jsxs("div",{className:"w-full max-w-[1200px] mx-auto px-4 py-6 text-sm text-gray-600 flex items-center justify-between",children:[e.jsx("span",{children:"Copyright © 2025 TrialCliniq."}),e.jsx("span",{children:"Terms · Privacy"})]})})]})}export{ct as default};
