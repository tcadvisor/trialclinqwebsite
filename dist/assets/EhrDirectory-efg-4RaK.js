import{R as c,e as V,j as e}from"./index-3kZk0rNx.js";import{S as F}from"./SiteHeader-CHrr19_Y.js";import"./HeaderActions-BUfyNln2.js";const s={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},M=[{id:"1",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"2",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"3",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"4",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1},{id:"5",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"6",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"7",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"8",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1},{id:"9",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"10",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"11",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"12",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1},{id:"13",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"14",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"15",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"16",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1},{id:"17",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"18",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"19",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"20",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1},{id:"21",vendor:"MEDITECH Expanse",organization:"Citizens Medical Center",portals:1},{id:"22",vendor:"athenahealth",organization:"Texas Endovascular Associates",portals:1},{id:"23",vendor:"Epic",organization:"MD Anderson Cancer Center",portals:2,isEpic:!0},{id:"24",vendor:"Oracle",organization:"Mount Sinai Health System",portals:1}],G=[{name:"Camila Lopez",fhirId:"e3u7nUSdz9pwVvtEMp3",conditions:["Diabetes","Hypertension"],medications:["Metformin","Lisinopril"]},{name:"Derrick Lih",fhirId:"ey8t1fDgQJm6tJhGmQoD",conditions:["COPD","Asthma"],medications:["Albuterol","Fluticasone"]},{name:"Desiree Powell",fhirId:"aKBm0I8k8uvJdcnsrXMm3",conditions:["Immunization","Observation"],medications:["Vitamins"]}];function B({item:n,onConnect:d}){return e.jsx("div",{className:"rounded-xl border p-4 bg-white",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 grid place-items-center rounded bg-gray-100 text-gray-700 text-xs font-semibold",children:n.vendor.split(" ")[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-500",children:n.vendor}),e.jsx("div",{className:"font-medium leading-5",children:n.organization}),e.jsxs("button",{className:"mt-2 inline-flex items-center text-xs rounded-full bg-blue-50 text-blue-700 px-2 py-1",children:[n.portals," portal",n.portals>1?"s":""]})]}),e.jsx("button",{onClick:()=>d(n),"aria-label":"Connect",className:"ml-auto h-7 w-7 grid place-items-center rounded border text-gray-700 hover:bg-gray-50 transition",children:"+"})]})})}function W(){const[n,d]=c.useState(""),[h,P]=c.useState(12),[b,v]=c.useState(!1),[g,A]=c.useState(!1),[I,r]=c.useState("");V();const m=c.useMemo(()=>{const t=n.trim().toLowerCase();return t?M.filter(a=>a.vendor.toLowerCase().includes(t)||a.organization.toLowerCase().includes(t)):M},[n]),T=m.slice(0,h),R=h<m.length,S=async t=>{if(t.isEpic)try{v(!0),r("Initializing EPIC connection..."),console.log("[EPIC] Step 1: Loading configuration");const i=s==null?void 0:s.VITE_EPIC_CLIENT_ID,o=s==null?void 0:s.VITE_EPIC_REDIRECT_URI,l=s==null?void 0:s.VITE_EPIC_FHIR_URL;if(console.log("[EPIC] Configuration loaded:",{clientId:i?`${i.substring(0,8)}...`:"MISSING",redirectUri:o?`${o.substring(0,40)}...`:"MISSING",fhirUrl:l?`${l.substring(0,30)}...`:"MISSING"}),!i||!o||!l)throw new Error(`Configuration incomplete: clientId=${!!i}, redirectUri=${!!o}, fhirUrl=${!!l}`);const y="Step 2: Fetching EPIC SMART configuration";console.log(`[EPIC] ${y}`),r(y);const x=`${l}.well-known/smart-configuration`;console.log(`[EPIC] Fetching from: ${x}`);const p=await fetch(x);if(!p.ok)throw new Error(`EPIC SMART config fetch failed with status ${p.status}. URL: ${x}`);const j=await p.json(),u=j.authorization_endpoint;if(!u)throw new Error("EPIC SMART configuration missing authorization_endpoint. Response: "+JSON.stringify(j));console.log(`[EPIC] Authorization endpoint: ${u}`);const w="Step 3: Generating PKCE challenge";console.log(`[EPIC] ${w}`),r(w);const D=crypto.getRandomValues(new Uint8Array(32)),C=btoa(String.fromCharCode.apply(null,Array.from(D))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),$=new TextEncoder().encode(C),U=await crypto.subtle.digest("SHA-256",$),H=Array.from(new Uint8Array(U)),N=btoa(String.fromCharCode.apply(null,H)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");console.log(`[EPIC] PKCE challenge generated (verifier length: ${C.length}, challenge length: ${N.length})`);const L=crypto.getRandomValues(new Uint8Array(16)),E=Array.from(L).map(O=>O.toString(16).padStart(2,"0")).join("");console.log(`[EPIC] State generated: ${E}`),localStorage.setItem("epic_code_verifier",C),localStorage.setItem("epic_state",E),console.log("[EPIC] Stored code_verifier and state in localStorage");const z="Step 4: Building authorization URL";console.log(`[EPIC] ${z}`),r(z);const k=new URLSearchParams({response_type:"code",client_id:i,redirect_uri:o,scope:"openid fhirUser",state:E,aud:l.replace(/\/$/,""),code_challenge:N,code_challenge_method:"S256"}),f=`${u}?${k.toString()}`;console.log(`[EPIC] Authorization URL: ${f.substring(0,100)}...`),console.log("[EPIC] Step 5: Redirecting to EPIC authorization"),r("Redirecting to EPIC for authorization..."),console.log(`[EPIC] Full auth URL: ${f}`),console.log("[EPIC] Performing window.location.href redirect..."),window.location.href=f}catch(a){console.error("[EPIC] Connection failed:",a);const o=`EPIC Connection Error:

${a instanceof Error?a.message:String(a)}

Check the browser console (F12 â†’ Console) for detailed logs.`;alert(o),v(!1),r("")}};return e.jsxs("div",{className:"min-h-screen bg-white text-gray-900",children:[e.jsx(F,{}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-200 border-t-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-semibold text-gray-900",children:"Connecting to EPIC"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:I})]})]})})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Available EMR/EHRs"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Securely connect your health record to help TrialCliniq match you with the most relevant clinical trials"}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Testing with EPIC Sandbox?"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Use our test patients to preview the EPIC integration with real patient data."})]}),e.jsxs("button",{onClick:()=>A(!g),className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 whitespace-nowrap",children:[g?"Hide":"Show"," Test Patients"]})]})}),g&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"EPIC Sandbox Test Patients"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:G.map(t=>e.jsxs("div",{className:"rounded-xl border-2 border-blue-300 p-4 bg-blue-50",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ID: ",t.fhirId]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Conditions:"}),e.jsx("div",{className:"text-xs text-gray-600",children:t.conditions.join(", ")})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Medications:"}),e.jsx("div",{className:"text-xs text-gray-600",children:t.medications.join(", ")})]}),e.jsx("button",{onClick:()=>{alert("Clicked: "+t.name),S({isEpic:!0})},disabled:b,className:"mt-4 w-full px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50",children:b?"Connecting...":"Connect as "+t.name.split(" ")[0]})]},t.fhirId))})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"relative max-w-xl",children:[e.jsx("input",{value:n,onChange:t=>d(t.target.value),placeholder:"Search healthcare systems or providers",className:"w-full rounded-full border px-4 py-2 pl-10"}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"ðŸ”Ž"})]})}),e.jsx("div",{className:"mt-5 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:T.map(t=>e.jsx(B,{item:t,onConnect:S},t.id+"-"+h))}),e.jsx("div",{className:"mt-6",children:R?e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsx("button",{type:"button",onClick:()=>P(t=>Math.min(t+9,m.length)),className:"w-full rounded-full border px-4 py-2 hover:bg-gray-50",children:"Load more"})}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"No more results"})}),e.jsx("div",{className:"mt-8 flex items-center justify-end text-xs text-gray-500",children:e.jsx("span",{children:"Powered by Health Gorilla"})})]})]})}export{W as default};
